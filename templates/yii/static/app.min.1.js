(function(a,b,c){function d(a){a=a||location.href;return"#"+a.replace(/^[^#]*#?(.*)$/,"$1")}var e=document,f,g=a.event.special,h=e.documentMode,m="onhashchange"in b&&(h===c||7<h);a.fn.hashchange=function(a){return a?this.bind("hashchange",a):this.trigger("hashchange")};a.fn.hashchange.delay=50;g.hashchange=a.extend(g.hashchange,{setup:function(){if(m)return!1;a(f.start)},teardown:function(){if(m)return!1;a(f.stop)}});f=function(){function f(){var c=d(),e=s(p);c!==p?(q(p=c,e),a(b).trigger("hashchange")):
e!==p&&(location.href=location.href.replace(/#.*/,"")+e);h=setTimeout(f,a.fn.hashchange.delay)}var g={},h,p=d(),r=function(a){return a},q=r,s=r;g.start=function(){h||f()};g.stop=function(){h&&clearTimeout(h);h=c};"Microsoft Internet Explorer"===navigator.appName&&!m&&function(){var b,c;g.start=function(){b||(c=(c=a.fn.hashchange.src)&&c+d(),b=a('<iframe tabindex="-1" title="empty"/>').hide().one("load",function(){c||q(d());f()}).attr("src",c||"javascript:0").insertAfter("body")[0].contentWindow,e.onpropertychange=
function(){try{"title"===event.propertyName&&(b.document.title=e.title)}catch(a){}})};g.stop=r;s=function(){return d(b.location.href)};q=function(c,d){var f=b.document,g=a.fn.hashchange.domain;c!==d&&(f.title=e.title,f.open(),g&&f.write('<script>document.domain="'+g+'"\x3c/script>'),f.close(),b.location.hash=c)}}();return g}()})(jQuery,this);window.ssys=window.$$=function(a,b){var c=a.split("/"),d=c.shift();return ssys[d].$$(c,b)};ssys.cache={};ssys.appClasses={};ssys.views={};ssys.preloading=!1;ssys.loading=!1;ssys.refresh=function(){ssys.views={};ssys.cache=[]};ssys.addClass=function(a,b){a.className+=b};ssys.capitalize=function(a){return a.charAt(0).toUpperCase()+a.slice(1)};
ssys.timeToString=function(a,b){var c=new Date(1E3*parseInt(a)),d=c.getMonth()+1,e=c.getDate(),f=c.getHours();10>f&&(f="0"+f);var g=c.getMinutes();10>g&&(g="0"+g);c=new Date;d=d+"\u6708"+e+"\u65e5 "+f+":"+g;e=c.getFullYear();c.getFullYear()!=e&&(d=e+"\u5e74"+d);return d};
ssys.moveDom=function(a,b,c){b&&"append"!=b?"prepend"==b?c.insertBefore(a,c.firstChild):"before"==b?c.parentNode.insertBefore(a,c):"after"==b?c.parentNode.insertBefore(a,c.nextSibling):"self"==b&&(c.parentNode.insertBefore(a,c),c.parentNode.removeChild(c)):c.appendChild(a)};
ssys.parseTemplate=function(a,b){for(;result=a.match(/(\$l\{([^}]+)\})/);)a=a.replace(result[1],b.getLabel(ssys.eval(result[2],b)));for(;result=a.match(/(\$\{([^}]+)\})/);){var c=ssys.eval(result[2],b);if((typeof c).match(/string|number/))a=a.replace(result[1],c);else{a=c;break}}return a};ssys.divide=function(a,b){return a.match(new RegExp("\\"+b))?a.split(new RegExp("^([^"+b+"]*)"+b)).slice(1):[a,""]};
ssys.eval=function(a,b){if("this"==a)return b;for(var c=a.split("."),d=b;c.length&&b;){var e=b,f=c.shift();b=b[f];void 0===b&&(b=e["get_"+f],"function"==typeof b?b=b.call(e):"function"==typeof d?console.error(d.classname,"eval",a,"\u51fa\u9519,\u5728step=",f,"\u65f6\u5931\u8d25\u4e86!"):console.error(d,d.fullname||d.name,"eval",a,"\u51fa\u9519,\u5728step=",f,"\u65f6\u5931\u8d25\u4e86!"))}return b};ssys.jsonEncode=function(a){return JSON.stringify(a)};
ssys.capitalize=function(a){return a.charAt(0).toUpperCase()+a.substr(1)};ssys.clone=function(a){if("object"==typeof a&&null!==a){if($.isArray(a))var b=[];else if(a.constructor===Object)b={};else return a;for(var c in a)b[c]=ssys.clone(a[c]);return b}return a};ssys.isIE=function(){return"Microsoft Internet Explorer"===navigator.appName};ssys.traverse=function(a,b){if($.isArray(a)){for(var c=[],d=0,e=a.length;d<e;d++)c[d]=ssys.traverse(a[d],b);return c}return b(a)};
ssys.removeUndefined=function(a){for(var b in a)void 0===a[b]&&delete a[b];return a};ssys.mapToList=function(a,b){for(var c=[],d=0,e=b.length;d<e;d++){var f=b[d];c[d]=void 0===a[f]?null:a[f]}return c};ssys.resolve=function(a){return $.Deferred().resolve(a)};ssys.updateObject=function(a,b){a=a||{};for(var c in b){var d=b[c];"ssysDelete"===d?delete a[c]:a[c]=d}return a};
ssys.mergeObject=function(a,b){if(a&&b)if($.isArray(a))a=a.concat(b);else for(var c in b){var d=b[c],e=a[c];void 0===e?a[c]=d:"object"==typeof d&&"object"==typeof e&&ssys.mergeObject(e,d)}return a};ssys.toArray=function(a){var b=[];if($.isArray(a))return a;for(var c in a)b.push([c,a[c]]);return b};
ssys.loopDefer=function(a,b,c,d){var e=0;a=ssys.toArray(a);var f=function(b){if(e<a.length){var h=a[e];e++;return c(h,b,e).pipe(f,function(a){console.error("loopDefer\u5728\u7b2c",e,"\u9879=",h,"\u51fa\u9519\u4e86!\u8fd4\u56de\u7684\u662f:",a);return d(e,h,a)})}return 0==a.length?$.Deferred().resolve(b):b};return f(b)};
ssys.asyncLoopDefer=function(a,b,c){var d=0,e=0,f=$.Deferred();if(0==a.length)return f.resolve();for(var g=0,h=a.length;g<h;g++)b(a[g],g).pipe(function(){d++;if(d==h)return 0==e?f.resolve():f.reject(e)},function(){d++;e++;if(d==h)return 0==e?f.resolve():f.reject(e)});return f.pipe(null,c)};ssys.reject=function(a){console.warn&&(console.warn.apply?console.warn.apply(console,arguments):console.warn(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6]));return $.Deferred().reject(a)};
ssys.dfdget=function(a,b){return a?ssys.resolve(a):b()};ssys.addParams=function(a,b){a.match(/\?/)||(a+="?");for(var c in b){var d=b[c];(typeof d).match(/string|number/)||(d=ssys.jsonEncode(d));if(a.match(/\?$/))a+=c+"="+d;else{var e=new RegExp(c+"=[^&]+");a.match(e)?a.replace(e,c+"="+d):a+="&"+c+"="+d}}return a};ssys.xhrget=function(a,b,c,d){"Microsoft Internet Explorer"===navigator.appName&&(a=encodeURI(a));return $.ajax({type:"GET",url:a,dataType:"json",crossDomain:d,timeout:12E4,xhrFields:{withCredentials:!0}})};
ssys.xhrpost=function(a,b,c,d){return d?$.ajax({type:"POST",url:a,crossDomain:!0,data:b,dataType:"json",xhrFields:{withCredentials:!0}}):$.ajax({type:"POST",url:a,data:b,dataType:"json"})};window.jsonp=function(a){return a};ssys.getJsonp=function(a,b){"Microsoft Internet Explorer"===navigator.appName&&(a=encodeURI(a));return $.ajax({cache:!b,dataType:"jsonp",timeout:2E4,jsonp:!1,jsonpCallback:"jsonp",url:a,error:function(){console.error("[ssys.getJsonp],failed to get url:",a)}})};
ssys.globalDfds=[];ssys.pendingDfdCount=0;ssys.getJs=function(a,b,c){a.match(/^\./)&&(a=a.replace(/^\./,ssys.sresBaseUrl));return b||!ssys.cache[a]&&!c?$.ajax({cache:!b,dataType:"script",timeout:2E4,url:a,success:function(){ssys.cache[a]=!0},error:function(b,c,f){console.error("\u52a0\u8f7durl=",a,"\u811a\u672c\u51fa\u9519\u4e86!",b,c,f)}}):ssys.resolve()};
ssys._getJs=function(a,b){return $.ajax({cache:!b,dataType:"script",timeout:2E4,url:a,success:function(){ssys.cache[a]=!0;ssys.pendingDfdCount--;0==ssys.pendingDfdCount&&ssys.globalDfd.resolve()},error:function(b,d,e){console.error("\u52a0\u8f7durl=",a,"\u811a\u672c\u51fa\u9519\u4e86!",b,d,e)}})};
ssys.getCss=function(a){a.match(/^\./)&&(a=a.replace(/^\./,ssys.sresBaseUrl));if(ssys.cache[a])return ssys.resolve();var b=new $.Deferred;try{var c=document.createElement("link");c.type="text/css";c.href=a;c.rel="stylesheet";b.resolve({});document.getElementsByTagName("head")[0].appendChild(c);ssys.cache[a]=c}catch(d){console.error("[ssys.getCss],error:",d),b.reject(d)}return b};ssys.delay=function(a,b){var c=new $.Deferred,d=setTimeout(function(){a();c.resolve()},1E3*b);c.timeoutId=d;return c};
ssys.cancel=function(a){a&&clearTimeout(a.timeoutId)};ssys.getAnchor=function(){return window.location.hash.slice(1)};ssys.setAnchor=function(a){window.location.hash=a?"#"+a:"";""===a&&history.pushState&&history.pushState({},"",window.location.pathname)};ssys.getKeys=function(a){var b=[],c;for(c in a)b.push(c);return b};ssys.shuffle=function(a,b){var c,d,e=a.length;if(b)var f=[];l=a.length;if(e)for(;e;)d=Math.floor(Math.random()*l),e--,c=a[d],a[d]=a[e],a[e]=c,b&&f.push(c);return b?f:a};
ssys.aa=function(a,b,c){c=c||[];a=a.split(",");b=0;for(var d=a.length;b<d;b++)eval("_."+a[b]+"=valueList["+b+"]");return c};ssys.summernote={};
ssys.summernote.ssysUploadImage=function(){var a=ssys.uploaded_at=$.now(),a={url:ssys.summernote.renderer.options.uploadImageUrl+"?uploaded_at="+a,dataType:"json",xhrFields:{withCredentials:!0},type:"POST",crossDomain:!0,done:function(a,b){ssys.summernote.editor.restoreRange(ssys.summernote.editable);ssys.summernote.editor.insertImage(ssys.summernote.editable,ssys.summernote.renderer.options.uploadUrl+ssys.summernote.renderer.options.currentUser.id+"__"+ssys.uploaded_at);ssys.summernote.imageDialog.modal("hide")}},
b=ssys.summernote.imageDialog.find(".note-image-input");b.attr("name","file");b.fileupload(a)};window.console=window.console||{info:function(){},debug:function(){},warn:function(){},error:function(){},log:function(){}};console.debug||(console.debug=function(){});console.warn||(console.warn=function(){});console.error||(console.error=function(){});$$.O=function(){};$$.O.prototype._clearCache=$$.O._clearCache=function(){};$$.O.prototype.classname=$$.O.classname="$$.O";
$$.O.prototype.$$=$$.O.$$=function(a){ssys.isRefresh&&this._clearCache();if("string"==typeof a)a=a.split("/");else if(!$.isArray(a))return console.error("$$\u80fd\u63a5\u53d7\u7684steps\u53ea\u80fd\u662fstring\u6216array of strings!\u8be5steps\u5374\u662f",a),ssys.reject();if(0==a.length)return ssys.resolve(this);var b=a.shift(),c=this[b]||this.constructor[b],d=this;if(void 0===c)if(this["get_"+b])c=this["get_"+b]();else if(c=b.match(/^#(.+)/))c=ssys[c[1]];else if(c=b.match(/^m_(.+)$/)){var c=c[1],
e=this[c];if(!e||"function"!=typeof e)return console.error("step\u4e66\u5199\u9519\u8bef",this,"\u4e0d\u5b58\u5728\u540d\u4e3a",c,"\u7684\u65b9\u6cd5!"),ssys.reject();c=e.apply(this)}else if(this._$$)c=this._$$(b);else return console.error(this.fullname,"\u6ca1\u6cd5\u8bfb\u53d6step",b,"!"),ssys.reject();if(0<a.length){if(c.$$)return c.$$(a);if(c.pipe)return c.pipe(function(c){if(c.$$)return c.$$(a);console.error(d,"\u7684",b,"\u662f",c,"\u5b83\u6ca1\u6709$$, \u6ca1\u6cd5\u7ee7\u7eed\u8bfb\u8bfb\u53d6\u4e0b\u51e0\u6b65",
a,"!");return ssys.reject()});console.error(this,"\u7684",b,"\u662f",c,"\u5b83\u6ca1\u6709$$, \u6ca1\u6cd5\u7ee7\u7eed\u8bfb\u8bfb\u53d6\u4e0b\u51e0\u6b65",a,"!");return ssys.reject()}if(c.pipe)return c;if(void 0!==c)return ssys.resolve(c);console.error(this.fullname,"\u6ca1\u6cd5\u8bfb\u53d6step",b,"!");return ssys.reject()};$$.O.prototype.eval=function(a){return ssys.eval(a,this)};
$$.O.prototype.parseConfig=function(a,b){if("string"==typeof a){if(!a.match(/\$[{\d~]|^m__(\w+)$/))return a;if(matched=a.match(/^m__(\w+)$/)){var c=matched[1],d=this[c];d?a=b?d.call(this,b[0]):d.call(this):console.error(this.fullname,"\u6ca1\u6709\u627e\u5230methodName=",c,"\u7684\u65b9\u6cd5, \u914d\u7f6em__\u6709\u8bef!");return this.parseConfig(a,b)}if(b)for(c=1,d=b.length;c<d;c++)a=a.replace("$"+c,b[c]);for(;b=a.match(/(\$\{([^}]+)\})/);)if(c=this.eval(b[2]),(typeof c).match(/string|number/))a=
a.replace(b[1],c);else{a=this.parseConfig(c);break}"string"==typeof a&&(a=a.replace(/\$~/g,"$"))}else if("object"==typeof a&&null!==a){c=a;if($.isArray(c))a=[];else if(c.constructor===Object)a={};else return c;for(d in c){if(c[d]instanceof RegExp)return c;a[d]=this.parseConfig(c[d],b)}}return a};
$$.O.prototype.parentCall=function(a,b){for(var c=this.sup[a],d=this.sup;c===this[a];)if(d.sup)d=d.sup,c=d[a];else return console.error(this,"\u6ca1\u6709\u627e\u5230\u540d\u4e3a",a,"\u7684parentCall!");return c.apply(this,b||[])};
$$.O.prototype.extendProperty=function(a,b){this.self[a]||console.error(this.fullname,"\u8981\u6269\u5c55\u7684\u5c5e\u6027",a,"\u5931\u8d25\u4e86!\u539f\u56e0\u662f\u4e0d\u5b58\u5728\u88ab\u7ee7\u627f\u7684\u7236\u7c7b");$.isArray(b)?b[2]="@"+this.fullname:b=[b,null,"@"+this.fullname];(this[a]=this.self[a].createSubclass(b)).host=this};$$.O.prototype.extendProperties=function(a){for(var b in a){var c;(c=b.match(/^xp_(.+)$/))?this.extendProperty(c[1],a[b]):this[b]=a[b]}};$$.O.create=function(){return new this};
$$.O.addPrototypeContent=function(a,b){for(var c=this.getPrototypes(a),d=this.getPrototypes(b),e=0,f=d.length;e<f;e++){var g=d[e];if(-1!=$.inArray(g,c))break;for(var h in g)if("__proto__"!=h&&"constructor"!=h&&"self"!=h){var m,k=g[h];if(m=h.match(/^mg_(.+)$/))h=m[1],k=ssys.mergeObject(k,a[h]);a[h]=k}}};$$.O.getPrototypes=function(a){a=a||this.prototype;for(var b=[];a;)b.push(a),a=a.__proto__;return b};
$$.O.createSubclass=function(a,b,c,d){a=a||{};$.isArray(a)&&(b=a[1],c=a[2],d=a[3],a=a[0]);b=b||{};var e=function(){},f=new this;e.prototype=f;if(d)for(var g=0,h=d.length;g<h;g++){var m=d[g];this.addPrototypeContent(f,m.prototype)}for(var k in a){g=a[k];if(m=k.match(/^mg_(.+)$/))k=m[1],g=ssys.mergeObject(g,this.prototype[k]);f[k]=g}f.sup=new this;f.self=e;for(k in this)e[k]=this[k];a={};for(k in b){g=b[k];if(m=k.match(/^(ex_|xp_)(.+)$/))k=m[2],d=m[1],(m=this[k])?("xp_"==d?d=[]:(d=[m],m=e),$.isArray(g)?
(g[2]=k,g[3]=g[3]?g[3].concat(d):d):g=[g,null,k,d],g=m.createSubclass(g)):a[k]=g;e[k]=g}e.superclass=this;c&&(this[c]=e,this.subclasses[c]=e,e.classname=e.prototype.classname=this.classname+"/"+c,e.shortClassname=e.prototype.shortClassname=c);for(k in a)g=a[k],m=e,"function"==typeof g&&(g=[null,null,k,[g]]),g=$.isArray(g)?m.createSubclass(g[0],g[1],k,g[3]):m.createSubclass(g,null,k),a[k]=e[k]=g;e.subclasses=a;return e};$$.O.extendProperty=function(a,b,c){this[a]=this[a].createSubclass(b,c);return this};
$$.O.subclasses={};$$.View=$$.O.createSubclass({tag:"Div",affectParent:!1,preventClick:"accept",showConfigs:{},showConfigRules:[[/^$|^index/,"${indexShow}"]],inputConfigs:null,initInputDataConfigs:null,elementConfigs:{stage:["Html",["<div></div>"]],dialog:["Dialog",["onCloseDialog"],null,$("body")],tabs:["Tabs",["${tabConfigs}","pill",!0]]},elementConfigRules:[],indexShow:[],defaultState:"index",initDatas:null,init:function(){this.isLocked=!0;this.initShow={};this.beforeInit&&this.beforeInit.apply(this,arguments);
this.initInputDataConfigs&&(this.initInputDataConfigs=ssys.clone(this.initInputDataConfigs));this.template&&(this.domnode.innerHTML=this.parseTemplate(this.template));this.stage=document.getElementById(this.fullname+"__stage")||this.domnode;if(this.initShow){var a=this.initShow=this._getShowConfigs(this.initShow);this.showByConfigs(a)}this.stage=document.getElementById(this.fullname+"__stage")||this.domnode;this.afterInit.apply(this,arguments);this.state="start";this.isLocked=!1},html:function(a){return void 0===
a?this.domnode.innerHTML:this.domnode.innerHTML=a},append:function(a){return this.domnode.innerHTML+=a},find:function(a){return $(this.domnode).find(a)},children:function(a){return $(this.domnode).children(a)},addClass:function(a){return $(this.domnode).addClass(a)},removeClass:function(a){return $(this.domnode).removeClass(a)},setStates:function(a){var b=this;return ssys.loopDefer(a,null,function(a){return b.setState(a)},function(a,d){console.error(b.fullname,"setStates\u5728\u7b2c",a,"\u6b65setState(",
d,")\u65f6\u51fa\u9519\u4e86!")})},setState:function(a,b){a=a||this.defaultState;if("string"==typeof a){if("function"==typeof this[a]&&!this["filter_"+a])return this[a]();if(a.match(/,/)){var c=a.split(",");return this.setStates(c)}}else{if($.isArray(a)){a=ssys.clone(a);a[0].match&&a[0].match(/^\$\{.+\}$/)&&(a[0]=this.parseConfig(a[0]));if(a[0].setState){var c=a[0],d=a[1];this.isLocked=!1;return c.setState(d,b)}return this.setStates(a,b)}"number"==typeof a&&(a=""+a)}if("*"==a)if("start"==this.state)a=
this.defaultState;else return a=this.state,ssys.resolve(a);else"<"==a?a=this.getLastState()||this.defaultState:">"==a&&(a=this.getNextState()||this.defaultState);b&&(this.isLocked=!1);if(!this.isRefresh&&(this.state===a||this.isLocked||a===this.defaultState&&""===this.state))return ssys.resolve(this.state);a.match(/\$\{/)&&(a=this.parseConfig(a));c=a.split("/");d=c.shift();if(".."==d)return this.parent.setState(c.join("/"),b);if("refresh"==d)return a=c.join("/"),this.refresh(a);if("update"==d)return a=
c.join("/"),this.update(a);if(d.match(/^#/))return this.app.layout.setState(a.substr(1),b);var e=this;e.isLocked=!0;return this.filterState(a).pipe(function(b){return e.fetchDatas(b).pipe(function(){return e.setStateDfd=e.show(b).pipe(function(b){a.match(/\*$/)?a=b:a.match(/(^|\/)refresh(\/|$)/)&&(a=b);a==e.defaultState?a="":a.match(/\/$/)&&(a=a.split(/\/$/)[0]);e.state=a;e.showedState=b;e.isLocked=!1;return a},function(){console.error(e.fullname,"\u7684\u8868\u6f14\u5931\u8d25\u4e86,\u5c06\u7ee7\u7eed\u4fdd\u6301\u72b6\u6001",
e.state,"[$$.View.setState]");e.isLocked=!1;return e.state})})},function(a){e.isLocked=!1;return e.setState(a)})},hide:function(){this.domnode.style.display="none";this.hidingState=this.state;this.state="-";return ssys.resolve("-")},display:function(){this.domnode.style.display="";this.state=this.hidingState;return ssys.resolve(this.state)},filterState:function(a){var b=this.getStateFilter(a),c=this;if(b){var d=$.isArray(b)?b:[b],c=this;a=ssys.loopDefer(d,a,function(a,b){var d;(d=a.match(/^to__(.+)$/))?
d=ssys.resolve(d[1]):(d=c["filter_"+a](b),d.pipe||(d=!1===d?ssys.reject():ssys.resolve(d)));return d},function(a,b,g){console.error(c.fullname,"filterState\u65f6\u5728\u7b2c",a,"\u6b65filter\u4e3a",b,"\u65f6\u51fa\u9519\u4e86!\u8fd4\u56de\u7ed3\u679c\u662f",g,"filters=",d);return g})}else a=ssys.resolve(a);return a.pipe(function(a){return"string"==typeof a?(a.match(/\$/)&&(a=c.parseConfig(a)),a.match(/[.,><#]|^refresh\b|^update\b/)?ssys.reject(a):a):ssys.reject(a)},function(a){""===a&&(a=c.defaultState);
return a||c.state})},getStateFilter:function(a){var b=this.getStateConfig(a,"filter");b||(a=a.split("/")[0],this["filter_"+a]&&(b=a));return b},fetchDatas:function(a){a=this.getStateConfig(a,"load");if(!a)return ssys.resolve();a.splice||(a=[a]);var b=this;return ssys.loopDefer(a,null,function(a){return b.fetchData(a)})},fetchData:function(a){a=$$.divide(a,"/");return this.app.resources[a[0]].fetchDataByPath(a[1])},show:function(a){var b=$$.divide(a,"/"),c=b[0]||this.defaultState,d=b[1],b=this.getShowConfigs(c),
e,f=this;this.showByConfigs(b);if(d){var b=$$.divide(d,"/"),g=b[0];g.match(/\./)&&(d=$$.divide(g,"."),c=d[0],d=b[1]?d[1]+"/"+b[1]:d[1]);(b=f.elements[c])?b.setState?e=b.setState(d):console.error(f.fullname,"\u540d\u4e3a"+c+"\u7684\u5143\u7d20\u6ca1\u6709setState \u65b9\u6cd5!"):console.error(f.fullname,"\u540d\u4e3a"+c+"\u7684\u5143\u7d20\u4e0d\u5b58\u5728!")}else e=ssys.resolve();return e.pipe(function(){return f.afterShow(a)})},getShowConfigs:function(a){a=this.getStateConfig(a,"show")||[a];return this._getShowConfigs(a)},
_getShowConfigs:function(a){for(var b={},c=this.currentShow,d=this.initShow,e=0,f=a.length;e<f;e++){var g=a[e];if("string"==typeof g)var h=g.match(/^(-)?([^.]+)(\.(.*))?$/);else console.error(this.fullname,"\u7684showConfigs",a,"\u4e2d\u7684config=",g,"\u6709\u8bef!config\u53ea\u80fd\u662fstring");h||console.error(this.fullname,"showConfigs",a,"\u4e2d\u7684config=",g,"\u6709\u8bef!\u5f62\u5f0f\u4e0d\u5339\u914d");var g=h[2],m=h[1];if(m)var k=m;else k=h[4],void 0===k&&(k="start");var n=c[g];n&&n.state==
k||!n&&m||(b[g]={state:k})}for(g in c)b[g]||d[g]||(b[g]={state:"-"});return b},showByConfigs:function(a){this.locationConfigs={};for(var b in a)this.showElement(b,a[b].state);for(var c in this.locationConfigs)this.moveElement(c,this.locationConfigs[c])},showElement:function(a,b){this.isRefresh&&delete this.elements[a];var c=this.elements[a];if(!c)if(c=this.getElementConfig(a))c=this.createElement(a,c);else return console.error(this.fullname,"\u7684\u5267\u672c\u4e0a\u6ca1\u627e\u5230",a,"\u5143\u7d20\u7684\u6dfb\u52a0\u65b9\u6cd5,\u4e0d\u77e5\u9053\u5982\u4f55\u6dfb\u52a0\u5b83!",
"[$$.View.showElement]");"-"==b?c.hide?c.hide():c.style.display="none":c.setState&&(c.display(),"start"!=b&&c.setState(b));return c},getElementConfig:function(a){var b=this.elementConfigs[a];if(!b){elementConfigRules=this.elementConfigRules;for(var c=0,d=elementConfigRules.length;c<d;c++){var e=elementConfigRules[c],f=a.match(e[0]);if(f){b=e[1];"function"==typeof b&&(b=b.call(this,a));break}}}return b=this.parseConfig(b,f)},createElement:function(a,b){b=b.slice(0);var c=b[0],d=b[1]||[],e=b[2],f=this["create"+
c]||this.app.layout["create"+c];if(f)d.unshift(a),c=f.apply(this,d);else{"string"==typeof c&&(c=this.self[c]||this.app.layout.self[c]);if(!c||"function"!=typeof c){console.error(this.fullname,"\u540d\u4e3a"+a+"\u7684element\u521b\u5efa\u5931\u8d25!","\u65e0\u6cd5\u8bc6\u522b\u5143\u7d20\u79cd\u7c7b",b[0],"\u8bc6\u522b\u7ed3\u679c\u662f",c,"(\u6709\u6548\u7684\u53ea\u80fd\u662fstring\u6216function)");return}c=c.create(this,a,d)}if(c)return this.elements[a]=c,e&&(this.locationConfigs[a]=e),(e=this.getInputNameOfElement(a))&&
this.initInputDataConfigs&&(e=this.initInputDataConfigs[e])&&c.setInputData(e),c;console.error(this.fullname,"\u65e0\u6cd5\u751f\u6210\u540d\u4e3a"+a+"\u7684element!")},moveElement:function(a,b){"string"==typeof a&&(a=this.elements[a]);var c=a.domnode||a;b=this.parseLocation(b);$$.moveDom(c,b[0],b[1])},parseTemplate:function(a){return this.parseConfig(a.replace(/ e="/g,' id="'+this.fullname+"__"))},beforeInit:function(){if(this.initDatas&&!this.isRefresh)return this.app.fetchDatas(this.parseConfig(this.initDatas))},
afterInit:function(){},onLogin:function(){this._login()},_login:function(){if(this.loginConfigs)for(var a=0,b=loginConfigs.length;a<b;a++){var c=loginConfigs[a];if(this.elements[c])this.elements[c].onLogin()}},getElement:function(a){a="#"==a.charAt(0)?a.substr(1):this.fullname+"__"+a;return ssys.views[a]},filter_index:function(a){return a},filter_logged:function(a){return this.app.currentUser.isGuest?ssys.reject("#p_session/login"):ssys.resolve(a)},refresh:function(a){a||""===a||(a=this.state);ssys.isRefresh=
!0;var b=this,c=this.beforeRefresh(),c=c?c.pipe(function(){return b._refresh(a)}):this._refresh(a);return c.always(function(){ssys.isRefresh=!1})},update:function(a){a||""===a||(a=this.state);ssys.isRefresh=!0;var b=this,c=this.beforeRefresh();return c?c.pipe(function(){return b._update(a)}):this._update(a)},beforeRefresh:function(){},_refresh:function(a){var b=this;return this.init.apply(this,this.params||[]).pipe(function(){return b.setState(a)})},_update:function(a){return this.setState(a).pipe(function(a){ssys.isRefresh=
!1;return a})},displayElements:function(a){for(var b=0,c=a.length;b<c;b++){var d=this.elements[a[b]];(d.domnode||d).show()}},hideElements:function(a){for(var b=0,c=a.length;b<c;b++){var d=this.elements[a[b]];$(d.domnode||d).hide()}},afterShow:function(a){var b=this.stage.entry;if(this["after_"+b])this["after_"+b]();return a},getParentState:function(a){a=a.split(/\/\w+$/);return 2==a.length?a[0]:null},getStateConfig:function(a,b,c){if(null===a)return null;""===a&&(a=this.defaultState);c=this[b+"ConfigRules"];
b=(this[b+"Configs"]||{})[a];var d=null;if(!b&&c)for(var e=0,f=c.length;e<f;e++){var g=c[e];if(d=a.match(g[0]))if(b=g[1])break}if(b)return this.parseConfig(b,d)},getMatchedConfig:function(a,b,c,d,e){var f=null,g,h;b&&(g=b[a]);if("list"==d||"concat"==d)h=[];if(!g||"list"==d||"concat"==d){b=0;for(var m=c.length;b<m;b++){var k=c[b];if(f=a.match(k[0]))if(g=k[1],void 0!==e&&(g=g[e]),g)if(g=this.parseConfig(g,f),"list"==d)h.push(g);else if("concat"==d)$.isArray(g)?h=h.concat(g):h.push(g.slice(0));else break}}return h||
g},initInputData:function(a){var b=this.inputConfigs;if(b){this.initInputDataConfigs||(this.initInputDataConfigs={});for(var c=0,d=b.length;c<d;c++){var e=this.getInputName(b[c]),f=a[e];void 0!==f&&(this.initInputDataConfigs[e]=f)}}},setInputData:function(a){var b=this.inputConfigs;if(b)for(var c=0,d=b.length;c<d;c++){var e=b[c],f=this.getInputName(e),e=this.getInputElementName(e);(e=this.elements[e])&&e.setInputData(a[f])}},getInputNameOfElement:function(a){var b=this.inputConfigs;if(b)for(var c=
0,d=b.length;c<d;c++){var e=b[c],f=this.getInputName(e);if(a==this.getInputElementName(e))return f}},updateInputData:function(){var a=this.inputConfigs,b=this.inputData=this.inputData||{};this.inputElement=null;this.inputElements={};if(a)if($.isArray(a))e=this.updateInputGroup(a),ssys.updateObject(b,e);else if("string"==typeof a)e=this.elements[a].updateInputData(),this.inputElement=this.elements[a],ssys.updateObject(b,e);else for(e in a){var c=a[e];if("string"==typeof c){var d=this.elements[c].updateInputData();
this.inputElements[e]=this.elements[c]}else d=ssys.updateObject(b[e],this.updateInputGroup(c));b[e]=d}else{var e=this.getSimpleInputs();ssys.updateObject(b,e)}this.removeErrors();return b},removeErrors:function(){this.removeClass("ssysErrorElement");this.find(".ssysErrorElement").removeClass("ssysErrorElement");this.find(".ssysErrorMessage").remove()},updateInputGroup:function(a){for(var b={},c=0,d=a.length;c<d;c++){var e=a[c],f=this.getInputName(e),e=this.getInputElementName(e);if(e=this.elements[e]){var g=
e.updateInputData?e.updateInputData():this.getSimpleInputs(e);this.inputElements[f]=e}else g=this.getSimpleInputs()[f];b[f]=g}return b},getInputElementByInputName:function(a){var b=this.inputConfigs;if(b){if($.isArray(b))return this.getInputElementFromInputGroupConfig(b,a);for(var c in b){var d=this.getInputElementFromInputGroupConfig(b[c],a);if(d)return d}}},getInputElementFromInputGroupConfig:function(a,b){for(var c=0,d=a.length;c<d;c++){var e=a[c];if(b==this.getInputName(e))return this.elements[this.getInputElementName(e)]}},
getInputElementName:function(a){return"string"==typeof a?a+"Input":a[1]},getInputName:function(a){return"string"==typeof a?a:a[0]},getSimpleInputs:function(a){a=a||this.domnode;a=$(a).find("*").serializeArray();for(var b={},c=0,d=a.length;c<d;c++){var e=a[c];b[e.name]=e.value}return b},showErrors:function(a){console.error(this.fullname,"\u8f93\u5165\u6709\u8fd9\u4e9b\u9519\u8bef:",a);if("string"==typeof a)this.showError(a);else if(!$.isArray(a)&&"object"==typeof a)for(var b in a){var c=a[b],d=this.inputElements[b];
if(d&&d.showErrors)d.showErrors(c);else if(this["show"+b+"Error"])this["show"+b+"Error"](c);else this.showError(c,b)}},showError:function(a,b){this.find(":visible[name='"+b+"']").addClass("ssysErrorElement").after("<div class='ssysErrorMessage'>"+a+"</div>")},getDom:function(a){if(void 0===a||null===a)console.error(this.fullname,"getDom(path)\u51fa\u9519\u4e86!path\u4e0d\u80fd\u662f",a,"!");else{if(a.appendChild)return a;if("string"==typeof a){var b=a.match(/^(\w+)(\/(.+))?$/);return b?(a=b[2],b=
document.getElementById(this.fullname+"__"+b[1]),a?document.querySelector("#"+b.id+" "+a):b):document.querySelector("#"+this.fullname+" "+a)}if(a.domnode)return a.domnode}},parseLocation:function(a,b){if(b){var c=document.getElementById(this.fullname+"__"+b);if(c)return[c,"self"]}var c=this.stage,d=null;"string"==typeof a?a.match(/^(append|prepend|after|before)$/)?d=a:c=this.getDom(a):a?$.isArray(a)?(c=a[1],d=a[0]):c=a:d="append";(c=this.getDom(c))&&c.appendChild||console.error(this.fullname,"\u6ca1\u6709\u627e\u5230location=",
a,"\u5bf9\u5e94\u7684domnode!");return[d||"append",c]},createHtml:function(a,b){var c=a?this.fullname+"__"+a:null,d=document.getElementById(c);if(d){d.insertAdjacentHTML("afterend",b);var e=d.nextSibling;e.className+=d.className;d.parentNode.removeChild(d)}else this.stage.insertAdjacentHTML("beforeend",b),e=this.domnode.lastChild;e.id=c;return e},createButton:function(a,b,c,d){d=d||{};b="<button data-state='"+b+"' data-warning='"+(d.warning||"")+"' title='"+(d.tooltip||"")+"' class='btn btn-"+(d.type||
"default")+" "+(d.size?"btn-"+d.size:"")+" "+((d.cssClass||"")+" ssysButton")+"'>";b=d.icon?b+"<span class='fa fa-"+d.icon+"'></span>"+c+"</button>":b+c+"</button>";return this.createHtml(a,b)},createLink:function(a,b,c,d){d=d||{};d.icon?c="<span class='fa fa-"+icon+"'></span>"+(c||""):d.imgSrc&&(c="<img src='"+d.imgSrc+"' class='"+(d.imgClass||"")+"' /><span>"+(c||"")+"</span>");return this.createHtml(a,"<a href='#' data-state='"+b+"' title='"+(d.tooltip||"")+"'>"+c+"</a>")},renderStyle:function(){$$.addClass(this.domnode,
this.style?this.style+" "+this.name:this.name)}},{fetchCss:function(){if(this.hasCss){var a=this.url.replace(/js$/,"css");ssys.getCss(a)}},create:function(a,b,c){var d=new this;d.parent=a;d.app=a.app;d.name=b;d.fullname=a.fullname+"__"+b;d.params=c=c||[];var e=document.getElementById(d.fullname);e||(e=document.createElement(d.tag),e.id=d.fullname,a.stage.appendChild(e));d.domnode=e;d.renderStyle();d.elements={};d.logs={};d.parent.currentShow[b]=d.currentShow={};a.elements[b]=d;d.init.apply(d,c);return d},
ex_DataBinding:{bindingConfigs:{},getDataByPath:function(a){return this.app.getData(a)},onDataUpdate:function(a){},bindData:function(a,b){this.dataBindings[a]?console.error(this.fullname,"\u540d\u4e3a",a,"\u7684data\u5df2\u7ecf\u7ed1\u5b9a\u8fc7\u4e86,\u4e0d\u80fd\u91cd\u590d\u7ed1\u5b9a!"):(b=b||this.getDataByPath(this.bindingConfigs[a]),this.dataBindings[a]=b,b.views.push(this))},afterInit:function(){this.dataBindings={};for(var a in this.bindingConfigs)this.bindData(a)}},ex_Defered:{init:function(){this.isLocked=
!0;this.stage=this.domnode;this.addClass(this.cssClass);this.elements={};var a=this.beforeInit.apply(this,arguments);this.logs={};this.initInputDataConfigs&&(this.initInputDataConfigs=ssys.clone(this.initInputDataConfigs));var b=this;this.initShow?a?this.initDfd=a.pipe(function(){b.template&&b.html(b.parseTemplate(b.template));return b.showByConfigs(b.initShow)}):(this.template&&this.html(this.parseTemplate(this.template)),this.initDfd=this.showByConfigs(b.initShow)):(this.template&&this.html(this.parseTemplate(this.template)),
this.initDfd=a||ssys.resolve());var c=arguments;return this.initDfd=this.initDfd.pipe(function(){b.afterInit.apply(b,c);b.state="start";b.isLocked=!1})},onLogin:function(){if("pending"!=this.initDfd.state())this._login();else{var a=this;this.initDfd.pipe(function(){a._login()})}},showByConfigs:function(a){ssys.resolve();var b=this;return ssys.loopDefer(a,null,function(a){return b.showElement(a)},function(a,d){console.error(b.fullname,"showByConfigs\u610f\u5916\u4e2d\u6b62\u4e86!\u8bf7\u68c0\u67e5\u914d\u7f6e",
d,"\u662f\u5426\u6b63\u786e.")})},showElement:function(a,b){this.isRefresh&&delete this.elements[a];var c=this.elements[a];if(c){if("-"==b){if(c.hide)return c.hide();c.style.display="none";return ssys.resolve(c)}return c.setState?c.setState(b):ssys.resolve(c)}return(c=this.getElementConfig(a))?this.createElement(a,c):ssys.reject(this.fullname,"\u7684\u5267\u672c\u4e0a\u6ca1\u627e\u5230",a,"\u5143\u7d20\u7684\u6dfb\u52a0\u65b9\u6cd5,\u4e0d\u77e5\u9053\u5982\u4f55\u6dfb\u52a0\u5b83!","[$$.View.showElement]")},
show:function(a){var b=$$.separate(a,"/"),c=b[0]||this.defaultState,d=b[1],e=this,b=this.getShowConfigs(c),e=this;return this.showByConfigs(b).pipe(function(){if(d){var b=$$.divide(d,"/"),g=b[0];if(g.match(/\./)){var h=$$.divide(g,"."),g=h[0];d=b[1]?h[1]+"/"+b[1]:h[1]}else g=c;(b=e.elements[g])?b.setState?b.setState(d):console.error(e.fullname,"\u540d\u4e3a"+g+"\u7684\u5143\u7d20\u6ca1\u6709setState \u65b9\u6cd5!"):console.error(e.fullname,"\u540d\u4e3a"+g+"\u7684\u5143\u7d20\u4e0d\u5b58\u5728!")}return a}).pipe(function(a){return e.afterShow(a)})},
createElement:function(a,b){b=b.slice(0);var c=b[0],d=b[1]||[],e=b[2],f=this;if(this["create"+c])d.unshift(a),c=ssys.resolve(this["create"+c].apply(this,d));else{if("function"==typeof c)c=ssys.resolve(c);else if("string"==typeof c)c=this.$$(c);else return console.error(this.fullname,"\u65e0\u6cd5\u8bc6\u522b\u5143\u7d20\u79cd\u7c7b(\u53ea\u80fd\u662fstring\u6216function)",c,"\u65e0\u6cd5\u751f\u6210\u540d\u4e3a"+a+"\u7684element!"),ssys.reject();c=c.pipe(function(b){return b.create.apply(b,[f,a,e,
d])},function(b){console.error(f.fullname,"\u6ca1\u6709\u627e\u5230\u5143\u7d20",a,"\u7684viewClass!error=",b)})}return c.pipe(function(b){f.elements[a]=b;cssClass&&b.domnode.addClass(cssClass);return b.setState?b.initDfd.pipe(function(){var c=f.getInputNameOfElement(a);c&&(b.domnode.attr("name",c),f.initInputDataConfigs&&(c=f.initInputDataConfigs[c])&&b.setInputData(c));return b.setState(state)}):b},function(){console.error(f.fullname,"\u65e0\u6cd5\u751f\u6210\u540d\u4e3a"+a+"\u7684element!")})}}},
"View");$$.View.Input=$$.View.createSubclass({defaultState:"start",style:"ssysInput form-group",setInputData:function(a){this.input.val(a)},updateInputData:function(){this.removeErrors();return this.inputData=this.input.val()},showError:function(a){this.addClass("has-error");this.append('<label class="control-label" for="inputError">'+a+"</label>")},removeErrors:function(){this.removeClass("ssysErrorElement has-error");this.find(".control-label").remove()}});
$$.View.FloatInput=$$.View.Input.createSubclass({beforeInit:function(a,b,c){b="<input class='ssysFloatInput form-control' value='"+(c||"")+"' />"+(b||"");a=a.match(/{{}}/)?a.replace("{{}}",b):"<label>"+a+"</label>"+b;this.html(a);this.input=this.find("input.form-control")},updateInputData:function(){this.removeErrors();return this.inputData=parseFloat(this.input.val())},setInputData:function(a){this.input.val(a)}});
$$.View.StringInput=$$.View.Input.createSubclass({beforeInit:function(a,b,c){this.defaultValue=c;$(this.domnode).html("<input class='form-control' placeholder='"+a+"' value='"+(c||"")+"' />"+(b?"<div class='help-block'>"+b+"</div>":""));this.input=$(this.domnode).children("input").data("defaultValue",c);ssys.isIE&&void 0===c&&this.input.placeholder()}});
$$.View.BooleanInput=$$.View.Input.createSubclass({beforeInit:function(a,b,c){this.html("<label>"+a+"  <input type='checkbox' checked='"+(c||"false")+"'/></label>"+(b?"<div class='help-block'>"+b+"</div>":""));this.input=this.find("input")},setInputData:function(a){this.input.prop("checked",a)},updateInputData:function(){this.removeErrors();return this.inputData=this.input.prop("checked")}});
$$.View.TextInput=$$.View.Input.createSubclass({tag:"textarea",style:"form-control",beforeInit:function(a){this.html("<textarea class='form-control' placeholder='"+(title||"")+"' value='"+(defaultValue||"")+"'/><h3><small>"+(note||"")+(length?"(<span class='textLength'>\u5b57\u6570\u4e0d\u80fd\u8d85\u8fc7"+length+"<span>)":"")+"</small></h3>");this.textarea=this.children("textarea");this.length=length;var b=this;if(richOptions){this.isRich=!0;a=ssys.sresBaseUrl+"lib/summernote/summernote.js";var c=
ssys.sresBaseUrl+"lib/summernote/summernote.css",d=this.app.storageBaseUrl+"images/",b=this;return ssys.getJs(a).pipe(function(){ssys.getCss(c);ssys.mergeObject(richOptions,{width:700,height:300,locale:"zh-CN",uploadImageUrl:b.app.baseUrl+"uploader/uploadImage.php",uploadUrl:d,toolbar:[["style",["bold","italic","underline","clear"]],["fontsize",["fontsize"]],["color",["color"]],["para",["ul","ol","paragraph"]],["height",["height"]],["insert",["picture","link"]],["view",["codeview"]]],currentUser:b.app.currentUser});
$("#"+b.fullname+" textarea").summernote(richOptions)})}ssys.isIE&&void 0===defaultValue&&this.textarea.placeholder()},afterInit:function(){},setInputData:function(a){if(this.isRich)return this.find(".note-editable").html(a);this.textarea.val(a.replace(/\n/g,"<br/>"))},updateInputData:function(){this.removeErrors();return this.isRich?this.find(".note-editable").code():this.inputData=this.textarea.val()}});
$$.View.PasswordInput=$$.View.Input.createSubclass({beforeInit:function(a,b){this.html("<label>\u8f93\u5165\u5bc6\u7801</label><input class='form-control' placeholder='"+(a||"\u5bc6\u7801")+"' type='password'/><div class='help-block'>"+(b||"")+"</div>");this.input=this.children("input")}});
$$.View.RegisterPasswordInput=$$.View.Input.createSubclass({beforeInit:function(a,b){this.html("<label>\u8f93\u5165\u5bc6\u7801: </label><div class='form-group'><input class='password form-control' placeholder='"+(a||"\u5bc6\u7801")+"' type='password'/><div class='help-block'>"+(b||"")+"</div></div><label>\u786e\u8ba4\u5bc6\u7801: </label><div class='form-group'><input class='confirmPassword form-control' placeholder='\u786e\u8ba4\u5bc6\u7801' type='password'/></div>")},updateInputData:function(){var a=
this.find(".password").val(),b=this.find(".confirmPassword").val();this.removeErrors();if(!a)throw this.showError("\u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a","password"),Error("\u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a");if(!b)throw this.showError("\u786e\u8ba4\u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a","confirmPassword"),Error("\u786e\u8ba4\u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a");if(a!=b)throw this.showError("\u5bc6\u7801\u4e0d\u4e00\u81f4","confirmPassword"),Error("\u5bc6\u7801\u4e0d\u4e00\u81f4");return this.inputData=
a}});$$.View.Navbar=$$.View.createSubclass({defaultState:"start",tag:"nav",style:"navbar",template:'<div class="container"><div class="navbar-header"><button data-target=".navbar-collapse" data-toggle="collapse" type="button" class="navbar-toggle"><span class="icon-bar"></span> <span class="icon-bar"></span><span class="icon-bar"></span></button>${brand}</div><nav role="navigation" class="collapse navbar-collapse"><ul class="nav navbar-nav navbar-left"></ul><div class="navbar-form navbar-left"></div><ul class="nav navbar-nav navbar-right"></ul></nav></div>',
beforeInit:function(a,b){this.links=a;this.logoSrc=b.logoSrc||"";this.brandHref=b.brandHref||"";b.cssClass&&this.addClass(b.cssClass);if(b.elementConfigs){this.elementConfigs=$$.mergeObject($$.clone(b.elementConfigs),this.elementConfigs);this.initShow=$$.clone(this.initShow);for(var c in b.elementConfigs)this.initShow.push(c)}},get_brand:function(){return this.logoSrc?'<a class="navbar-brand" href="${brandHref}"><img src="${logoSrc}"/></a>':""},afterInit:function(){var a=this.getDom("ul.navbar-left");
this.getDom("ul.navbar-right");for(var b=0,c=this.links.length;b<c;b++)this.addLink(this.links[b],b,a);this.activate(0)},addLink:function(a,b,c){c.innerHTML+='<li id="'+(this.fullname+"__li"+b)+'"><a class="ssysLink" data-state="'+a[0]+'" href="javascript::;">'+a[1]+"</a></li>"},activate:function(a,b){var c=null===a?$(this.getDom('a[data-state="'+b+'"]')).parent():$("#"+this.fullname+"__li"+a),d=this.getDom("li.active");d&&$(d).removeClass("active");c.addClass("active")}});$$.View.Carousel=$$.View.createSubclass({affectParent:!1,style:"carousel slide",template:'<ol class="carousel-indicators"></ol><div class="carousel-inner"></div><a class="left carousel-control" href="#${fullname}" data-slide="prev"><span class="fa fa-chevron-left"></span></a><a class="right carousel-control" href="#${fullname}" data-slide="next"><span class="fa fa-chevron-right"></span></a>',afterInit:function(a){$(this.domnode).attr("data-ride","carousel");for(var b=$(this.domnode).find(">.carousel-indicators"),
c=$(this.domnode).find(">.carousel-inner"),d=0,e=a.length;d<e;d++){var f=a[d];0==d?(b.append('<li data-target="#'+this.fullname+'" data-slide-to="0" class="active"></li>'),c.append('<div class="item active"><a href="'+f.href+'"><img src="'+f.src+'" alt="'+(f.alt||"")+'"><div class="carousel-caption"><h3>'+f.caption+"</h3></div></a></div>")):(b.append('<li data-target="#'+this.fullname+'" data-slide-to="'+d+'"></li>'),c.append('<div class="item"><a href="'+f.href+'"><img src="'+f.src+'" alt="'+(f.alt||
"")+'"><div class="carousel-caption"><h3>'+f.caption+"</h3></div></a></div>"))}$(this.domnode).carousel()}});$$.View.Paginator=$$.View.createSubclass({defaultState:"start",template:'<ul class="pagination pagination-sm"><span class="pull-right label label-default">\u5171${sum}\u6761</span></ul>',beforeInit:function(a,b,c,d,e){this.hostView=e||this.parent;this.sum=a||0;this.limit=b||20;this.page=c||1;this.size=d||7;this.pages=Math.ceil(a/this.limit)},mg_filterConfigRules:[[/^\d+$/,["page"]]],filter_page:function(a){this.hostView.onPageChange(a);return a},afterInit:function(){var a="",b=this.pages,c=this.size;
if(!(2>this.pages)){if(b>c){var d=Math.floor((this.size-1)/2);this.page<=d&&(d=this.page-1);c=this.size-d-1;this.page+c>b&&(c=b-this.page,d=this.size-c-1);d=this.page-d;1!=d&&(a='<li><a id="'+this.fullname+'__first" href="javascript::;" class="ssysLink" name="1">\u9996\u9875</a></li>');c=this.page+c;if(c<b)var e=!0}else c=b,d=1;for(d;d<=c;d++)a=d==this.page?a+'<li class="active"><a id="'+this.fullname+"__page"+d+'" href="javascript::;" class="ssysLink" name="'+d+'">'+d+"</a></li>":a+'<li><a id="'+
this.fullname+"__page"+d+'" href="javascript::;" class="ssysLink" name="'+d+'">'+d+"</a></li>";e&&(a=a+'<li><a id="'+this.fullname+'__last" href="javascript::;" class="ssysLink" name="'+b+'">\u672b\u9875</a></li>');a=a+'<span class="pull-right label label-default">\u5171'+this.sum+"\u6761</span>";this.domnode.innerHTML=a}},navigate:function(a){this.page=parseInt(a);this.afterInit();this.hostView.onPageChange(a)}});$$.App=$$.O.createSubclass({format:"json",temp:{},_$$:function(a){var b;if(b=a.match(/^r_(\w+)$/))return this.getResource(b[1]);if(b=a.match(/^v_([\w:]+)$/))return a=b[1].replace(/:/g,"/"),this.getPage(a);if(b=a.match(/^l_([\w:]+)$/))return a=b[1].replace(/:/g,"/"),this.getLib(a);console.error(this,"\u65e0\u6cd5\u8bfb\u53d6step",a,"!");return ssys.reject()},baseUrl:"",init:function(a){var b=this;a=a||document.body.appendChild(document.createElement("div"));this.createCurrentUser();b.setLayout(a);
$("body").on("click","a.ssysLink,.ssysButton",function(a){a.preventDefault();a.stopPropagation();var d=b.layout;if("confirm"==d.preventClick){if(0==confirm("\u6b63\u5728\u81ea\u52a8\u64ad\u653e\u9875\u9762, \u4f60\u7684\u624b\u52a8\u64cd\u4f5c\u4f1a\u5bfc\u81f4\u64ad\u653e\u4e2d\u65ad, \u4f60\u786e\u5b9a\u8981\u7ee7\u7eed\u5417?"))return;d.stop()}a=$(this);ssys.preloading=!1;if(a.data("parentView"))f=a.data("parentView");else{var e=a.attr("id");if(e){d=e.split("__");d.pop();var d=d.join("__"),f=b.getViewByName(d)}else f=
d}var g=a.data("state");if(null===g||void 0===g)if(g=a.attr("name"),null===g||void 0===g)g=a.attr("href");if(a.data("warning")){var h=$('<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"><div class="modal-dialog">    <div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>        <h4 class="modal-title" id="myModalLabel">\u6ce8\u610f</h4></div><div class="modal-body"><div class="alert alert-warning">'+
a.data("warning")+'</div></div><div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal">\u53d6\u6d88</button><button type="button" class="confirm btn btn-primary">\u786e\u5b9a</button></div></div></div></div>').modal({show:!0});h.find("button.confirm").click(function(){h.modal("hide");f.setState(g,!0)})}else f.setState(g,!0)});$("body").on("keyup",".ssysInput textarea",function(a){a=$(this).parent();var b=a.data("ssysview").length,e=$(this).val().length,b=b-e;0<=
b?a.find(".textLength").html("\u8fd8\u80fd\u518d\u8f93\u5165"+b+"\u4e2a\u5b57"):a.find(".textLength").html("\u5b57\u6570\u5df2\u7ecf\u8d85\u8fc7\u9650\u5236\u957f\u5ea6\u4e86,\u8981\u51cf\u5c11"+-b+"\u4e2a\u5b57")});b.currentUser.autoLogin().pipe(function(){})},refresh:function(){this.layout=null;this.init()},getSessionId:function(){var a=this;this.sessionId=null;return this.get("ssys/getSessionId",{refresh:$.now()},!0,"jsonp").pipe(function(b){return a.sessionId=b})},logout:function(){var a=this;
this.get("ssys/logout",null,!0,"jsonp").always(function(){a.createCurrentUser();return a.layout.refresh("session/login")})},fetchDatas:function(a){var b=this;return ssys.asyncLoopDefer(a,function(a){if("string"==typeof a){var d=a;a=null}else d=a[0],a=a[1];return b.get(d,a,!0)},function(a){console.error("fetchDatas\u6709"+a+"\u4e2a\u5931\u8d25\u4e86!");return ssys.resolve()})},getAppModel:function(){var a=this;return ssys.scenter.getResource("app").pipe(function(b){return b.getModelByAttributes({name:this.name}).pipe(function(b){a.appModel=
b;a.appid=b.id})})},getUrl:function(a,b){a=this.addFormat(a);b&&(a=ssys.addParams(a,b));this.isWidget&&("/"==a.charAt(0)&&(a=a.substr(1)),a=this.baseUrl+a);return a},get:function(a,b,c,d){if(b){var e=b.refresh;a=this.getUrl(a,b)}else e=!1,a=this.getUrl(a);this.isWidget?c?d?(a=a.replace(".json",".jsonp"),a=ssys.getJsonp(a,!0)):(this.sessionId&&(a=ssys.addParams(a,{PHPSESSID:this.sessionId})),a=ssys.xhrget(a,!0,e,!0)):a=ssys.getJs(a):a=ssys.xhrget(a,c,e);return a.pipe(function(a){return a&&a.error?
ssys.reject(a.error):a})},addFormat:function(a,b){b=b||this.format;return a.match(/\.\w+($|\?)/)?a:a+"."+b},post:function(a,b,c){a=this.baseUrl+a.substr(1);this.sessionId&&(a=ssys.addParams(a,{PHPSESSID:this.sessionId}));return ssys.xhrpost(a,b,c,this.isWidget)},getPageUrl:function(a){a=a.replace(/:/g,"/");return this.staticBaseUrl+"pages/"+a+".js"},getLibUrl:function(a){if("#"==a.charAt(0))return ssys.staticBaseUrl+a.substr(1);if("/"!=a.charAt(0))var b=this.staticBaseUrl;else a=a.split(/^(\w+)\//),
b=a[1],a=a[2],b=ssys[b].staticBaseUrl;return b+"lib/"+a+".js"},getViewByName:function(a){a=a.split("__");var b=this.layout;a.shift();for(var c=0,d=a.length;c<d;c++)b=b.elements[a[c]];return b},getPage:function(a){var b=this.pages[a];if(b)return ssys.resolve(b);var c=this.getPageUrl(a),d=this;return $$.getJs(c).pipe(function(){return d.pages[a]},function(){console.error("\u52a0\u8f7d\u9875\u9762url=",c,"\u5931\u8d25\u4e86!")})},getLib:function(a){a=this.getLibUrl(a);return ssys.getJs(a)},getResource:function(a){var b=
this;return this.resources[a]?ssys.resolve(this.resources[a]):ssys.getJs(this.staticBaseUrl+"resources/"+a+".js").pipe(function(){return b.resources[a]})},addPage:function(a,b,c,d,e){d=d||this.self.Page;b=d.createSubclass(b,c,e);b.path=a;b.url=this.getPageUrl(a);b.fetchCss();return this.pages[a]=b},addLayoutClass:function(a,b,c){return this.addViewClass("layouts/"+a,b,c,SsysLayout)},addResource:function(a,b){return this.self.Resource.create(this,a,b)},createCurrentUser:function(){this.currentUser=
$$.User.create(this)},setLayout:function(a){a=this.self.Layout.create(this,a);var b=a.getStateByAnchor();a.setState(b);return a},getData:function(a){if(a=this.dataBindings[a])return a.data},setData:function(a){var b=a.dataPath;if(b){var c=this.dataBindings[b];c?(c.data!=a&&this.updateViews(c,a),c.views.push(view)):this.bindingDatas[b]={data:a,views:[],path:b}}else console.error("setData\u5931\u8d25, \u8be5data",a,"\u7f3a\u4e86dataPath!")},bindData:function(a,b,c){var d=this.dataBindings[a];d?(d.data!=
b[c]&&(d.data=data,this.updateViews(d)),d.views.push(b)):(d=this.dataBindings[a]={data:b[c],views:[b],path:a},b.dataBindings[a]={binding:d,localName:c})},updateViews:function(a){for(var b=a.views,c=a.data,d=0,e=b.length;d<e;d++){var f=b[d],g=f.dataBindings[a.path].localName;f[g]!=c&&(f[g]=c,f.update())}}},{Layout:$$.View.createSubclass({mg_showConfigs:{index:["p_index"]},mg_filterConfigRules:[[/^index|^p_([\w:]+)/,["page"]]],mg_elementConfigRules:[[/^p_([\w:]+)$/,["${app.pages.$1}"]],[/^(\w+)/,["${app.resources.$1.ResourceView}"]]],
filter_page:function(a){var b="index"==a?"index":a.match(/^p_([\w:]+)/)[1];return this.app.getPage(b).pipe(function(){return a},function(){return"p_error"})},getStateByAnchor:function(){var a=ssys.getAnchor();a||(a="");return a},afterShow:function(a){this.parentCall("afterShow",[a]);$$.setAnchor("index"!=a?a:"");return a},login:function(){this.refresh()}},{create:function(a,b){var c=new this;c.app=a;c.domnode=b;c.fullname=a.name;b.id=c.fullname;c.views={};c.elements={};c.currentShow={};a.layout=c;
c.init();return c}}),Page:$$.View.createSubclass({eval:function(a){a=a.replace(/cl~(\w+)/,"app.resources.$1.CollectionView");a=a.replace(/cr~(\w+)/,"app.resources.$1.CreateView");return $$.eval(a,this)}}),create:function(){var a=new this;a.pages={};a.resources={};a.dataBindings={};return a}},"App");$$.User=$$.O.createSubclass({isGuest:!0,isAdmin:function(){return this.userModel&&this.userModel.role&&this.userModel.role.match(/admin/)},getCurrentUser:function(){var a=this;return this.app.get("ssys/getCurrentUser",{refresh:$.now()},!0,"jsonp").pipe(function(b){return a._getUserModelByTuple(b)})},_getUserModelByTuple:function(a){return this.app.getResource("user").pipe(function(b){return b.getModelByTuple(a)})},autoLogin:function(){var a=this;return this.loginDefer?this.loginDefer:this.loginDefer=
this.getCurrentUser().pipe(function(b){return a.loginByUserModel(b)},function(){a.isGuest=!0;a.isLoggingIn=!1;return ssys.resolve()})},login:function(a,b,c){var d=this.app;return d.$$("r_user").pipe(function(e){return e.getModelByUrl("/ssys/xhrLogin",{loginParams:[a,b,c||null]},"jsonp").pipe(function(a){return d.currentUser.loginByUserModel(a)},function(a){if(2==a)var b={password:"\u5bc6\u7801\u9519\u8bef"};else 1==a&&(b={username:"\u60a8\u8f93\u5165\u7684\u7528\u6237\u540d\u5c1a\u672a\u6ce8\u518c"});
return b})})},loginByUserModel:function(a){this.isGuest=!1;this.userModel=a;a.userRelation="me";localStorage.userTuple=JSON.stringify(a.tuple);localStorage.userid=this.id=a.id;localStorage.username=this.username=a.username;var b=this;if(ssys.isIE()&&this.app.isWidget)return this.app.getSessionId().pipe(function(){return b.app.layout.onLogin()});if(this.app.layout)this.app.layout.onLogin()},logout:function(){}},{create:function(a){var b=new this;b.app=a;var c=localStorage.userTuple;c&&b.loginByUserModel(a.resources.user.getModelByTuple(JSON.parse(c)));
return b}},"User");$$.Resource=$$.App.Resource=$$.O.createSubclass({format:"json",collectionConfigs:{},extendProperty:function(a,b){this.parentCall("extendProperty",[a,b]);this[a].prototype.app=this.app;this[a].prototype.resource=this},_$$:function(a){var b;if("sum"==a)return this.getDataByAction("sum");if(b=a.match(/^(\d+)$/))return this.getModel(b[1]);console.error(this,"\u65e0\u6cd5\u8bfb\u53d6step",a,"!");return ssys.reject()},createModel:function(a){var b="/"+this.name+"/create.json",c=this;a=ssys.mapToList(a,
c.Model.creationParams);return c.app.post(b,{SsysCreationParams:ssys.jsonEncode(a)}).pipe(function(a){return c.getModelByTuple(a)})},createModelArchetype:function(a){a=ssys.mapToList(a,this.Model.prototype.attris);return this.getModelByTuple(a,!0)},isUnique:function(a,b){return this.getDataByAction("isUnique",{attr:a,value:b})},getAttri:function(a,b){return this.getDataByUrl(a+"/"+b+"."+this.format)},getModel:function(a){return this.models[a]?ssys.resolve(this.models[a]):this.getModelByUrl(a+"."+
this.format)},getModelByTuple:function(a,b){return this.Model.create(a,b)},getModelByAttributes:function(a){return this.getModelByUrl("findByAttributes."+this.format,{attris:a})},getModelByAction:function(a,b){return this.getModelByUrl(a+"."+this.format,b)},getModelByUrl:function(a,b,c){var d=this;return this.getDataByUrl(a,b,"get",c).pipe(function(c){var f=d.getModelByTuple(c),g=f.getUrl();a=d.app.getUrl("/"+d.name+"/"+a,b);a=a.replace(/((\?|\&)refresh=\d+$)|refresh=\d+\&/,"");ssys.cache[a]="ssys:"+
g;ssys.cache[g]=c;return f})},getModelsByAttributeValueSet:function(a,b){return this.getModelsByUrl("getItemsByAttributeValueSet."+this.format,{attri:a,set:b},!0)},getModelsByUrl:function(a,b,c){var d=this;b=b||{};return b.returnsum?this.getDataByUrl(a,b):this.getDataByUrl(a,b).pipe(function(a){return d.getModelsByTuples(a)}).pipe(function(e){if(c)return e.sum=e.length,e;b.returnsum=1;return d.getDataByUrl(a,b).pipe(function(a){e.sum=a;return e})})},getModelsByTuples:function(a){for(var b=[],c=0,
d=a.length;c<d;c++){var e=this.getModelByTuple(a[c]);b.push(e)}return b},getDataByAction:function(a,b,c,d){return this.getDataByUrl(a+"."+("post"==c?"json":this.format),b,c,d)},getDataByUrl:function(a,b,c,d){a=""+a;"/"!==a.charAt(0)&&(a="/"+this.name+"/"+a);return"post"==c?this.app.post(a,b,!0):this.app.get(a,b,!0,d)},fetchDataByPath:function(a){var b;if(b=a.match(/^(\d+)$/))return this.getModel(b[1]);if(b=a.match(/^([^\[\]]+)(\[([^\[\]]+)\]$)?/)){var c=this.getCollection(b[1]);return b[3]?"number"==
typeof b[3]?c.fetch({page:b[3]}):"string"==typeof b[3]&&b.match(/^{/)?(a=JSON.parse(b[3]),c.fetch(a)):ssys.reject(this.name,"fetchData\u65e0\u6cd5\u8bc6\u522bpath=",a,"\u4e2d\u7684",b[3],",\u8bf7\u68c0\u67e5\u662f\u5426\u5199\u9519\u4e86!"):c.fetchSum()}return ssys.reject(this.name,"fetchData\u65e0\u6cd5\u8bc6\u522bdata path",a,"\u8bf7\u68c0\u67e5\u662f\u5426\u5199\u9519\u4e86!")},getCollection:function(a){return this.collections[a]=this.collections[a]||this.addCollection(a)},addCollection:function(a){var b;
if(b=a.match(/^(\w+)(\{.+$)?/))var c=b[1],d=b[2],d=d?JSON.parse(d):{};else console.error(this.name,"\u7684collection path",a,"\u4e66\u5199\u4e0d\u7b26\u5408\u89c4\u8303!\u5fc5\u987b\u662f\u7c7b\u4f3cTypename{params1:xx,params2:xxx}\u8fd9\u6837\u7684\u5f62\u5f0f");if(b=this.collectionConfigs[c])return $$.mergeObject(d,b),d.path=a,this.Collection.create(d);if(this["get"+a])return this.collections[a]=this["get"+a]();a.match(/^attris/)||console.error(this.name,"addCollection\u51fa\u9519!\u8bf7\u68c0\u67e5path=",
a,"\u662f\u5426\u5199\u9519\u4e86.")},deleteAll:function(a){return this.getDataByAction("deleteAll",{ids:a})}},{create:function(a,b,c){var d=new this;a.resources[b]=d;d.name=b;d.fullname=a.name+"__res_"+b;d.app=a;d.models={};d.views={};d.collections={};d.extendProperties(c);return d}},"Resource");$$.Model=$$.Resource.Model=$$.O.createSubclass({creationParams:[],attris:["id"],implAttris:null,implAttrisConfigs:null,defaultValues:{},validationRules:{},editableConfigs:{uneditable:["id","creator_id","updated_at","created_at","typename"],editableRoles:["creator","owner","admin"]},relations:{},_clearCache:function(){var a=this.relations,b;for(b in a)delete this[b],delete this["many__"+b],delete this["count__many__"+b]},_$$:function(a){var b;if(b=this.relations[a]){b=this.parseConfig(b);var c=b.shift();
"hasMany"!=c||b[2]||(b[2]={});b.push(args);b.unshift(a);return this[c].apply(this,b)}return(b=a.match(/^count__(.+)/))?(a=b[1],b=this.relations[a],b=this.parseConfig(b),c=b.shift(),"hasMany"!=c||b[2]||(b[2]={}),b.push(args),b.unshift(a),this["count_"+c].apply(this,b)):ssys.reject()},get_uri:function(){return"#"+this.resource.name+"Resource/"+this.id},get_subjecttype:function(){return ssys.capitalize(this.resource.name)},hasMany:function(a,b,c,d,e){var f=this["many__"+a]||{};e=e||[];e[0]=e[0]||1;e[1]=
e[1]||20;e[2]=e[2]||"";e[3]=e[3]||"";e[4]=e[4]||!1;e[5]=e[5]||!1;var g=JSON.stringify(e);if(f[g]&&!ssys.isRefresh)return ssys.resolve(f[g]);d=d||{};d[c]=this.id;e.unshift(d);var h=this;return this.$$(b+"/m_getModelsByAttributes",e).pipe(function(b){f[g]=b;h["many__"+a]=f;return b})},count_hasMany:function(a,b,c,d,e){var f=this["count__many__"+a];if(f&&!ssys.isRefresh)return ssys.resolve(f);e=e?this.parseConfig(e):[];d=d||{};d[c]=this.id;e.unshift(d);e[5]=1;var g=this;return this.$$(b+"/m_getModelsByAttributes",
e).pipe(function(b){return g["count__many__"+a]=b})},manyAction:function(a,b,c,d,e){var f=this["many__"+a]||{};e=e||[];var g=e[0]||1;if(f[g]&&!ssys.isRefresh)return ssys.resolve(f[g]);d=ssys.mergeObject(d||{},{page:g,limit:e[1]||20,order:e[2]||""});var h=this;return this.$$(b+"/m_getModelsByAction",[c,d]).pipe(function(b){f[g]=b;h["many__"+a]=f;return b})},count_manyAction:function(a,b,c,d){var e=this["count__many__"+a];if(e&&!ssys.isRefresh)return ssys.resolve(e);d=d||{};d.returnsum=1;var f=this;
return this.$$(b+"/m_getModelsByAction",[c,d]).pipe(function(b){return f["count__many__"+a]=parseInt(b)})},belongTo:function(a,b,c){var d=this;return this.$$(b+"/"+this[c]).pipe(function(b){return d[a]=b})},impl:function(){if(this.typedata){this.implAttris||(this.implAttris=this.implAttrisConfigs[this.typename]);for(var a=0,b=this.implAttris.length;a<b;a++)this[this.implAttris[a]]=this.typedata[a]}},init:function(){this.id&&this._clearCache()},save:function(){var a=this;return this.validate().pipe(function(b){if(a.id)return a.resource.getDataByAction("update",
{id:a.id,SsysUpdateParams:ssys.jsonEncode(b)},"post").pipe(function(b){ssys.cache[a.getUrl()]=b;return a.typename?a.typename==a.shortClassname?a.pull(b):a.resource.modelClass[a.typename].create(b):a.pull(b)});for(var c=a.implAttris||[],d=[],e=0,f=c.length;e<f;e++)d[e]=b[c[e]];b.typedata=d;return a.resource.createModel(b)})},getAttributesToSave:function(){var a={};if(this.id){var b=this.resource.models[this.id];if(this.typename!=b.typename){var c=this.implAttris;if(c){for(var d=[],e=0,f=c.length;e<
f;e++){var g=c[e];d[e]=void 0!==this[g]?this[g]:null}this.typedata=d}d=this.attris}else d=this.fullAttris;e=0;for(f=d.length;e<f;e++)c=d[e],g=this[c],g!=b[c]&&"typedata"!=c&&(a[c]=g)}else{d=this.self.creationParams;c=this.implAttris||[];e=0;for(f=d.length;e<f;e++)b=d[e],a[b]=this[b];e=0;for(f=c.length;e<f;e++)b=c[e],a[b]=this[b]}return a},validate:function(a,b){a=a||this.getAttributesToSave();b=b||this.validationRules;var c=this,d=ssys.resolve(),e=null,d=ssys.loopDefer(a,null,function(d,g){var h=
d[0],m=d[1],k=b[h];if(!k)return ssys.resolve(a);var k=k.slice(0),n=k.shift(),h=[h,m,a],h=h.concat(k);return c["validate"+n].apply(c,h).pipe(function(b){a[b.name]=b.data;return a},function(b){var c=b.name;b=b.error;e=e||{};e[c]=b;return ssys.resolve(a)})});return d.pipe(function(a){return e?ssys.reject(e):a})},validateNotNull:function(a,b){var c={name:a,data:b};return""===b||null===b||void 0===b?(c.error="\u4e0d\u80fd\u4e3a\u7a7a",ssys.reject(c)):ssys.resolve(c)},validateUnique:function(a,b){var c=
{name:a,data:b};return this.resource.isUnique(a,b).pipe(function(a){if(a)return ssys.resolve(c);c.error="\u4e0d\u80fd\u91cd\u590d";return ssys.reject(c)})},validateString:function(a,b,c,d,e,f){var g={name:a,data:b};if("string"==typeof b){c="Null"!=e?this.validateNotNull(a,b):ssys.resolve();var h=this;c=c.pipe(function(){return"Unique"==d?h.validateUnique(a,b):ssys.resolve(g)});return c.pipe(function(a){if(f){if(b.length<f)return a;a.error="\u5b57\u6570\u4e0d\u80fd\u8d85\u8fc7"+f;return ssys.reject(a)}return a})}if(null===
b)return c="Null"!=e?this.validateNotNull(a,b):ssys.resolve(g);g.error="\u8be5\u6570\u636e"+JSON.stringify(b)+"\u4e0d\u662fString";return ssys.reject(g)},validateImplType:function(a,b,c,d){a={name:a,data:b};if(-1<$.inArray(b,this.resource.typenames))return ssys.resolve(a);a.error="\u6ca1\u6709\u53eb"+b+"\u7684typename";return ssys.reject(a)},validateFloat:function(a,b,c,d){var e={name:a};if(""===b||null===b||void 0===b)return e.error="\u4e0d\u80fd\u4e3a\u7a7a",ssys.reject(e);if((b=parseFloat(b))||
0===b){if(d)return this[d](b,c,e,a);e.data=b;return ssys.resolve(e)}e.error="\u8f93\u5165\u7684\u6570\u636e\u4e0d\u662f\u6570\u503c";return ssys.reject(e)},validateModel:function(a,b,c,d,e,f){var g=this,h={name:a};if(!b){if("Null"==f)return ssys.resolve(h);h.error="\u4e0d\u80fd\u4e3a\u7a7a";return ssys.reject(h)}d=this.app.getResource(d);f=typeof b;if("string"==f||"number"==f){var m=parseInt(b);d=d.pipe(function(a){return a.getModel(m)})}else"object"==f&&(d=d.pipe(function(a){return a.getModelByAttributes(b)}));
return d.pipe(function(d){if(e)return g[e](b,c,h,a);h.data=d.id;return h},function(){h.error="\u6ca1\u6709\u627e\u5230\u5bf9\u5e94\u7684\u6570\u636e";return h})},isEditable:function(a){return-1<$.inArray(this.userRelation,this.editableConfigs.editableRoles)?a?-1==$.inArray(a,this.editableConfigs.uneditable)?!0:!1:!0:!1},update:function(a){var b=this;return this.validate(a).pipe(function(){return b.app.post("/"+b.resource.name+"/update.json",{id:b.id,SsysUpdateParams:ssys.jsonEncode(a)}).pipe(function(a){ssys.cache[b.getUrl()]=
a;return b.typename!=b.shortClassname&&b.typename?b.resource.modelClass[b.typename].create(a):b.pull(a)})})},getUrl:function(){return this.app.isWidget?this.app.baseUrl+this.resource.name+"/"+this.id+"."+this.app.format:"/"+this.resource.name+"/"+this.id+"."+this.app.format},pull:function(a){var b=this;return a?(b.setTuple(a),b.init(),this!==this.resource.models[this.id]&&b.resource.models[b.id].pull(a),ssys.resolve(b)):this.resource.getDataByUrl(this.id,{refresh:$.now()}).pipe(function(a){b.setTuple(a);
b.init();b!==b.resource.models[b.id]&&b.resource.models[b.id].pull(a);return b})},setTuple:function(a){this.tuple=a;for(var b in a)this[this.attris[b]]=a[b];"string"==typeof this.id&&(this.id=parseInt(this.id));this.implAttris&&this.impl()},getUserRelation:function(){var a=this.app.currentUser;void 0===this.userRelation&&(this.userRelation=a.isGuest?"guest":a.id==this.creator_id?"creator":"admin"==a.userModel.role?"admin":this._getUserRelation(a));return this.userRelation},
_getUserRelation:function(a){return null},getModelViewClass:function(){return this.ModelView=this.resource.ModelView},createArchetype:function(){this.typename!=this.resource.models[this.id].typename&&(this.typedata=null);var a=ssys.mapToList(this,this.attris),a=this.resource.getModelByTuple(a,!0);a.isArchetype=!0;return a}},{create:function(a,b){if(b)var c=new this;else{var d=a[0],c=new this;if(c.resource.models[d])return c.resource.models[d]}c.setTuple(a);c.fullAttris=c.attris.concat(c.implAttris||
[]);c.init();b||(c.resource.models[c.id]=c);return c}},"Model");$$.Collection=$$.Resource.Collection=$$.O.createSubclass({format:"json",update:function(){},sort:function(){},storeModels:function(a,b){return this.cache[a]=b},getModels:function(a){if(this.cache[a])return this.cache[a];console.error(this,"\u7b2c",a,"\u9875\u7684\u6570\u636e\u4e3a\u7a7a!\u8bf7\u68c0\u67e5\u662f\u5426\u5df2\u7ecf\u52a0\u8f7d\u4e86\u8be5\u9875.")},getModel:function(a,b){var c=this.getModels(a);if(c[b])return c[b];console.error(this,"\u7b2c",a,"\u9875\u4e0a\u4e0d\u5b58\u5728\u7b2c",
b,"\u4e2amodel!")},fetch:function(a){var b=this;return $$.dfdget(this.cache[a],function(){return b._fetch(a).pipe(function(c){b.storeModels(a,c);return c})})},_fetch:function(a){var b=this.attris;a={page:a||1,limit:this.limit||20,order:this.order||"id",condition:this.condition||""};if(b){var c="getItemsByAttributes."+this.format;a.attris=b}else this.action?(c=this.action+"."+this.format,$$.mergeObject(a,this.params)):console.error("\u76ee\u524d\u53ea\u652f\u6301attris\u548caction\u4e24\u79cd\u7c7b\u578b\u7684collection!");
return this.resource.getModelsByUrl(c,a)},fetchSum:function(){var a=this;if(this.attris)var b="getItemsByAttributes."+this.format,c={attris:this.attris,returnsum:1};else this.action?(b=this.action+"."+this.format,c=$$.clone(this.params),c.returnsum=1):console.error(this,"fetchSum\u51fa\u9519\u4e86!\u8fd8\u672a\u4e3a\u8fd9\u4e2a\u7c7b\u578b\u7684collection\u5199\u600e\u4e48fetchSum\u903b\u8f91");return this.resource.getDataByUrl(b,c).pipe(function(b){return a.sum=b})}},{create:function(a){a=a||{};
o=new this;a.action?(o.action=a.action,delete a.action):(o.attris=a.attris||{},delete a.attris);if(a.path){var b=a.path;delete a.path}else{o.action?b="a_"+o.action:o.attris&&(b="attris");var c=JSON.stringify(a);"{}"!=c&&(b+=c)}(c=o.resource)||console.error(o,"\u7684resource\u4e0d\u5b58\u5728!\u8bf7\u68c0\u67e5\u8be5resource\u7684\u5b9a\u4e49\u4ee3\u7801\u6709\u65e0\u9519\u8bef");if(c.collections[b])return c.collections[b];o.params=a;for(var d in a)o[d]=a[d];o.cache={};return c.collections[b]=o}});$$.ModelView=$$.Resource.ModelView=$$.View.DataBinding.createSubclass({style:"ssysModelView",datas:{model:"model"},mg_elementConfigs:{content:["Div",[null,null,"${model.content}"]],showDetailsLink:["IconLink",["showDetails","ellipsis-h","<strong>\u67e5\u770b\u66f4\u591a\u7ec6\u8282</strong>"]],hideDetailsLink:["IconLink",["hideDetails","eye-slash","\u6536\u8d77\u7ec6\u8282",["showDetailsLink","after"]]],details:["Div",[["footer","before"],"well","${model.details}"]],userLink:["UserLink",["${model.creator_id}",
"","small",null,"pull-left",null,"media-object"]],titleLink:["Link",["#userResource/${model.creator_id}","${model.creator_username}","#${fullname} .media-heading"]],creatorLink:["Link",["#userResource/${model.creator_id}","${model.creator_username}"]],createdAt:["Time",["${model.created_at}"]],renew:["${archetype.ModelView.CreateView}",["${resourceView}","${archetype}"]],renewButton:["Button",["renew","pencil","\u4fee\u6539",null,"${editLinkCssClass}","","warning","sm"]],editLink:["IconLink",
["edit","pencil","\u7f16\u8f91",null,"${editLinkCssClass}"]],uneditLink:["Link",["unedit","\u53d6\u6d88\u7f16\u8f91\u72b6\u6001",null,"ssysUneditLink"]],hideCommentsLink:["IconLink",["hideComments","comment","\u6536\u8d77\u8bc4\u8bba(${model.descendantcount})",null,"ssysHide"]],commentsLink:["IconLink",["comments","comment-o","\u8bc4\u8bba(${model.descendantcount})"]],comments:["app/r_comment/view/subjectComments/ascComments",["${this}"]],create:["CreateView"]},mg_showConfigRules:[[/^$|^index/,
["$l{resource.name}${model.id}"]]],mg_showConfigs:{hideComments:[null,"hideComments"],edit:[null,"edit"],unedit:[null,"unedit"]},beforeInit:function(a){"object"!=typeof a&&(a=this.resource.models[a]);this.model=a;return this._beforeInit()},_beforeInit:function(){},showDetails:function(){this.elements.details?this.showElements(["details","hideDetailsLink"]):this.showByConfigs(["details","hideDetailsLink"]);this.elements.showDetailsLink.hide()},hideDetails:function(){this.hideElements(["details","hideDetailsLink"]);
this.showElements(["showDetailsLink"])},get_showedDetails:function(){return this.model.details?'<div id="${fullname}__details" class="alert alert-info col-md-11">${model.details}</div>':""},get_detailsConfig:function(){return this.model.details?'<a id="${fullname}__showDetailsLink" class="showDetailsLink"/>':'<a id="${fullname}__showDetailsLink" class="showDetailsLink hidden"/>'},commentsToggler:'<a id="${fullname}__commentsLink" href="comments" class="ssysLink"><span class="fa fa-comment-o"/>\u8bc4\u8bba(${model.descendantcount})</a><a id="${fullname}__hideCommentsLink" href="hideComments" class="ssysLink ssysHide"><span class="fa fa-comment"/>\u9690\u85cf\u8bc4\u8bba(${model.descendantcount})</a>',
get_renewButtonConfig:function(){return this.isEditable?'<button id="${fullname}__renewButton"/>':'<button id="${fullname}__renewButton" class="ssysHide"/>'},filter_edit:function(a){this.addClass("ssysEditing");this.elements.editLink.hide();this.elements.uneditLink.show();return""},filter_unedit:function(a){this.removeClass("ssysEditing");this.elements.uneditLink.hide();this.elements.editLink.show();return""},filter_renew:function(a){this.archetype||(this.archetype=this.model.createArchetype());return a},
after_comments:function(){var a=$("#"+this.fullname+"__commentsLink"),b=$("#"+this.fullname+"__hideCommentsLink");a&&(b.show(),a.hide());this.elements.comments?this.elements.comments.domnode.show():this.showByConfig("comments")},hideComments:function(){var a=$("#"+this.fullname+"__commentsLink");$("#"+this.fullname+"__hideCommentsLink").hide();a.show();this.elements.comments.domnode.hide();this.state="hideComments"},getCreatorLabel:function(){return this.model.creator_id==(this.app.currentUser.userModel?
this.app.currentUser.userModel.id:"")?"\u6211":this.model.creator_username},afterSave:function(){}},{ex_ListItem:{affectParent:!1,defaultState:"start",tag:"li",style:"ssysModelView list-group-item",beforeInit:function(a,b){a=parseInt(a);b=parseInt(b);var c=this.collection=this.parent.collection;c?this.model=this.collection.getModel(a,b):console.error(this.fullname,"\u7684collection\u4e0d\u5b58\u5728!");this.page=a;this.index=(a-1)*c.limit+b+1;return this._beforeInit()}}},"ModelView");$$.Resource.ResourceView=$$.View.createSubclass({mg_elementConfigs:{create:["${resource.CreateView}"]},title:" ",modelListClass:"panel panel-default",emptyInfo:"\u5f53\u524d\u5217\u8868\u662f\u7a7a\u7684",elementConfigRules:[[/^modelView/,["${model.ModelView}",["${model}","${this}"]]]],inputs:{},stageConfigRules:[[/^(\d+)$/,"modelView$1"]],initShow:[],indexShow:["modelList"],mg_filterConfigs:{create:["logged"]},mg_filterConfigRules:[[/^(\d+)\/?/,"model"],[/update\/(\d+)/,"update"],
[/cancel/,"cancel"]],limit:20,afterCancelState:"<",filter_cancel:function(a){this.cleanForNextCreation();return this.afterCancelState},filter_update:function(a){var b=a.match(/^update\/(\d+)/)[1],c=this;return this.resource.$$(""+b).pipe(function(b){c.model=b;return a})},cleanForNextCreation:function(){this.elements.create.domnode.empty();delete this.elements.create;"create"==this.state&&(this.state="start",this.stage=this.domnode);this.typename=null},filter_index:function(a){a=a.split("/");a.shift();
var b=this.limit=a.shift()||this.limit,c=this.page=a.shift()||1;a=this.order=this.order||a.shift();var d=this;return this.getModels(c,b,a).pipe(function(a){d.models=a||[];d.sum=a.sum||a.length;return d.state="index/"+b+"/"+c},function(){console.error(d.fullname,"getModels \u5931\u8d25\u4e86, \u8bf7\u68c0\u67e5\u5bf9\u5e94\u7684 getModels \u4ee3\u7801\u662f\u5426\u6709\u9519!");return d.state="index/error"})},getModels:function(a,b,c,d){return this.resource.getModelsByAttributes({},a,b,c,null,null,
d)},getModelsFromStorage:function(a,b,c){var d=this;return this.loadStorage().pipe(function(){var e=d.getSortedModels(c);d.models=e.slice((a-1)*b,a*b);d.models.sum=e.length;return d.models})},getSortedModels:function(a){},filter_model:function(a){var b=a.split("/").shift(),c=this;return this.resource.getModel(b).pipe(function(b){c.model=b;return a})},_afterSetState:function(){this.elements.menu&&this.redrawMenu(this.showedState)}},{SelectTypeView:$$.View.createSubclass({style:"ssysSelectType",defaultSteps:["",
"selected"],elementConfigs:{steps:["SsysPlayer",["\u4e0a\u4e00\u6b65","\u4e0b\u4e00\u6b65",null,!0]]},affectParent:!0,mg_showConfigs:{index:["\u9009\u62e9\u7c7b\u578b",null,["typenameInput","steps"]],selected:[null,"selected"]},beforeInit:function(a){this.resourceView=a||this.parent;this.resource=this.resourceView.resource},filter_selected:function(a){this.updateInputData();this.resourceView.typename=this.inputData.typename;return[this.parent,"create"]},_afterSetState:function(){this.elements.steps.update()}}),
ModelInput:$$.View.Input.createSubclass({beforeInit:function(a,b,c,d,e){this.resourceLabelName=this.getLabel(a);this.keyAttribute=b;this.html("<label>"+c+"</label><input name='"+b+"' value='"+(e||"")+"'/><div class='help-block'>"+(d||"")+"</div>")},showError:function(a){a="\u6ca1\u6709"+this.getLabel(this.keyAttribute)+"\u4e3a"+this.value+"\u7684"+this.resourceLabelName;this.addClass("has-error");this.append('<label class="control-label" for="inputError">'+a+"</label>")},updateInputData:function(){var a=
this.keyAttribute,b=this.value=this.find("input").val();if("id"!=a){var c={};c[a]=b}else c=b;return this.inputData=c}})},"ResourceView");$$.Resource.CollectionView=$$.View.DataBinding.createSubclass({defaultState:"1",template:'${head}${body}<ul e="list" class="list-group"></ul><div class="panel-footer">${e~paginator}</div>',mg_elementConfigs:{refreshButton:["Button",["../refresh/index","refresh","\u5237\u65b0\u5217\u8868","panelHead/>h3","pull-right",null,null,"xs"]],paginator:["Paginator",["${sum}","${limit}"]],emptyInfo:["Div",[null,"alert alert-info","${emptyInfo}"]]},initShow:["paginator"],mg_showConfigRules:[[/^(\d+)/,
"m__getPageItems"]],mg_filterConfigRules:[[/^(\d+)/,["fetchPageItems"]]],mg_elementConfigRules:[[/^item(\d+)_(\d+)/,["${ItemView}",["$1","$2"],"list"]]],style:"default",renderStyle:function(){$$.addClass(this.domnode,"panel panel-"+this.style)},beforeInit:function(){this.getCollection();this.sum=this.collection.sum;this.limit=this.collection.limit},getPageItems:function(a){a=parseInt(a);for(var b=[],c=0,d=this.collection.getModels(a).length;c<d;c++)b.push("item"+a+"_"+c);return b},filter_fetchPageItems:function(a){return this.collection.fetch(a).pipe(function(){return a})},
getCollection:function(){if(this.collection)return this.collection;var a=this.collectionType||this.shortClassname,a=this.collectionParams?a+JSON.stringify(this.parseConfig(this.collectionParams)):a;return this.collection=this.resource.getCollection(a)},addNewModels:function(a){this.navigate(1);if(0<a.length){for(var b=[$("#"+this.fullname+"__list"),"prepend"],c=0,d=a.length;c<d;c++){var e=a[c],e=this.modelListViewClass.create(this,"modelListView"+e.id,b,[e,this]);e.domnode.addClass("list-group-item-success newModelView")}e.domnode[0].scrollIntoView()}},
get_head:function(){return this.noPanelHead?"":'<div class="panel-heading"><h3 class="panel-title">'+this.parseConfig(this.title)+'<button id="${fullname}__refreshButton"/><div class="menuZone pull-right"/></h3></div>'},get_body:function(){return this.panelContent?'<div class="panel-body">'+this.panelContent+"</div>":""},getItemViewClass:function(){var a=this.shortClassname.substring(0,this.shortClassname.length-1);return this.ItemView=ssys.eval(this.itemViewClassName||a,this.resource.ModelView.ListItem)||
this.resource.ModelView.ListItem},loadItems:function(a){this.clear();var b=(this.page-1)*this.limit;$("#"+this.fullname+"__list");for(var c=0,d=a.length;c<d;c++){var e=a[c];e.listIndex=c+b+1;this.ItemView.create(this,"modelListView"+e.id,[e,this])}return ssys.resolve()},onPageChange:function(a){this.setState(a)},clear:function(){$("#"+this.fullname+"__list").empty()},navigate:function(a){this.elements.paginator&&this.elements.paginator.navigate(a)},getDataByPath:function(a){return this.resource.getDataByPath(a)}},
{ex_DataTable:{elementConfigs:{paginator:["Paginator",["${sum}","${limit}"]],dataTable:["DataTable",["${columnConfigs}","${options}","${items}","${parent}"]]},indexShow:["dataTable","paginator"],beforeInit:function(a,b,c,d,e,f,g){this.columnConfigs=a;this.parentView=e||this.parent;this.resource=d||this.parentView.resource;this.sum=f||this.parentView.sum;this.limit=c||this.parentView.limit||20;this.options=b||{};this.items=g},loadItems:function(a){this.elements.dataTable.loadItems(a)},onPageChange:function(a){this.parentView.setState("index/"+
this.limit+"/"+a)},navigate:function(a){this.elements.paginator&&this.elements.paginator.navigate(a)}}},"CollectionView");$$.Resource.CreateView=$$.View.createSubclass({style:"ssysView createView",defaultSteps:["","finish"],elementConfigs:{steps:["SsysPlayer",["\u4e0a\u4e00\u6b65","\u4e0b\u4e00\u6b65",null,!0]],saveButton:["Button",["finish","\u786e\u5b9a",{type:"primary"}]],cancelButton:["Button",["../<","\u53d6\u6d88",{warning:"\u4f60\u786e\u5b9a\u8981\u53d6\u6d88\u5417?"}]],addDetailsButton:["Button",["addDetails","plus","\u8865\u5145\u7ec6\u8282\u548c\u8d34\u56fe"]],contentInput:["TextInput",["",null,null,null,{height:450,
width:850}]],detailsInput:["TextInput",["",null,null,null,{height:450,width:850}],"",["contentInput","after"]]},creationParams:{},affectParent:!1,mg_filterConfigs:{finish:"save"},mg_filterConfigRules:[[/^index/,[]],[/.*/,["validateInput"]]],beforeInit:function(a){var b=$$.clone(this.creationParams);this.model=a||this.resource.createModelArchetype(b);this.model.id&&(this.isRenew=!0);this.initInputData(this.model)},addDetails:function(){this.showByConfig("detailsInput");this.hideElements(["addDetailsButton"])},
filter_validateInput:function(a){var b=this;if(a==this.defaultState)return a;var c=this.updateInputData();this.setInputsToModel(c);return this.model.validate().pipe(function(){return a},function(c){return(c=b.removeTempErrors(c,a))?b.showErrors(c):ssys.resolve(a)})},removeTempErrors:function(a,b){if(this.getLastState()!=b){var c=0,d;for(d in a)this.find(":visible[name='"+d+"']")[0]?c++:delete a[d];if(0<c)return a}},filter_save:function(){var a=this,b=this.model,c=this.updateInputData();this.setInputsToModel(c);
return b.save().pipe(function(b){a.model=b;a.parent.cleanForNextCreation&&a.parent.cleanForNextCreation();return a.getAfterSaveState()},function(b){a.showErrors(b)})},afterRenewState:"../refresh/",getAfterSaveState:function(){return this.isRenew?this.afterRenewState:this.afterSaveState||"../"+this.model.id},updateInputData:function(){var a=this.parentCall("updateInputData");return ssys.removeUndefined(a)},setInputsToModel:function(a){var b=this.model,c;for(c in a)b[c]=a[c]}});$$.App.createSubclass({name:"pandingbao",libs:[]},{xp_Layout:{style:"noise ui-widget-content",template:"",mg_elementConfigs:{stage:["Html",['<div class="container"></div>']],navbar:["Navbar",[[["#","\u9996\u9875"],["#execution","\u6267\u884c\u60c5\u51b5"],["#message","\u6d88\u606f"]],{cssClass:"navbar-inverse navbar-fixed-top"}]],footer:["Html",['<div class="container text-center"><p class="text-muted"><div><label>\u8054\u7cfb\u6211\u4eec<label>:xxxx@xxxx</div><div><a href="http://www.miitbeian.gov.cn/" target="_blank">\u6caaICP\u590714003855\u53f7</a></div></p></div>']]},
initShow:["navbar","stage","footer"],loadConfigs:{index:["user/MoralStars","kase/VerdictingKases","kase/ConvictedKases"]},mg_filterConfigRules:[[/^p_session\/login$/,["isGuest","page"]],[/^index|^p_([\w:]+)/,["logged","page"]],[/.*/,["logged"]]],filter_isGuest:function(a){return this.app.currentUser.id?ssys.reject("index"):a},onLogin:function(){this.elements.navbar.onLogin();if(this.elements.home)this.elements.home.onLogin();if(this.elements.kaseResource)this.elements.kaseResource.onLogin();
if(this.elements.messageResource)this.elements.messageResource.onLogin();if(this.elements.session)this.elements.session.onLogin()},beforeInit:function(){var a=this;$(window).hashchange(function(){var b=a.getStateByAnchor();b!=a.state&&a.setState(b)})},_afterSetState:function(){ssys.setAnchor(this.state);this.elements.navbar.activate(null,"#"+this.state)},createPanel:function(a,b,c,d,e,f){return this.createHtml(a,'<div class="panel panel-'+d+'"><div class="panel-heading"><h3 class="panel-title">'+
b+'</h3></div><div class="panel-body">'+c+"</div></div>",e)},createTime:function(a,b,c,d,e,f){return this.createDom(a,"span",d,"ssysTime"+(e||""),f).html(ssys.timeToString(b,c))},createUserLink:function(a,b,c,d){var e=d.version||"",f=this;a=this.createHtml(a,"<a href='#' data-state='#userResource/"+b+"' title='"+(d.tooltip||"")+"' class='userLink "+e+"UserLink "+(d.cssClass||"")+"'><img src='"+(this.app.storageBaseUrl+"photos/"+(e?e+"/":"")+b)+"' class='"+(d.imgClass||"")+"' /><span>"+c+"</span></a>");
$(".userLink img").one("error",function(){$(this).attr("src",f.app.staticBaseUrl+"img/single_photo/150.gif")});return a}},xp_Resource:[{},{xp_CollectionView:{beforeInit:function(){this.parentCall("beforeInit");this.ItemView=this.getItemViewClass();0==this.sum?this.initShow=this.emptyInfo?["emptyInfo","refreshButton"]:["refreshButton"]:(this.initShow=ssys.clone(this.initShow),this.title&&this.initShow.push("refreshButton"))}}}]},"Pandingbao");window.pandingbao=$$.App.Pandingbao.create();pandingbao.addResource("message",{xp_Model:[{attris:"id content creator_id creator_username receiver_id receiver_username created_at updated_at parent_id subject_id".split(" "),validationRules:{content:["String",null,null,260]}},{creationParams:["content","receiver_id","parent_id"]}],xp_Collection:{},xp_ResourceView:[{template:"hi"},{}],xp_CollectionView:[{},{}],xp_ModelView:[{},{}],xp_CreateView:[{},{}]});pandingbao.addResource("kase",{collectionConfigs:{MyCurrentKases:{action:"myCurrentKases",order:"created_at DESC",limit:5},BeforeVerdictKases:{attris:{status:["p2","d1","d2"]},order:"created_at DESC",limit:5},VerdictingKases:{attris:{status:"verdicting"},order:"verdicted_at DESC",limit:5},ConvictedKases:{action:"convictedKases",order:"convicted_at DESC",limit:5}},xp_Model:{attris:"id name status verdicted_at defendant_id defendant_username verdict_count creator_id creator_username created_at updated_at".split(" "),
creationParams:["defendant_username"],validationRules:{name:["String",null,"Null",100],defendant_username:["String",null,null,60]},relations:{facts:["hasMany","app/r_fact","kase_id"],defendant:["belongTo","app/r_party","defendant_id"]},getModelViewClass:function(){var a=this.resource.ModelView;return this.ModelView=this.convicted_at?a.Convicted:this.verdicted_at?a.Verdicting:a.BeforeVerdict},iAmReady:function(){return this.resource.getDataByAction("ready",{id:this.id})},claim:function(a){return this.resource.getDataByAction("claim",
{id:this.id,claim:a})},defend:function(){return this.resource.getDataByAction("defend",{id:this.id})},counterclaim:function(){return this.resource.getDataByAction("counterclaim",{id:this.id,refresh:$.now()})},reconcile:function(){return this.resource.getDataByAction("reconcile",{id:this.id})},_getUserRelation:function(a){if(this.defendant_username==a.username)return"defendant"},convict:function(){return this.resource.getDataByAction("convict",{id:this.id})}},xp_Collection:{},xp_ResourceView:[{},
{AppealInput:{defaultState:"create",mg_filterConfigs:{create:["beforeCreateArchetype","createArchetype","afterCreateArchetype"]}}}],xp_CollectionView:[{},{ex_admin:{mg_elementConfigs:{deleteButton:["Button",["delete",null,"\u5220\u9664\u52fe\u9009\u7684\u6295\u8bc9",null,"text-center",null,"danger",null,"\u4f60\u786e\u5b9a\u8981\u5220\u9664\u5417?"]],dataTable:["ResourceDataTable",["${columnConfigs}"]]},columnConfigs:[["\u540d\u79f0","name","ModelLink"],["\u521b\u5efa\u65f6\u95f4","created_at","Time"],
["\u52fe\u9009","id","Checkbox","checkKase","10%"]],indexShow:["dataTable","deleteButton"],afterInit:function(){this.checkedKases={}},checkKase:function(a,b){a.checked?this.checkedKases[b.id]=b:delete this.checkedKases[b.id]},filter_delete:function(){var a=$.map(this.checkedKases,function(a){return a.id});return 0==a.length?(alert("\u4f60\u6ca1\u6709\u52fe\u9009\u8981\u5220\u9664\u7684\u6295\u8bc9"),ssys.reject("index")):this.app.resources.kase.deleteAll(a).pipe(function(){alert("\u5df2\u7ecf\u6210\u529f\u5220\u9664\u4e86\u4f60\u6240\u52fe\u9009\u7684"+
a.length+"\u4e2a\u6295\u8bc9");return ssys.reject("refresh/index")},function(){alert("\u53ef\u80fd\u56e0\u4e3a\u7f51\u7edc\u539f\u56e0, \u5220\u9664\u5931\u8d25\u4e86, \u8bf7\u518d\u8bd5\u4e00\u6b21");return ssys.reject("index")})}},ex_UserKases:{beforeInit:function(a){this.user=a||this.app.currentUser.userModel},collectionParams:{userid:"${user.id}"}},ex_MyCurrentKases:{title:"\u6211\u7684\u5f53\u524d\u6295\u8bc9",style:"warning"},ex_BeforeVerdictKases:{title:"\u7533\u8ff0\u4e2d\u7684\u6295\u8bc9"},
ex_VerdictingKases:{title:"\u6b63\u5728\u5224\u5b9a\u4e2d\u7684\u6295\u8bc9"},ex_ConvictedKases:{title:"\u5df2\u5b8c\u7ed3\u7684\u6295\u8bc9",style:"success"}}],xp_ModelView:[{affectParent:!1,style:"ssysModelView PrivateKase col-lg-10 col-lg-offset-1",mg_elementConfigs:{status:["Div",[null,"alert alert-info"]],claimInput:["TextInput",[""],"claimInput"],claim:["Dom",["h4",null,"claim","${model.creator_username}\u7684\u7d22\u8d54\u8981\u6c42: ${defendant.claim}"]],info1:["Dom",["h3","status",
"info1","${info1}"]],buttonList:["Div",[["status","before"],"buttonList"]],verdicts:["app/r_verdict/view/partyVerdicts",["${defendant}"]],verdicts1:["app/r_verdict/view/partyVerdicts",["${defendant}"],null,["buttonList","before"]],myVerdict:["app/r_verdict/view/myVerdict",["${myVerdict}"]],verdictButton:["Button",["${verdictButtonState}",null,"${verdictLabel}","buttonList","text-center",null,"primary","lg"]],cancelMyVerdictButton:["Button",["cancelMyVerdict",null,"\u53d6\u6d88\u5224\u5b9a","buttonList",
"text-center"]],addClaimButton:["Button",["claim","check","\u6dfb\u52a0\u7d22\u8d54\u8981\u6c42","buttonList"]],counterclaimButton:["Button",["counterclaim","notice","${counterclaimLabel}","buttonList"]],defendFacts:["app/r_fact/view/privateKaseFacts",["${model}"],null,"dialog"],defendButton:["Button",["defendFacts/create","comment","\u7533\u8fa9","buttonList",null,null,"primary"]],addFactButton:["Button",[["${elements.facts.elements.create}","finish"],"check","${addFactButtonLabel}","buttonList",
null,null,"primary"]],readyButton:["Button",["ready","check","${readyButtonLabel}","buttonList",null,null,"warning"]],reconcileButton:["Button",["reconcile","${reconcileIcon}","${reconcileButtonLabel}","buttonList",null,null,"success"]],info2:["Div",["status",null,"${info2}"]],info3:["Panel",["\u8bc4\u5224\u5458\u987b\u77e5","<h3>${info3}</h3>","info",["buttonList","before"]]],factsContainer:["Div",[null,"factsContainer"]],facts:["app/r_fact/view/privateKaseFacts",["${model}"]],plaintiffFacts:["app/r_fact/view/plaintiffFacts",
["${model}"],null,"factsContainer"],defendantFacts:["app/r_fact/view/defendantFacts",["${model}","${defendant}"],null,"factsContainer"],withdrewNotice:["Dom",["h3","status",null,"${withdrewNotice}"]]},template:'<h2 class="ssysTitle page-header">${model.name}<small e="createdAt" class="pull-right"/></h2>',_beforeInit:function(){var a=this;this.verdicted_at=ssys.timeToString(this.model.verdicted_at);"creator"==this.model.userRelation?this.isPlaintiff=!0:this.model.defendant_username==this.app.currentUser.username?
this.isDefendant=!0:this.app.currentUser.id&&"convicted"==this.model.status&&(this.initDatas=this.initDatas.concat(['/verdict/findByAttributes.${app.format}?attris={"party_id":${model.defendant_id},"creator_id":${app.currentUser.id}}']));"convicted"==this.model.status&&(this.initDatas=this.initDatas.concat(['/verdict/getItemsByAttributes.${app.format}?attris={"typename":"PersonVerdict","party_id":${model.defendant_id}}&page=1&limit=300&order=created_at DESC&condition=']));return this.app.fetchDatas(this.parseConfig(this.initDatas)).pipe(function(){return a.model.$$("defendant").pipe(function(b){a.defendant=
b;if(a.defendant.convicted_at)if(a.convicted_at=ssys.timeToString(a.defendant.convicted_at),!a.app.currentUser.id||a.isPlaintiff||a.isDefendant)a.verdictLabel="\u6211\u8981\u5224\u5b9a";else return a.defendant.getMyVerdict().pipe(function(b){a.myVerdict=b;a.verdictLabel="\u6211\u7684\u5224\u5b9a"},function(){a.verdictLabel="\u6211\u8981\u5224\u5b9a";return ssys.resolve()})}).pipe(function(){a.initShow=a.getInitConfigs()})})},getInitConfigs:function(){var a="dialog menu createdAt facts status buttonList".split(" "),
b=this.model.status;this.getStatusParams();if(b.match(/^withdrew/))a.push("info1");else if("verdicting"==b)a.push("info1"),a.push("info3"),this.info1="\u5df2\u7ecf\u6709${model.verdict_count}\u4eba\u53c2\u4e0e\u4e86\u5224\u5b9a, \u5f53\u4eba\u6570\u8fbe\u523060\u4ee5\u4e0a\u65f6, \u4f1a\u516c\u5e03\u7ed3\u679c",this.info3="\u4efb\u4f55\u4e00\u6b21\u7f51\u8d2d\u7ea0\u7eb7\u90fd\u5236\u9020\u4e86\u7f51\u8d2d\u7fa4\u4f53\u7684\u5185\u8017\uff0c\u6240\u4ee5\u5236\u9020\u4e86\u8be5\u7ea0\u7eb7\u7684\u8fc7\u9519\u65b9\u5e94\u8be5\u627f\u62c51\uff1b\u5411\u6b64\u6b21\u5185\u8017\u7684\u53d7\u5bb3\u65b9\u7ed9\u4e88\u76f8\u5e94\u7684\u8d54\u507f\uff0c2;\u56e0\u4e3a\u9020\u6210\u4e86\u7f51\u8d2d\u7fa4\u4f53\u5185\u8017\u4e0e\u6076\u5316\u7f51\u8d2d\u73af\u5883\u800c\u88ab\u76f8\u5173\u7684\u516c\u5171\u6743\u5a01\u673a\u6784\u60e9\u5904\u3002\u8d54\u507f\u6216\u60e9\u5904\u7684\u5185\u5bb9\u53ef\u4ee5\u662f\u591a\u79cd\u5f62\u5f0f\uff0c\u4f8b\u5982\u9053\u6b49\u3001\u4e2d\u6b62\u4e00\u6bb5\u65f6\u671f\u7684\u4ea4\u6613\u6743\u3001\u6263\u51cf\u8fc7\u9519\u4eba\u7684\u5404\u7c7b\u8363\u8a89\u661f\u94bb\u7b49\u7b49\u3002\u4f46\u672c\u5e73\u53f0\u76ee\u524d\u53ea\u652f\u6301\u4ee5\u8d27\u5e01\u652f\u4ed8\u4e3a\u5185\u5bb9\u7684\u8d54\u507f\u4e0e\u60e9\u5904\u5f62\u5f0f\u3002\u53ea\u8981\u7ea0\u7eb7\u5f53\u4e8b\u4eba\u90fd\u627f\u8bfa\u63a5\u53d7\u516c\u8bc4\u7f51\u5e73\u53f0\u7684\u88c1\u51b3\uff0c\u90a3\u4e48\u672c\u5e73\u53f0\u7684\u8d54\u507f\u88c1\u51b3\u53ef\u671b\u5f97\u5230\u843d\u5b9e\uff0c\u56e0\u6b64\u672c\u5e73\u53f0\u4e3b\u8981\u4ee5\u6b64\u5185\u5bb9\u4e3a\u76ee\u6807\u6765\u5408\u6210\u7fa4\u4f53\u7684\u7efc\u5408\u610f\u613f\u3002\u672c\u5e73\u53f0\u4f9d\u7136\u6536\u96c6\u8bc4\u5224\u5458\u7ed9\u4e88\u8fc7\u9519\u65b9\u7684\u60e9\u5904\u8d4b\u503c\uff0c\u5e76\u4f9d\u6b64\u5f62\u6210\u7fa4\u4f53\u7684\u76f8\u5173\u88c1\u51b3\u66f2\u7ebf\u3002\u4f46\u8be5\u9879\u5185\u5bb9\u4ec5\u4ec5\u7ed9\u5927\u5bb6\u63d0\u4f9b\u4e00\u4e2a\u53c2\u8003\u6570\u636e\u3002\u656c\u8bf7\u8bc4\u5224\u5458\u8ba4\u771f\u586b\u5199\u3002",
this.isPlaintiff||this.isDefendant||(this.myVerdict?(this.verdictButtonState="verdicts/"+this.myVerdict.id,a.push("myVerdict")):(this.verdictButtonState="createMyVerdict",a.push("verdictButton")));else if("convicted"==b)a="menu createdAt facts status buttonList info1 info2 verdicts".split(" ");else{if("p1"==b)return a=this.isPlaintiff?"menu createdAt facts status buttonList info1 addFactButton reconcileButton info2".split(" "):["status","info1"];if("d1"==b)return this.isPlaintiff?a="menu createdAt facts status buttonList info1 info2".split(" "):
this.isDefendant&&(a=a.concat("info1 reconcileButton addFactButton readyButton counterclaimButton info2".split(" "))),a;if("p2"==b)return this.isPlaintiff?a=a.concat(["info1","reconcileButton","addFactButton","readyButton","info2"]):this.isDefendant&&(a="menu createdAt facts status buttonList info1 info2".split(" ")),a;if("d2"==b)return this.isPlaintiff?a="menu createdAt facts status buttonList info1 info2".split(" "):this.isDefendant&&(a=a.concat("info1 reconcileButton addFactButton readyButton counterclaimButton info2".split(" "))),
a;if(this.isPlaintiff&&b.match(/^p[12]$/)||this.isDefendant&&b.match(/^d[12]$/))a=a.concat(["addFactButton"]),b.match(/^p2|d1|d2$/)&&(a=a.concat(["readyButton"]));if(this.isPlaintiff||this.isDefendant)a=a.concat(["reconcileButton","info2"])}return a},createMyVerdict:function(){this.elements.verdictButton.hide();this.elements.cancelMyVerdictButton?this.elements.cancelMyVerdictButton.show():this.showByConfig("cancelMyVerdictButton");this.elements.verdicts1?this.elements.verdicts1.domnode.show():this.setState("verdicts1/create")},
cancelMyVerdict:function(){this.elements.verdictButton.show();this.elements.verdicts1.domnode.hide();this.elements.cancelMyVerdictButton.hide()},getStatusParams:function(){var a=this.model.status,b=this.model.creator_username,c=this.model.defendant_username,d="counterclaimed"==this.defendant.status?!0:!1;this.reconcileIcon="heart";this.reconcileButtonLabel="\u540c\u610f\u548c\u89e3";this.addFactButtonLabel="\u63d0\u4ea4\u7533\u8ff0";this.readyButtonLabel="\u9a6c\u4e0a\u5224\u5b9a";this.counterclaimLabel=
d?"\u53d6\u6d88\u53cd\u6295\u8bc9":"\u53cd\u6295\u8bc9";"p1"==a?this.isPlaintiff?(this.reconcileButtonLabel="\u53d6\u6d88\u6295\u8bc9",this.reconcileIcon="times",this.info2="\u4f60\u548c\u5bf9\u65b9\u5404\u6709\u4e24\u6b21\u7533\u8ff0\u7684\u673a\u4f1a, \u8fd9\u662f\u4f60\u7684\u7b2c\u4e00\u6b21\u7533\u8ff0, \u7533\u8ff0\u5b8c\u6bd5\u540e\u5bf9\u65b9\u624d\u80fd\u5f00\u59cb\u7533\u8ff0, \u7136\u540e\u7b49\u5bf9\u65b9\u7533\u8ff0\u5b8c\u6bd5\u4f60\u624d\u53ef\u4ee5\u5f00\u59cb\u7b2c\u4e8c\u6b21\u7533\u8ff0, \u7136\u540e\u662f\u5bf9\u65b9\u7684\u7b2c\u4e8c\u6b21\u7533\u8ff0, \u53cc\u65b9\u7533\u8ff0\u5b8c\u6bd5\u5c31\u5f00\u59cb\u5224\u5b9a\u4e86. \u4f60\u4f5c\u4e3a\u6295\u8bc9\u53d1\u8d77\u4eba\u7684\u7b2c\u4e00\u6b21\u7533\u8ff0\u5c24\u4e3a\u91cd\u8981, \u5e94\u8be5\u5c3d\u91cf\u5c06\u6574\u4e2a\u7ea0\u7eb7\u8fc7\u7a0b\u7684\u4e8b\u5b9e\u901a\u8fc7\u6709\u529b\u7684\u8bc1\u636e\u7ed9\u4e88\u5b8c\u6574\u8fd8\u539f, \u540c\u65f6\u63d0\u51fa\u4f60\u7684\u7d22\u8d54\u8981\u6c42, \u5982\u679c\u4e59\u65b9\u653e\u5f03\u5e94\u8bc9\u6216\u903e\u671f\u6ca1\u6709\u5e94\u8bc9, \u5219\u7acb\u5373\u5f00\u59cb\u5224\u5b9a. ",
this.info1="\u53ea\u6709\u5f53\u4f60\u5b8c\u6210\u8fd9\u6b21\u7533\u8bc9\u65f6, \u6295\u8bc9\u624d\u7b97\u771f\u6b63\u5f00\u59cb\u4e86"):this.info1="\u7532\u65b9\u7684\u7b2c\u4e00\u6b21\u7533\u8ff0\u90fd\u8fd8\u6ca1\u5b8c\u6bd5, \u6295\u8bc9\u8fd8\u6ca1\u5f00\u59cb":"d1"==a?this.isDefendant?(this.info1=b+"\u6295\u8bc9\u4e86\u4f60, \u4f60\u5fc5\u987b\u5728"+this.verdicted_at+"\u4e4b\u524d\u505a\u51fa\u56de\u5e94",this.info2="\u4f60\u53ef\u4ee5\u9009\u62e94\u79cd\u56de\u5e94\u65b9\u5f0f, \u4e00\u79cd\u662f\u540c\u610f\u548c\u89e3, \u4e00\u79cd\u662f\u7533\u8fa9, \u4e00\u79cd\u662f\u9a6c\u4e0a\u5224\u5b9a, \u4e00\u79cd\u662f\u53cd\u6295\u8bc9. \u540c\u610f\u548c\u89e3\u8868\u793a\u4f60\u613f\u610f\u63a5\u53d7\u5bf9\u65b9\u7684\u7d22\u8d54\u8981\u6c42, \u6295\u8bc9\u7ed3\u675f.  \u7533\u8fa9\u8868\u793a\u4f60\u4e0d\u63a5\u53d7\u5bf9\u65b9\u7684\u7d22\u8d54\u8981\u6c42, \u53ef\u4ee5\u63d0\u51fa\u4f60\u7684\u8d54\u507f\u6761\u4ef6\u548c\u4f60\u7684\u4e3e\u8bc1, \u7b49\u5f85\u5bf9\u65b9\u56de\u5e94 . \u9a6c\u4e0a\u5224\u5b9a\u662f\u6307\u4f60\u4e0d\u505a\u7533\u8fa9, \u5224\u5b9a\u5c06\u9a6c\u4e0a\u5f00\u59cb. \u53cd\u6295\u8bc9\u662f\u6307\u4f60\u8ba4\u4e3a\u9519\u5728\u5bf9\u65b9, \u5411\u5bf9\u65b9\u63d0\u51fa\u7d22\u8d54\u8981\u6c42. "):
this.isPlaintiff&&(this.info1="\u60a8\u7684\u6295\u8bc9\u5df2\u7ecf\u751f\u6548, \u8bf7\u7b49\u5f85\u5bf9\u65b9\u7684\u56de\u5e94, \u6700\u8fdf\u5728"+this.verdicted_at+"\u4e4b\u524d\u4f1a\u5b8c\u6210",this.info2="\u5bf9\u65b9\u53ef\u4ee5\u9009\u62e94\u79cd\u56de\u5e94: \u4e00\u79cd\u662f\u540c\u610f\u548c\u89e3, \u4e00\u79cd\u662f\u7533\u8fa9, \u4e00\u79cd\u662f\u9a6c\u4e0a\u5224\u5b9a, \u4e00\u79cd\u662f\u53cd\u6295\u8bc9. \u540c\u610f\u548c\u89e3\u8868\u793a\u5bf9\u65b9\u613f\u610f\u63a5\u53d7\u4f60\u7684\u7d22\u8d54\u8981\u6c42, \u6295\u8bc9\u7ed3\u675f.  \u7533\u8fa9\u8868\u793a\u5bf9\u65b9\u4e0d\u63a5\u53d7\u4f60\u7684\u7d22\u8d54\u8981\u6c42, \u5e76\u63d0\u51fa\u65b0\u7684\u8d54\u507f\u6761\u4ef6\u548c\u4e3e\u8bc1. \u9a6c\u4e0a\u5224\u5b9a\u662f\u6307\u5bf9\u65b9\u4e0d\u505a\u7533\u8fa9, \u5224\u5b9a\u5c06\u9a6c\u4e0a\u5f00\u59cb. \u53cd\u6295\u8bc9\u662f\u6307\u5bf9\u65b9\u8ba4\u4e3a\u7ea0\u7eb7\u8d23\u4efb\u5728\u4f60, \u5411\u4f60\u63d0\u51fa\u7d22\u8d54\u8981\u6c42. \u5982\u679c\u5bf9\u65b9\u5728"+
this.verdicted_at+"\u4e4b\u524d\u4e0d\u505a\u51fa\u56de\u5e94, \u5224\u5b9a\u81ea\u52a8\u5f00\u59cb"):"p2"==a?this.isPlaintiff?(this.info1=d?c+"\u53cd\u6295\u8bc9\u4e86\u4f60, \u4f60\u5fc5\u987b\u5728"+this.verdicted_at+"\u4e4b\u524d\u505a\u51fa\u56de\u5e94":c+"\u5b8c\u6210\u4e86\u7b2c\u4e00\u6b21\u7533\u8ff0, \u4f60\u5fc5\u987b\u5728"+this.verdicted_at+"\u4e4b\u524d\u505a\u51fa\u56de\u5e94",this.info2="\u4f60\u53ef\u4ee5\u9009\u62e93\u79cd\u56de\u5e94\u65b9\u5f0f, \u4e00\u79cd\u662f\u540c\u610f\u548c\u89e3, \u4e00\u79cd\u662f\u7533\u8fa9, \u4e00\u79cd\u662f\u9a6c\u4e0a\u5224\u5b9a, \u540c\u610f\u548c\u89e3\u8868\u793a\u4f60\u613f\u610f\u63a5\u53d7\u5bf9\u65b9\u7684\u548c\u89e3\u6761\u4ef6, \u6295\u8bc9\u7ed3\u675f.  \u7533\u8fa9\u8868\u793a\u4f60\u4e0d\u63a5\u53d7\u5bf9\u65b9\u7684\u548c\u89e3\u6761\u4ef6, \u4f60\u53ef\u4ee5\u63d0\u51fa\u4f60\u7684\u65b0\u7684\u548c\u89e3\u6761\u4ef6\u548c\u4f60\u7684\u8865\u5145\u4e3e\u8bc1, \u7b49\u5f85\u5bf9\u65b9\u56de\u5e94 . \u9a6c\u4e0a\u5224\u5b9a\u662f\u6307\u4f60\u4e0d\u505a\u7533\u8fa9, \u5224\u5b9a\u5c06\u9a6c\u4e0a\u5f00\u59cb."):
this.isDefendant&&(this.info1="\u73b0\u5728\u7532\u65b9\u6b63\u5728\u8fdb\u884c\u6700\u540e\u7684\u56de\u5e94, \u6700\u8fdf\u5728"+this.verdicted_at+"\u4e4b\u524d\u4f1a\u5b8c\u6210",this.info2="\u5bf9\u65b9\u53ef\u4ee5\u9009\u62e93\u79cd\u56de\u5e94: \u4e00\u79cd\u662f\u540c\u610f\u548c\u89e3, \u4e00\u79cd\u662f\u7533\u8fa9, \u4e00\u79cd\u662f\u9a6c\u4e0a\u5224\u5b9a. \u540c\u610f\u548c\u89e3\u8868\u793a\u5bf9\u65b9\u613f\u610f\u63a5\u53d7\u4f60\u7684\u548c\u89e3\u6761\u4ef6, \u6295\u8bc9\u7ed3\u675f.  \u7533\u8fa9\u8868\u793a\u5bf9\u65b9\u4e0d\u63a5\u53d7\u4f60\u7684\u548c\u89e3\u6761\u4ef6, \u5e76\u63d0\u51fa\u65b0\u7684\u548c\u89e3\u6761\u4ef6\u548c\u4e3e\u8bc1. \u9a6c\u4e0a\u5224\u5b9a\u662f\u6307\u5bf9\u65b9\u4e0d\u505a\u7533\u8fa9, \u5224\u5b9a\u5c06\u9a6c\u4e0a\u5f00\u59cb.  \u5982\u679c\u5bf9\u65b9\u5728"+
this.verdicted_at+"\u4e4b\u524d\u4e0d\u505a\u51fa\u56de\u5e94, \u5224\u5b9a\u81ea\u52a8\u5f00\u59cb"):"d2"==a?this.isDefendant?(this.info1="\u5bf9\u65b9\u63d0\u51fa\u4e86\u65b0\u7684\u7533\u8ff0, \u4f60\u5fc5\u987b\u5728"+this.verdicted_at+"\u4e4b\u524d\u505a\u51fa\u56de\u5e94",this.info2="\u8fd9\u662f\u4f60\u7684\u6700\u540e\u4e00\u6b21\u56de\u5e94, \u4f60\u53ef\u4ee5\u9009\u62e94\u79cd\u56de\u5e94\u65b9\u5f0f, \u4e00\u79cd\u662f\u540c\u610f\u548c\u89e3, \u4e00\u79cd\u662f\u7533\u8fa9, \u4e00\u79cd\u662f\u9a6c\u4e0a\u5224\u5b9a, \u4e00\u79cd\u662f\u53cd\u6295\u8bc9. \u540c\u610f\u548c\u89e3\u8868\u793a\u4f60\u613f\u610f\u63a5\u53d7\u5bf9\u65b9\u7684\u7d22\u8d54\u8981\u6c42, \u6295\u8bc9\u7ed3\u675f.  \u7533\u8fa9\u8868\u793a\u4f60\u4e0d\u63a5\u53d7\u5bf9\u65b9\u7684\u548c\u89e3\u6761\u4ef6, \u4f60\u53ef\u4ee5\u63d0\u51fa\u4f60\u7684\u8d54\u507f\u6761\u4ef6\u548c\u4f60\u7684\u4e3e\u8bc1, \u4f9b\u5224\u5b9a\u5458\u53c2\u8003, \u5efa\u8bae\u5c06\u91cd\u70b9\u653e\u5728\u6307\u51fa\u5bf9\u65b9\u7533\u8ff0\u4e2d\u7684\u9519\u8bef\u4e0a, \u63d0\u4ea4\u7533\u8fa9\u540e\u5224\u5b9a\u9a6c\u4e0a\u5f00\u59cb. \u9a6c\u4e0a\u5224\u5b9a\u662f\u6307\u4f60\u4e0d\u505a\u7533\u8fa9, \u5224\u5b9a\u5c06\u9a6c\u4e0a\u5f00\u59cb. \u53cd\u6295\u8bc9\u662f\u6307\u4f60\u8ba4\u4e3a\u9519\u5728\u5bf9\u65b9, \u5411\u5bf9\u65b9\u63d0\u51fa\u7d22\u8d54\u8981\u6c42."):
this.isPlaintiff&&(this.info1="\u73b0\u5728\u4e59\u65b9\u6b63\u5728\u8fdb\u884c\u6700\u540e\u7684\u56de\u5e94, \u6700\u8fdf\u5728"+this.verdicted_at+"\u4e4b\u524d\u4f1a\u5b8c\u6210"):"verdicting"==a?this.info1="\u5224\u5b9a\u5df2\u7ecf\u5f00\u59cb\u4e86, \u5f53\u5224\u5b9a\u4eba\u6570\u8fbe\u523060\u4ee5\u4e0a\u65f6, \u4f1a\u516c\u5e03\u7ed3\u679c":"convicted"==a?this.info1="\u5224\u5b9a\u5728"+this.convicted_at+"\u7ed3\u675f\u4e86":"withdrew_p1"==a?this.info1=b+"\u5df2\u7ecf\u53d6\u6d88\u4e86\u8be5\u6295\u8bc9":
"withdrew_d1"==a?this.info1=c+"\u5df2\u7ecf\u540c\u610f"+b+"\u7684\u7d22\u8d54\u8981\u6c42, \u53cc\u65b9\u8fbe\u6210\u548c\u89e3":"withdrew_p2"==a?this.info1="counterclaimed"==this.defendant.status?b+"\u5df2\u7ecf\u540c\u610f"+c+"\u7684\u7d22\u8d54\u8981\u6c42, \u53cc\u65b9\u8fbe\u6210\u548c\u89e3":b+"\u5df2\u7ecf\u540c\u610f"+c+"\u7684\u548c\u89e3\u6761\u4ef6, \u53cc\u65b9\u8fbe\u6210\u548c\u89e3":"withdrew_d2"==a&&(this.info1=c+"\u5df2\u7ecf\u540c\u610f"+b+"\u7684\u7d22\u8d54\u8981\u6c42, \u53cc\u65b9\u8fbe\u6210\u548c\u89e3")},
get_menuConfig:function(){if(this.app.currentUser.userModel&&"admin"==this.app.currentUser.userModel.role){config=[["refresh"]];var a=this.model.status;"verdicting"==a?config.push(["convict","\u5ba3\u5224","check"]):a.match(/^(p2|d1|d2)$/)?config.push(["ready","\u9a6c\u4e0a\u5224\u5b9a","check"]):"convicted"==a&&config.push(["convict","\u91cd\u65b0\u5ba3\u5224","check"])}else config=[];return config},filter_ready:function(a){return this.model.iAmReady().pipe(function(){return ssys.reject("refresh")})},
filter_reconcile:function(a){return this.model.reconcile().pipe(function(){return ssys.reject("refresh")})},filter_convict:function(a){return this.model.convict().pipe(function(){return ssys.reject("refresh")})},filter_withdraw:function(a){return this.model.update({status:"withdrew"}).pipe(function(){return ssys.reject("refresh")})},filter_defend:function(a){return this.model.defend().pipe(function(){return ssys.reject("refresh")})},filter_restart:function(a){return this.model.update({status:"restarted"}).pipe(function(){return ssys.reject("refresh")})},
filter_counterclaim:function(a){return this.model.counterclaim().pipe(function(){return ssys.reject("refresh")})},filter_claim:function(){var a=this.elements.claimInput.updateInputData();return this.model.claim(a).pipe(function(){return ssys.reject("refresh")})},_afterSetState:function(){this.redrawMenu(this.showedState)}},{ex_BeforeVerdict:[{mg_elementConfigs:{counterclaimButton:["Button",["counterclaim","notice","${counterclaimLabel}","buttonList"]],addFactButton:["Button",[["${elements.facts.elements.create}",
"finish"],"check","${addFactButtonLabel}","buttonList",null,null,"primary"]],readyButton:["Button",["ready","check","${readyButtonLabel}","buttonList",null,null,"warning"]],reconcileButton:["Button",["reconcile","${reconcileIcon}","${reconcileButtonLabel}","buttonList",null,null,"success"]],facts:["app/r_fact/view/privateKaseFacts",["${model}"]]},initShow:["facts","counterclaimButton"]},{ex_ForRelatedUsers:[{},{ex_P1:[{initShow:["facts"]},{ex_ForPlaintiff:{}}]}],ex_ForOthers:{}}],ex_Verdicting:{},
ex_Convicted:{},ex_ListItem:[{affectParent:!1,defaultState:"start",tag:"li",style:"ssysModelView list-group-item",template:'${e~userLink}<div class="media-body"><h4 class="media-heading">${e~titleLink}<small e="createdAt" class="pull-right"/></h4><div class="row"><span class="text-info col-md-8">${model.content}</span></div>',mg_elementConfigs:{timeLocation:["Dom",["small","#${fullname}>.media-body>.media-heading","pull-right"]],userLink:["UserLink",["${model.creator_id}","","small",["#${fullname} .media-body",
"before"],"pull-left",null,"media-object"]],content:["Span",["#${fullname}>.media-body",null,"${content}"]],titleLink:["Link",["#kaseResource/${model.id}","${model.name} ","#${fullname} .media-heading"]]},initShow:["userLink","titleLink","content","timeLocation","createdAt"],get_content:function(){if("creator"==this.model.userRelation)var a="\u4f60",b="\u5bf9\u65b9";else this.model.defendant_username==this.app.currentUser.username?(a="\u5bf9\u65b9",b="\u4f60"):(a="\u7532\u65b9",b=
"\u4e59\u65b9");switch(this.model.status){case "p1":return a+"\u6b63\u5728\u505a\u7b2c\u4e00\u6b21\u7533\u8ff0, \u6295\u8bc9\u5c1a\u672a\u5f00\u59cb";case "d1":return a+"\u5df2\u7ecf\u5b8c\u6210\u4e86\u7b2c\u4e00\u6b21\u7533\u8ff0, \u8f6e\u5230"+b+"\u505a\u7b2c\u4e00\u6b21\u7533\u8ff0\u4e86";case "p2":return b+"\u5df2\u7ecf\u5b8c\u6210\u4e86\u7b2c\u4e00\u6b21\u7533\u8ff0, \u8f6e\u5230"+a+"\u505a\u7b2c\u4e8c\u6b21\u7533\u8ff0\u4e86";case "d2":return a+"\u5df2\u7ecf\u5b8c\u6210\u4e86\u7b2c\u4e8c\u6b21\u7533\u8ff0, \u8f6e\u5230"+
b+"\u505a\u7b2c\u4e8c\u6b21\u7533\u8ff0\u4e86";case "verdicting":return"\u5224\u5b9a\u5df2\u7ecf\u5f00\u59cb\u4e86"+(this.model.verdict_count?", \u76ee\u524d\u5df2\u6709"+this.model.verdict_count+"\u4e2a\u5224\u5b9a":"");case "convicted":return"\u5df2\u7ecf\u516c\u5e03\u5224\u5b9a\u7ed3\u679c\u4e86"+(this.model.verdict_count?"\u5171\u6709"+this.model.verdict_count+"\u4e2a\u5224\u5b9a":"");case "withdrew_p1":return"\u7532\u65b9\u53d6\u6d88\u4e86\u6295\u8bc9";case /^withdrew/.test:return"\u53cc\u65b9\u8fbe\u6210\u4e86\u548c\u89e3"}}},
{ex_VerdictingKase:{},ex_ConvictedKase:{},ex_MyCurrentKase:{}}]}],xp_CreateView:{mg_elementConfigs:{defendantInput:["StringInput",["\u8bf7\u8f93\u5165\u4f60\u8981\u6295\u8bc9\u7684\u5356\u5bb6\u7684\u540d\u79f0"]],p1FactInput:["TextInput",["\u8bf7\u9648\u8ff0\u4f60\u8981\u6295\u8bc9\u7684\u76f8\u5173\u60c5\u51b5"]]},initShow:["defendantInput","p1FactInput"]}});pandingbao.addResource("user",{getMoralStars:function(){return this.Collection.create({order:"weight DESC,verdict_count DESC",limit:5})},getVerdictStars:function(){return this.Collection.create({order:"verdict_count DESC,weight DESC",limit:5})},xp_Model:[{attris:"id username agent_id agent_username role registerip created_at checked_at has_photo weight verdict_count sample_count fa_count shang_count fa_amount shang_amount plaintiff_count defendant_count reconciled_count fulfilled_count".split(" "),
validationRules:{username:["String","Unique","NotNull"]},init:function(){this.has_photo?(this.photoSrc=this.app.storageBaseUrl+"photos/"+this.id,this.smallPhotoSrc=this.app.storageBaseUrl+"photos/small/"+this.id):(this.photoSrc=this.app.staticBaseUrl+"img/single_photo/100.jpg",this.smallPhotoSrc=this.app.staticBaseUrl+"img/single_photo/100.jpg")},relations:{verdicts:["manyAction","app/r_verdict","getUserVerdicts",{user_id:"${id}"}],comments:["hasMany","app/r_comment","creator_id"],parties:["hasMany",
"app/r_party","user_id"],apps:["hasMany","app/r_user","agent_id"],walues:["hasMany","app/r_walue","creator_id"],messages:["hasMany","app/r_message","receiver_id"],unreadMessages:["manyAction","app/r_message","getUnread"],groupKases:["hasMany","app/r_kase","group_id"],groupShangfas:["hasMany","app/r_shangfa","group_id"],groupShangs:["hasMany","app/r_shangfa","group_id",{ispunish:0}],groupFas:["hasMany","app/r_shangfa","group_id",{ispunish:1}],rates:["hasMany","app/r_rate","creator_id"]},get_renpin:function(){return(100*
this.weight).toFixed(2)},getScenterUser:function(){var a=this;return ssys.dfdget(this.scenterUser,function(){return ssys.scenter.getResource("user").pipe(function(b){return b.getModelByAction("getItemBySockpuppet",{sockpuppetname:a.username,appid:a.app.appid}).pipe(function(b){return a.scenterUser=b})})})},getUserRelation:function(){var a=this.app.currentUser;void 0===this.userRelation&&(this.userRelation=a.isGuest?"guest":a.id==this.creator_id?"creator":this.id==a.id?"me":
"admin"==a.userModel.role?"admin":this._getUserRelation(a));return this.userRelation}},{creationParams:["username","password"]}],xp_Collection:{},xp_ResourceView:[{mg_filterConfigs:{create:[]}},{}],xp_CollectionView:[{},{ex_admin:{mg_elementConfigs:{deleteButton:["Button",["delete",null,"\u5220\u9664\u52fe\u9009\u7684\u7528\u6237",null,"text-center",null,"danger",null,"\u4f60\u786e\u5b9a\u8981\u5220\u9664\u5417?"]],dataTable:["ResourceDataTable",["${columnConfigs}"]]},columnConfigs:[["\u540d\u79f0",
"username","ModelLink"],["\u6ce8\u518c\u65f6\u95f4","created_at","Time"],["\u6ce8\u518cIP","ip"],["\u52fe\u9009","id","Checkbox","checkUser","10%"]],indexShow:["dataTable","deleteButton"],afterInit:function(){this.checkedUsers={}},checkUser:function(a,b){a.checked?this.checkedUsers[b.id]=b:delete this.checkedUsers[b.id]},filter_delete:function(){var a=$.map(this.checkedUsers,function(a){return a.id});return 0==a.length?(alert("\u4f60\u6ca1\u6709\u52fe\u9009\u8981\u5220\u9664\u7684\u7528\u6237"),
ssys.reject("index")):this.app.resources.user.deleteAll(a).pipe(function(){alert("\u5df2\u7ecf\u6210\u529f\u5220\u9664\u4e86\u4f60\u6240\u52fe\u9009\u7684"+a.length+"\u4e2a\u7528\u6237");return ssys.reject("refresh/index")},function(){alert("\u53ef\u80fd\u56e0\u4e3a\u7f51\u7edc\u539f\u56e0, \u5220\u9664\u5931\u8d25\u4e86, \u8bf7\u518d\u8bd5\u4e00\u6b21");return ssys.reject("index")})}},ex_MoralStars:{style:"info",title:"\u8bc4\u5224\u6743\u91cd\u6392\u884c\u699c"},ex_VerdictStars:{title:"\u8bc4\u5ba1\u6b21\u6570\u6392\u884c\u699c"}}],
xp_ModelView:[{style:"ssysModelView userModel media",template:'<div class="media-body"><h3 class="media-heading"></h3></div>',mg_elementConfigs:{messageButton:["Button",[["${elements.messages}","refresh/create"],"comment-o","\u5199\u79c1\u4fe1",["stats","after"],null,null,"success"]],messages:["app/r_message/view/sendMessage",["${model}"],"hidden"],stats:["Html",["<ul class='stats list-group list-inline'></ul>","#${fullname}>.media-body"]],userLink:["UserLink",["${model.id}","","",["#${fullname} .media-body",
"before"],"pull-left",null,"media-object"]],titleLink:["Link",["#userResource/${model.id}","${model.username}","#${fullname} .media-heading"]],groupLink:["GroupLink",["${model.id}","${model.username}"]],photoUploader:["Uploader",[{url:"${app.baseUrl}uploader/uploadPhoto.php"},"\u4e0a\u4f20\u5934\u50cf","afterUploadPhoto"],"form-inline"],usernameModelAttr:["StringModelAttr",["username"]],userBox:["Div",[null,"userBox"]],userDescription:["Span",[null,"description","${model.description}"]],tabs:["Tabs",
[{verdicts:"\u6211\u7684\u5224\u5b9a",kases:"\u6211\u7684\u6295\u8bc9\u548c\u88ab\u6295\u8bc9"},"pill",!0]],userComments:["app/r_comment/view/userComments",["${model}"],null,"tabs__userComments"],kases:["app/r_kase/view/userKases",["${model}"],null,"tabs__kases"],apps:["app/r_user/view/apps",["${model}"],null,"tabs__apps"],verdicts:["app/r_verdict/view/userVerdicts",["${model}"],null,"tabs__verdicts"],rates:["app/r_rate/view/userRates",["${model}"],null,"tabs__rates"],verdict_count:["Html",["<li class='list-group-item col-sm-3'><a href='javascript::;'><strong>${model.verdict_count}</strong></br>\u8bc4\u5ba1\u6b21\u6570</a></li>",
"stats"]],shang_count:["Html",["<li class='list-group-item col-sm-3'><a href='javascript::;'><strong>${model.shang_count}</strong></br>\u83b7\u8d54\u6b21\u6570</a></li>","stats"]],fa_count:["Html",["<li class='list-group-item col-sm-3'><a href='javascript::;'><strong>${model.fa_count}</strong></br>\u8d54\u507f\u6b21\u6570</a></li>","stats"]],plaintiff_count:["Html",["<li class='list-group-item col-sm-3'><a href='javascript::;'><strong>${model.plaintiff_count}</strong></br>\u6295\u8bc9\u6b21\u6570</a></li>",
"stats"]],defendant_count:["Html",["<li class='list-group-item col-sm-3'><a href='javascript::;'><strong>${model.defendant_count}</strong></br>\u88ab\u8bc9\u6b21\u6570</a></li>","stats"]],reconciled_count:["Html",["<li class='list-group-item col-sm-3'><a href='javascript::;'><strong>${model.reconciled_count}</strong></br>\u548c\u89e3\u6b21\u6570</a></li>","stats"]],fulfilled_count:["Html",["<li class='list-group-item col-sm-3'><a href='javascript::;'><strong>${model.fulfilled_count}</strong></br>\u843d\u5b9e\u8d54\u507f\u6b21\u6570</a></li>",
"stats"]],shang_amount:["Html",["<li class='list-group-item col-sm-3'><a href='javascript::;'><strong>${model.shang_amount}\u5143</strong></br>\u83b7\u8d54\u91d1\u989d</a></li>","stats"]],fa_amount:["Html",["<li class='list-group-item col-sm-3'><a href='javascript::;'><strong>${model.fa_amount}\u5143</strong></br>\u8d54\u507f\u91d1\u989d</a></li>","stats"]],sample_count:["Html",["<li class='list-group-item col-sm-3'><a href='javascript::;'><strong>${model.sample_count}</strong></br>\u62bd\u4e2d\u6b21\u6570</a></li>",
"stats"]],weight:["Html",["<li class='list-group-item col-sm-3'><a href='javascript::;'><strong>${model.renpin}</strong></br>\u8bc4\u5224\u6743\u91cd</a></li>","stats"]]},initShow:"userLink titleLink stats weight verdict_count sample_count fa_count shang_count plaintiff_count defendant_count reconciled_count messages messageButton userDescription tabs".split(" "),filter_afterUploadPhoto:function(a){this.elements.userLink.children("img").attr("src",this.app.storageBaseUrl+"photos/"+this.model.id+
"?uploadtime="+$.now());return ssys.reject()}},{ex_ListItem:[{mg_elementConfigs:{userLink:["UserLink",["${model.id}","",{version:"small",imgClass:"pull-left",style:"media-object"}],["before",".media-body"]],titleLink:["Link",["#userResource/${model.id}",'${model.username} <span class="badge pull-right">${index}</span>'],".media-heading"]},initShow:["userLink","titleLink"]},{ex_MoralStar:{template:'${e~userLink}<div class="media-body"><h4 class="media-heading">${e~titleLink}</h4>\u8bc4\u5224\u6743\u91cd:${model.renpin}\u5206</div>'},
ex_VerdictStar:{template:'<div class="media-body"><h4 class="media-heading"></h4>\u8bc4\u5ba1\u6b21\u6570:${model.verdict_count}\u6b21</div>'}}]}],xp_CreateView:[{style:"create form col-sm-4 col-sm-offset-4",inputConfigs:["username","password","isgroup","description"],initShow:["usernameInput","passwordInput","saveButton","cancelButton"],mg_elementConfigs:{usernameInput:["StringInput",["\u8bf7\u8f93\u5165\u7528\u6237\u540d"]],passwordInput:["RegisterPasswordInput"],isgroupInput:["BooleanInput",
["\u662f\u5426\u7fa4\u4f53"]],descriptionInput:["TextInput",["\u4e2a\u4eba\u7b7e\u540d",null,null,500]],finish:["Div",["${domnode}"]]},filter_save:function(){var a=this,b=this.model,c=this.updateInputData();this.setInputsToModel(c);return b.save().pipe(function(b){a.model=b;return a.app.currentUser.login(c.username,c.password).pipe(function(){a.app.layout.setState("")})},function(b){a.showErrors(b)})}},{}]});ssys.baseUrl="http://112.124.49.131/lib/ssys/";pandingbao.staticBaseUrl="static/";pandingbao.init();
