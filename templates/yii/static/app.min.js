(function(a,b,c){function d(a){a=a||location.href;return"#"+a.replace(/^[^#]*#?(.*)$/,"$1")}var e=document,f,g=a.event.special,h=e.documentMode,m="onhashchange"in b&&(h===c||7<h);a.fn.hashchange=function(a){return a?this.bind("hashchange",a):this.trigger("hashchange")};a.fn.hashchange.delay=50;g.hashchange=a.extend(g.hashchange,{setup:function(){if(m)return!1;a(f.start)},teardown:function(){if(m)return!1;a(f.stop)}});f=function(){function f(){var c=d(),e=r(n);c!==n?(p(n=c,e),a(b).trigger("hashchange")):
e!==n&&(location.href=location.href.replace(/#.*/,"")+e);h=setTimeout(f,a.fn.hashchange.delay)}var g={},h,n=d(),q=function(a){return a},p=q,r=q;g.start=function(){h||f()};g.stop=function(){h&&clearTimeout(h);h=c};"Microsoft Internet Explorer"===navigator.appName&&!m&&function(){var b,c;g.start=function(){b||(c=(c=a.fn.hashchange.src)&&c+d(),b=a('<iframe tabindex="-1" title="empty"/>').hide().one("load",function(){c||p(d());f()}).attr("src",c||"javascript:0").insertAfter("body")[0].contentWindow,e.onpropertychange=
function(){try{"title"===event.propertyName&&(b.document.title=e.title)}catch(a){}})};g.stop=q;r=function(){return d(b.location.href)};p=function(c,d){var f=b.document,g=a.fn.hashchange.domain;c!==d&&(f.title=e.title,f.open(),g&&f.write('<script>document.domain="'+g+'"\x3c/script>'),f.close(),b.location.hash=c)}}();return g}()})(jQuery,this);(function(a,b,c){function d(a){var b={},d=/^jQuery\d+$/;c.each(a.attributes,function(a,c){c.specified&&!d.test(c.name)&&(b[c.name]=c.value)});return b}function e(a,b){var d=c(this);if(this.value==d.attr("placeholder")&&d.hasClass("placeholder"))if(d.data("placeholder-password")){d=d.hide().next().show().attr("id",d.removeAttr("id").data("placeholder-id"));if(!0===a)return d[0].value=b;d.focus()}else this.value="",d.removeClass("placeholder"),this==g()&&this.select()}function f(){var a,b=c(this),f=
this.id;if(""==this.value){if("password"==this.type){if(!b.data("placeholder-textinput")){try{a=b.clone().attr({type:"text"})}catch(g){a=c("<input>").attr(c.extend(d(this),{type:"text"}))}a.removeAttr("name").data({"placeholder-password":b,"placeholder-id":f}).bind("focus.placeholder",e);b.data({"placeholder-textinput":a,"placeholder-id":f}).before(a)}b=b.removeAttr("id").hide().prev().attr("id",f).show()}b.addClass("placeholder");b[0].value=b.attr("placeholder")}else b.removeClass("placeholder")}
function g(){try{return b.activeElement}catch(a){}}var h="placeholder"in b.createElement("input"),m="placeholder"in b.createElement("textarea"),k=c.fn,t=c.valHooks,s=c.propHooks;h&&m?(k=k.placeholder=function(){return this},k.input=k.textarea=!0):(k=k.placeholder=function(){this.filter((h?"textarea":":input")+"[placeholder]").not(".placeholder").bind({"focus.placeholder":e,"blur.placeholder":f}).data("placeholder-enabled",!0).trigger("blur.placeholder");return this},k.input=h,k.textarea=m,k={get:function(a){var b=
c(a),d=b.data("placeholder-password");return d?d[0].value:b.data("placeholder-enabled")&&b.hasClass("placeholder")?"":a.value},set:function(a,b){var d=c(a),h=d.data("placeholder-password");if(h)return h[0].value=b;if(!d.data("placeholder-enabled"))return a.value=b;""==b?(a.value=b,a!=g()&&f.call(a)):d.hasClass("placeholder")?e.call(a,!0,b)||(a.value=b):a.value=b;return d}},h||(t.input=k,s.value=k),m||(t.textarea=k,s.value=k),c(function(){c(b).delegate("form","submit.placeholder",function(){var a=
c(".placeholder",this).each(e);setTimeout(function(){a.each(f)},10)})}),c(a).bind("beforeunload.placeholder",function(){c(".placeholder").each(function(){this.value=""})}))})(this,document,jQuery);window.ssys=window.$$=function(a,b){var c=a.split("/"),d=c.shift();return ssys[d].$$(c,b)};ssys.sresBaseUrl="static/";ssys.cache={};ssys.appClasses={};ssys.views={};ssys.preloading=!1;ssys.loading=!1;ssys.refresh=function(){ssys.views={};ssys.cache=[]};
ssys.getStorage=function(a){var b=sessionStorage.getItem(a);if(void 0===b||null===b)if(b=localStorage.getItem(a),void 0!==b&&null!==b)if(b=JSON.parse(b),b.expires_at>$.now())b=b.value;else{localStorage.removeItem(a);return}else return;else b=JSON.parse(b);return b};ssys.setStorage=function(a,b,c){try{c?localStorage.setItem(a,JSON.stringify({value:b,expires_at:c})):sessionStorage.setItem(a,JSON.stringify(b))}catch(d){}};ssys.addClass=function(a,b){a.className+=" "+b};
ssys.capitalize=function(a){return a.charAt(0).toUpperCase()+a.slice(1)};ssys.timeToString=function(a,b){var c=new Date(1E3*parseInt(a)),d=c.getMonth()+1,e=c.getDate(),f=c.getHours();10>f&&(f="0"+f);var g=c.getMinutes();10>g&&(g="0"+g);c=new Date;d=d+"\u6708"+e+"\u65e5 "+f+":"+g;e=c.getFullYear();c.getFullYear()!=e&&(d=e+"\u5e74"+d);return d};
ssys.moveDom=function(a,b,c){b&&"append"!=b?"prepend"==b?c.insertBefore(a,c.firstChild):"before"==b?c.parentNode.insertBefore(a,c):"after"==b?c.parentNode.insertBefore(a,c.nextSibling):"self"==b&&(c.parentNode.insertBefore(a,c),c.parentNode.removeChild(c)):c.appendChild(a)};ssys.parseTemplate=function(a,b){for(;result=a.match(/(\$\{([^}]+)\})/);){var c=ssys.eval(result[2],b);if((typeof c).match(/string|number/))a=a.replace(result[1],c);else{a=c;break}}return a};
ssys.divide=function(a,b){return a.match(new RegExp("\\"+b))?a.split(new RegExp("^([^"+b+"]*)"+b)).slice(1):[a,""]};
ssys.eval=function(a,b){var c;if("this"==a)return b;if((c=a.match(/^"(.*)"$/))||(c=a.match(/^'([^']*)'$/)))return c[1];for(var d=a.split("."),e=b;d.length&&b;){var f=b,g=d.shift();b=b[g];void 0===b&&(b=(c=g.match(/^(\w+)\(\)$/))?f[c[1]]:f["get_"+g],"function"==typeof b?b=b.call(f):"function"==typeof e?console.error(e.classname,"eval",a,"\u51fa\u9519,\u5728step=",g,"\u65f6\u5931\u8d25\u4e86!"):console.error(e,e.fullname||e.name,"eval",a,"\u51fa\u9519,\u5728step=",g,"\u65f6\u5931\u8d25\u4e86!"))}return b};
ssys.jsonEncode=function(a){return JSON.stringify(a)};ssys.capitalize=function(a){return a.charAt(0).toUpperCase()+a.substr(1)};ssys.clone=function(a){if("object"==typeof a&&null!==a){if($.isArray(a))var b=[];else if(a.constructor===Object)b={};else return a;for(var c in a)b[c]=ssys.clone(a[c]);return b}return a};ssys.isIE=function(){return"Microsoft Internet Explorer"===navigator.appName};
ssys.traverse=function(a,b){if($.isArray(a)){for(var c=[],d=0,e=a.length;d<e;d++)c[d]=ssys.traverse(a[d],b);return c}return b(a)};ssys.removeUndefined=function(a){for(var b in a)void 0===a[b]&&delete a[b];return a};ssys.mapToList=function(a,b){for(var c=[],d=0,e=b.length;d<e;d++){var f=b[d];c[d]=void 0===a[f]?null:a[f]}return c};ssys.resolve=function(a){return $.Deferred().resolve(a)};ssys.updateObject=function(a,b){a=a||{};for(var c in b){var d=b[c];"ssysDelete"===d?delete a[c]:a[c]=d}return a};
ssys.merge=function(a,b){if(a&&b)if($.isArray(a))a=a.concat(b);else for(var c in b){var d=b[c],e=a[c];void 0===e?a[c]=d:"object"==typeof d&&"object"==typeof e&&ssys.merge(e,d)}return a};ssys.toArray=function(a){var b=[];if($.isArray(a))return a;for(var c in a)b.push([c,a[c]]);return b};
ssys.loopDefer=function(a,b,c,d){var e=0;a=ssys.toArray(a);var f=function(b){if(e<a.length){var h=a[e];e++;return c(h,b,e).pipe(f,function(a){console.error("loopDefer\u5728\u7b2c",e,"\u9879=",h,"\u51fa\u9519\u4e86!\u8fd4\u56de\u7684\u662f:",a);return d?d(e,h,a):a})}return 0==a.length?$.Deferred().resolve(b):b};return f(b)};
ssys.asyncLoopDefer=function(a,b,c){var d=0,e=0,f=$.Deferred();a=$$.toArray(a);if(0==a.length)return f.resolve();for(var g=0,h=a.length;g<h;g++){var m=a[g];b(m,g).pipe(function(){d++;if(d==h)return 0==e?f.resolve():f.reject(e)},function(a){d++;e++;c&&c(m,g,a);if(d==h)return f.reject(e)})}return f};
ssys.reject=function(a){console.warn&&(console.warn.apply?console.warn.apply(console,arguments):console.warn(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6]));return $.Deferred().reject(a)};ssys.dfdget=function(a,b){return a?ssys.resolve(a):b()};
ssys.addParams=function(a,b){a.match(/\?/)||(a+="?");for(var c in b){var d=b[c];(typeof d).match(/string|number/)||(d=ssys.jsonEncode(d));if(a.match(/\?$/))a+=c+"="+d;else{var e=new RegExp(c+"=[^&]+");a.match(e)?a.replace(e,c+"="+d):a+="&"+c+"="+d}}return a};ssys.xhrget=function(a,b,c,d){"Microsoft Internet Explorer"===navigator.appName&&(a=encodeURI(a));return $.ajax({type:"GET",url:a,dataType:"json",crossDomain:d,timeout:12E4,xhrFields:{withCredentials:!0}})};
ssys.xhrpost=function(a,b,c,d){return d?$.ajax({type:"POST",url:a,crossDomain:!0,data:b,dataType:"json",xhrFields:{withCredentials:!0}}):$.ajax({type:"POST",url:a,data:b,dataType:"json"})};window.jsonp=function(a){return a};ssys.getJsonp=function(a,b){"Microsoft Internet Explorer"===navigator.appName&&(a=encodeURI(a));return $.ajax({cache:!b,dataType:"jsonp",timeout:2E4,jsonp:!1,jsonpCallback:"jsonp",url:a,error:function(){console.error("[ssys.getJsonp],failed to get url:",a)}})};
ssys.globalDfds=[];ssys.pendingDfdCount=0;ssys.parseUrl=function(a){a.match(/^\./)?a=a.replace(/^\./,ssys.sresBaseUrl):a.match(/^\$\$/)&&(a=a.replace(/^\$\$/,ssys.baseUrl));return a};
ssys.getJs=function(a,b,c){a=ssys.parseUrl(a);if(!b&&(ssys.cache[a]||c))return ssys.resolve();b||(ssys.cache[a]=!0);return $.ajax({cache:!b,dataType:"script",timeout:2E4,url:a,success:function(){ssys.cache[a]=!0},error:function(b,c,f){ssys.cache[a]=!1;console.error("\u52a0\u8f7durl=",a,"\u811a\u672c\u51fa\u9519\u4e86!",b,c,f)}})};
ssys._getJs=function(a,b){return $.ajax({cache:!b,dataType:"script",timeout:2E4,url:a,success:function(){ssys.cache[a]=!0;ssys.pendingDfdCount--;0==ssys.pendingDfdCount&&ssys.globalDfd.resolve()},error:function(b,d,e){console.error("\u52a0\u8f7durl=",a,"\u811a\u672c\u51fa\u9519\u4e86!",b,d,e)}})};
ssys.getCss=function(a){a=ssys.parseUrl(a);if(ssys.cache[a])return ssys.resolve();var b=new $.Deferred;try{var c=document.createElement("link");c.type="text/css";c.href=a;c.rel="stylesheet";b.resolve({});document.getElementsByTagName("head")[0].appendChild(c);ssys.cache[a]=c}catch(d){console.error("[ssys.getCss],error:",d),b.reject(d)}return b};ssys.delay=function(a,b){var c=new $.Deferred;b||(b=a,a=null);var d=setTimeout(function(){a&&a();c.resolve()},1E3*b);c.timeoutId=d;return c};
ssys.cancel=function(a){a&&clearTimeout(a.timeoutId)};ssys.getAnchor=function(){return window.location.hash.slice(1)};ssys.setAnchor=function(a){window.location.hash=a?"#"+a:"";""===a&&history.pushState&&history.pushState({},"",window.location.pathname)};ssys.getKeys=function(a){var b=[],c;for(c in a)b.push(c);return b};ssys.shuffle=function(a,b){var c,d,e=a.length;if(b)var f=[];l=a.length;if(e)for(;e;)d=Math.floor(Math.random()*l),e--,c=a[d],a[d]=a[e],a[e]=c,b&&f.push(c);return b?f:a};
ssys.aa=function(a,b,c){c=c||[];a=a.split(",");b=0;for(var d=a.length;b<d;b++)eval("_."+a[b]+"=valueList["+b+"]");return c};ssys.summernote={};
ssys.summernote.ssysUploadImage=function(){var a=ssys.uploaded_at=$.now(),a={url:ssys.summernote.renderer.options.uploadImageUrl+"?uploaded_at="+a,dataType:"json",xhrFields:{withCredentials:!0},type:"POST",crossDomain:!0,done:function(a,b){ssys.summernote.editor.restoreRange(ssys.summernote.editable);ssys.summernote.editor.insertImage(ssys.summernote.editable,ssys.summernote.renderer.options.uploadUrl+ssys.summernote.renderer.options.currentUser.id+"__"+ssys.uploaded_at);ssys.summernote.imageDialog.modal("hide")}},
b=ssys.summernote.imageDialog.find(".note-image-input");b.attr("name","file");b.fileupload(a)};window.console=window.console||{info:function(){},debug:function(){},warn:function(){},error:function(){},log:function(){}};console.debug||(console.debug=function(){});console.warn||(console.warn=function(){});console.error||(console.error=function(){});$$.O=function(){};$$.O.prototype._clearCache=$$.O._clearCache=function(){};$$.O.prototype.classname=$$.O.classname="$$.O";
$$.O.prototype.$$=$$.O.$$=function(a){ssys.isRefresh&&this._clearCache();if("string"==typeof a)a=a.split("/");else if(!$.isArray(a))return console.error("$$\u80fd\u63a5\u53d7\u7684steps\u53ea\u80fd\u662fstring\u6216array of strings!\u8be5steps\u5374\u662f",a),ssys.reject();if(0==a.length)return ssys.resolve(this);var b=a.shift(),c=this[b]||this.constructor[b],d=this;if(void 0===c)if(this["get_"+b])c=this["get_"+b]();else if(c=b.match(/^#(.+)/))c=ssys[c[1]];else if(c=b.match(/^m_(.+)$/)){var c=c[1],
e=this[c];if(!e||"function"!=typeof e)return console.error("step\u4e66\u5199\u9519\u8bef",this,"\u4e0d\u5b58\u5728\u540d\u4e3a",c,"\u7684\u65b9\u6cd5!"),ssys.reject();c=e.apply(this)}else if(this._$$)c=this._$$(b);else return console.error(this.fullname,"\u6ca1\u6cd5\u8bfb\u53d6step",b,"!"),ssys.reject();if(0<a.length){if(c.$$)return c.$$(a);if(c.pipe)return c.pipe(function(c){if(c.$$)return c.$$(a);console.error(d,"\u7684",b,"\u662f",c,"\u5b83\u6ca1\u6709$$, \u6ca1\u6cd5\u7ee7\u7eed\u8bfb\u8bfb\u53d6\u4e0b\u51e0\u6b65",
a,"!");return ssys.reject()});console.error(this,"\u7684",b,"\u662f",c,"\u5b83\u6ca1\u6709$$, \u6ca1\u6cd5\u7ee7\u7eed\u8bfb\u8bfb\u53d6\u4e0b\u51e0\u6b65",a,"!");return ssys.reject()}if(c.pipe)return c;if(void 0!==c)return ssys.resolve(c);console.error(this.fullname,"\u6ca1\u6cd5\u8bfb\u53d6step",b,"!");return ssys.reject()};$$.O.prototype.eval=function(a){return ssys.eval(a,this)};
$$.O.prototype.parseConfig=function(a,b){var c;if("string"==typeof a){if(!a.match(/\$[{\d~]|^m__(\w+)$/))return a;if(c=a.match(/^"(.*)"$/))return c[1];if(c=a.match(/^m__(\w+)$/)){c=c[1];var d=this[c];d?a=b?d.call(this,b[0]):d.call(this):console.error(this.fullname,"\u6ca1\u6709\u627e\u5230methodName=",c,"\u7684\u65b9\u6cd5, \u914d\u7f6em__\u6709\u8bef!");return this.parseConfig(a,b)}if(b)for(c=1,d=b.length;c<d;c++)a=a.replace("$"+c,b[c]);for(;c=a.match(/(\$\{([^}]+)\})/);){d=this.eval(c[2],b);if(null===
d||void 0===d)d="";var e=typeof d;if(e.match(/string|number/)){if(a=a.replace(c[1],d),a===""+d+""&&"number"==e){a=d;break}}else{a=this.parseConfig(d,b);break}}"string"==typeof a&&(a=a.replace(/\$~/g,"$"))}else if("object"==typeof a&&null!==a){c=a;if($.isArray(c))a=[];else if(c.constructor===Object)a={};else return c;for(d in c){if(c[d]instanceof RegExp)return c;a[d]=this.parseConfig(c[d],b)}}return a};
$$.O.prototype.parentCall=function(a,b){var c=this.callingParent||this.self,d=c.superclass;this.callingParent=d;for(var e=d.prototype[a];e===c.prototype[a];)if(d.superclass)d=d.superclass,e=d.prototype[a],this.callingParent=d;else return console.error(this,"parentCall(",a,")\u5931\u8d25\u4e86!this.callingParent=",this.callingParent);try{var f=e.apply(this,b||[]);this.callingParent=null}catch(g){throw this.callingParent=null,g;}return f};
$$.O.prototype.extendProperty=function(a,b){this.self[a]||console.error(this.fullname,"\u8981\u6269\u5c55\u7684\u5c5e\u6027",a,"\u5931\u8d25\u4e86!\u539f\u56e0\u662f\u4e0d\u5b58\u5728\u88ab\u7ee7\u627f\u7684\u7236\u7c7b");$.isArray(b)?b[2]="@"+this.fullname:b=[b,null,"@"+this.fullname];(this[a]=this.self[a].createSubclass(b)).host=this};$$.O.prototype.extendProperties=function(a){for(var b in a){var c;(c=b.match(/^xp_(.+)$/))?this.extendProperty(c[1],a[b]):this[b]=a[b]}};$$.O.create=function(){return new this};
$$.O.addPrototypeContent=function(a,b){for(var c=this.getPrototypes(a),d=this.getPrototypes(b),e=0,f=d.length;e<f;e++){var g=d[e];if(-1!=$.inArray(g,c))break;for(var h in g)if("__proto__"!=h&&"constructor"!=h&&"self"!=h){var m,k=g[h];if(m=h.match(/^mg_(.+)$/))h=m[1],k=ssys.merge(k,a[h]);a[h]=k}}};$$.O.getPrototypes=function(a){a=a||this.prototype;for(var b=[];a;)b.push(a),a=a.__proto__;return b};
$$.O.createSubclass=function(a,b,c,d){a=a||{};$.isArray(a)&&(b=a[1],c=a[2],d=a[3],a=a[0]);b=b||{};var e=function(){},f=new this;e.prototype=f;if(d)for(var g=0,h=d.length;g<h;g++){var m=d[g];this.addPrototypeContent(f,m.prototype)}for(var k in a){g=a[k];if(m=k.match(/^mg_(.+)$/))k=m[1],g=ssys.merge(g,this.prototype[k]);f[k]=g}f.sup=new this;f.self=e;for(k in this)e[k]=this[k];a={};for(k in b){g=b[k];if(m=k.match(/^(ex_|xp_)(.+)$/))k=m[2],d=m[1],(m=this[k])?("xp_"==d?d=[]:(d=[m],m=e),$.isArray(g)?(g[2]=
k,g[3]=g[3]?g[3].concat(d):d):g=[g,null,k,d],g=m.createSubclass(g)):a[k]=g;e[k]=g}e.superclass=this;c&&(this[c]=e,this.subclasses[c]=e,e.classname=e.prototype.classname=this.classname+"/"+c,e.shortClassname=e.prototype.shortClassname=c);for(k in a)g=a[k],m=e,"function"==typeof g&&(g=[null,null,k,[g]]),g=$.isArray(g)?m.createSubclass(g[0],g[1],k,g[3]):m.createSubclass(g,null,k),a[k]=e[k]=g;e.subclasses=a;return e};$$.O.extendProperty=function(a,b,c){this[a]=this[a].createSubclass(b,c);return this};
$$.O.subclasses={};$$.View=$$.O.createSubclass({tag:"Div",textAlign:"left",get_reTextAlign:function(){return"left"==this.textAlign?"right":"right"==this.textAlign?"left":"center"},steps:[],affectParent:!1,preventClick:"accept",addCssClass:"",showConfigs:{},showConfigRules:[[/^$|^index/,"${indexShow}"]],inputConfigs:null,initInputDataConfigs:null,elementConfigs:{pageHeader:["Html",['<div class="page-header">${pageHead}</div>']],stage:["Html",["<div></div>"]],dialog:["Dialog",["onCloseDialog"],null,$("body")],tabs:["Tabs",
["${tabConfigs}","pill",!0]]},elementConfigRules:[],indexShow:[],defaultState:"index",initLoads:null,init:function(){this.isLocked=!0;this._baseShow={};this._currentShow={};this.elements={};this.outdatedElements={};this.domnode.innerHTML="";this.settingState="start";this.beforeInit&&this.beforeInit.apply(this,arguments);this.initInputDataConfigs&&(this.initInputDataConfigs=ssys.clone(this.initInputDataConfigs));this.template&&(this.domnode.innerHTML=this.parseTemplate(this.template));this.stage=document.getElementById(this.fullname+
"__stage")||this.domnode;if(this.initShow){var a=this._baseShow=this._getShowConfigs(this.initShow);this.showByConfigs(a)}this.stage=document.getElementById(this.fullname+"__stage")||this.domnode;this.afterInit.apply(this,arguments);this.state="start";this.isLocked=!1},eval:function(a,b){var c;if(c=a.match(/^((\!)|(\w+):)(.+)$/)){var d=c[3]||c[2];return"!"==d?!this.eval(c[4]):this["eval_"+d](this.eval(c[4],b),b)}if(c=a.match(/(\w+)~(\w*)(\..+)?$/))switch(c[1]){case "e":return"<span id='"+this.fullname+
"__"+c[2]+"'></span>";case "cl":a="app.resources."+c[2]+".CollectionView"+(c[3]||"");break;case "cr":a="app.resources."+c[2]+".CreateView"+(c[3]||"");break;case "mv":a="app.resources."+c[2]+".ModelView"+(c[3]||"");break;default:this["parse_"+c[1]]?a=this["parse_"+c[1]](c[2]+(c[3]||""),b):console.error(this.fullname,"\u65e0\u6cd5\u8bc6\u522b\u524d\u7f00",c[1],"!")}return $$.eval(a,this)},eval_date:function(a){a=new Date(1E3*parseInt(a));var b=a.getMonth()+1,c=a.getDate();a=new Date;b=b+"\u6708"+c+
"\u65e5";c=a.getFullYear();a.getFullYear()!=c&&(b=c+"\u5e74"+b);return b},eval_datetime:function(a){a=new Date(1E3*parseInt(a));var b=a.getMonth()+1,c=a.getDate(),d=a.getHours();10>d&&(d="0"+d);var e=a.getMinutes();10>e&&(e="0"+e);a=new Date;b=b+"\u6708"+c+"\u65e5 "+d+":"+e;c=a.getFullYear();a.getFullYear()!=c&&(b=c+"\u5e74"+b);return b},get_isGuest:function(){return!this.app.currentUser.id},html:function(a){return void 0===a?this.domnode.innerHTML:this.domnode.innerHTML=a},append:function(a){return this.domnode.insertAdjacentHTML("beforeend",
a)},find:function(a){return $("#"+this.fullname).find(a)},children:function(a){return $("#"+this.fullname).children(a)},addClass:function(a){return $("#"+this.fullname).addClass(a)},removeClass:function(a){return $("#"+this.fullname).removeClass(a)},setStates:function(a,b){var c=this;return ssys.loopDefer(a,null,function(b){return c.setState(b,{type:"setStates",originStates:a,originView:c})},function(a,b){console.error(c.fullname,"setStates\u5728\u7b2c",a,"\u6b65setState(",b,")\u65f6\u51fa\u9519\u4e86!")})},
setState:function(a,b,c){this.settingState=a=a||this.defaultState;if("string"==typeof a){if("function"==typeof this[a]&&!this["filter_"+a])return this[a]();if(a.match(/,/))return c=a.split(","),this.setStates(c)}else{if($.isArray(a)){a=ssys.clone(a);a[0].match&&a[0].match(/^\$\{.+\}$/)&&(a[0]=this.parseConfig(a[0]));if(a[0].setState){b=a[0];var d=a[1];this.isLocked=!1;return b.setState(d,{type:"stateTransfer",originState:this.settingState,originView:this},c)}return this.setStates(a,{type:"stateTransfer",
originState:this.settingState,originView:this})}"number"==typeof a&&(a=""+a)}if("*"==a)if("start"==this.state)a=this.defaultState;else return a=this.state,ssys.resolve(a);else{if("-"==a)return this.hide(),$$.resolve(a);"<"==a?a=this.getLastState()||this.defaultState:">"==a&&(a=this.getNextState()||this.defaultState)}c&&(this.isLocked=!1);a.match(/\$\{/)&&(a=this.parseConfig(a));b=a.split("/");d=b.shift();if(".."==d)return this.parent.setState(b.join("/"),{type:"stateTransfer",originState:a,originView:this},
c);if("refresh"==d)return a=b.join("/"),this.refresh(a);if("update"==d)return a=b.join("/"),this.update(a);if(d.match(/^#/))return this.app.layout.setState(a.substr(1),{type:"stateTransfer",originState:this.settingState,originView:this});var e=this;e.isLocked=!0;c=e.closeState(a)||$$.resolve();c.pipe||(c=$$.resolve(c));return c=c.pipe(function(){return e.loadByConfigs(a).pipe(function(){return e.filterState(a).pipe(function(b){return e.setStateDfd=e.show(b).pipe(function(b){a.match(/\*$/)?a=b:a.match(/(^|\/)refresh(\/|$)/)&&
(a=b);a==e.defaultState?a="":a.match(/\/$/)&&(a=a.split(/\/$/)[0]);e.state=a;e.domnode.setAttribute("data-state",a);e._currentShow.state=b;e.isLocked=!1;return a},function(){console.error(e.fullname,"\u7684\u8868\u6f14\u5931\u8d25\u4e86,\u5c06\u7ee7\u7eed\u4fdd\u6301\u72b6\u6001",e.state,"[$$.View.setState]");e.isLocked=!1;return e.state})},function(a){e.isLocked=!1;if(void 0!==a)return e.setState(a,{type:"filteredState",originState:e.settingState,originView:e})})})},function(a){e.isLocked=!1;console.error(e.fullname,
"closeState\u5931\u8d25\u4e86!this.state=",e.state)})},hide:function(){this.domnode.style.display="none";this.hidingState=this.state;this._currentShow.state=this.state="-";this.parent._currentShow[this.name]=!1;return ssys.resolve("-")},display:function(){this.domnode.style.display="";this._currentShow.state=this.state=this.hidingState;this.parent._currentShow[this.name]=this._currentShow;for(var a in this.outdatedElements)this.outdatedElements[a].refresh(),delete this.outdatedElements[a];return ssys.resolve(this.state)},
closeState:function(a){var b=this.getStateCloser(this.state);if(b)return this["closer_"+b](a)},filterState:function(a){var b=this.getStateFilter(a),c=this;if(b){var d=$.isArray(b)?b:[b],c=this;a=ssys.loopDefer(d,a,function(a,b){var d;(d=a.match(/^to__(.+)$/))?d=ssys.resolve(d[1]):(d=c["filter_"+a](b),void 0===d?d=ssys.resolve(b):d.pipe||(d=!1===d?ssys.reject():ssys.resolve(d)));return d},function(a,b,g){console.error(c.fullname,"filterState\u65f6\u5728\u7b2c",a,"\u6b65filter\u4e3a",b,"\u65f6\u51fa\u9519\u4e86!\u8fd4\u56de\u7ed3\u679c\u662f",
g,"filters=",d);return g})}else a=ssys.resolve(a);return a.pipe(function(a){return"string"==typeof a?(a.match(/\$/)&&(a=c.parseConfig(a)),a.match(/[.,><#]|^refresh\b|^update\b/)?ssys.reject(a):a):ssys.reject(a)},function(a){""===a&&(a=c.defaultState);return a||c.state})},getStateFilter:function(a){var b=this.getStateConfig(a,"filter");b||(a=a.split("/")[0],this["filter_"+a]&&(b=a));return b},getStateCloser:function(a){var b=this.getStateConfig(a,"closer");b||(a=a.split("/")[0],this["close_"+a]&&(b=
a));return b},loadByConfigs:function(a,b){return(b=b||this.getStateConfig(a,"load"))?this._loadByConfigs(b):$$.resolve()},_loadByConfigs:function(a){var b=this;return $$.asyncLoopDefer(a,function(a){return b.loadByConfig(a[0],a[1])},function(c,d,e){console.warn(b.fullname,"loadByConfigs\u5931\u8d25\u4e86!\u5177\u4f53\u5728\u7b2c",c,"\u9879,\u914d\u7f6e\u4e3a:",d,"\u65f6\u5931\u8d25\u4e86, \u8fd4\u56de\u7ed3\u679c\u662f",e,". \u5168\u4f53loadConfigs=",a)})},loadByConfig:function(a,b){var c;if(c=b.match(/^js:(.+)/))return $$.getJs(c[1]);
c=$$.divide(b,"/");var d=this.app.resources[c[0]],e=this;if(d)return d.loadByConfig(c[1]).pipe(function(b){return e[a]=b},function(b){b=e.onLoadFail(a,b);return b.pipe?b:$$.resolve(b)});console.error(this.fullname,"loadByConfig(",a,b,")\u5931\u8d25\u4e86,\u6ca1\u6709\u627e\u5230\u540d\u4e3a",c[0],"\u7684resource!")},onLoadFail:function(a,b){console.warn(this.fullname,"load\u6570\u636e",a,"\u5931\u8d25\u4e86!failedResult=",b);this[a]=null;return b},show:function(a){var b=$$.divide(a,"/"),c=b[0]||this.defaultState,
d=b[1],b=this.getShowConfigs(c),e=this;this.showByConfigs(b);return(this.elementSettingDfd?this.elementSettingDfd.pipe(function(){return e.showNextSteps(d,c)}):this.showNextSteps(d,c)).pipe(function(){e.entry=c;return e.afterShow(a)})},showNextSteps:function(a,b){if(a){var c=$$.divide(a,"/"),d=c[0];if(d.match(/\./)){var e=$$.divide(d,"."),d=e[0];this.elements[d]||console.error(this.fullname,"\u540d\u4e3a"+d+"\u7684\u5143\u7d20\u4e0d\u5b58\u5728!");a=c[1]?e[1]+"/"+c[1]:e[1]}else d=b}else d=b;var c=
this.elements[d],f;c?c.setState?f=c.setState(a||"",{type:"nextSteps",originView:this,originState:this.settingState,elementName:d}):a?console.error(this.fullname,"\u540d\u4e3a"+d+"\u7684\u5143\u7d20\u6ca1\u6709setState \u65b9\u6cd5!\u6240\u4ee5\u65e0\u6cd5\u7ee7\u7eed\u8868\u6f14:",a):f=ssys.resolve():(console.warn(this.fullname,"\u6ca1\u6709\u627e\u5230\u540d\u4e3a",d,"\u7684\u5143\u7d20,\u53ea\u80fd\u505c\u6b62show\u4e86,\u8fd8\u6709nextSteps=",a,"\u6ca1\u6709\u5b8c\u6210"),f=ssys.resolve());return f},
getShowConfigs:function(a){a="start"==a?{}:this.getStateConfig(a,"show")||[a];return this._getShowConfigs(a)},_getShowConfigs:function(a){for(var b=this._currentShow,c=this._baseShow,d=$$.clone(c),e=0,f=a.length;e<f;e++){var g=a[e];if("string"==typeof g)var h=g.match(/^([-@])?([^.]+)(\.(.*))?$/);else console.error(this.fullname,"\u7684showConfigs",a,"\u4e2d\u7684config=",g,"\u6709\u8bef!config\u53ea\u80fd\u662fstring");h||console.error(this.fullname,"showConfigs",a,"\u4e2d\u7684config=",g,"\u6709\u8bef!\u5f62\u5f0f\u4e0d\u5339\u914d");
var g=h[2],m=h[1],k=h[4];void 0===k&&(k="start");d[g]={state:k,prefix:m}}for(g in b)"state"!=g&&(a=b[g],e=d[g],f=c[g],a?e?(!e.prefix&&"object"==typeof a&&(e.state==a.state||void 0===a.state&&"start"==e.state)||!0===a&&void 0===e.prefix)&&delete d[g]:d[g]={prefix:"-"}:e?"-"==e.prefix&&delete d[g]:f&&"@"!=f.prefix&&(d[g]={prefix:"+"}));return d},showByConfigs:function(a){this.locationConfigs={};this.wrapperConfigs={};for(var b in a){var c=a[b];this.showElement(b,c.state,c.prefix)}for(var d in this.locationConfigs)this.moveElement(d,
this.locationConfigs[d]);for(d in this.wrapperConfigs)this.wrapElement(d,this.wrapperConfigs[d])},removeElement:function(a){$("#"+this.fullname+"__"+a).remove();delete this.elements[a]},hideElement:function(a){var b=this.elements[a];b.setState?b.hide():(b.hide(),this._currentShow[a]=!1)},showElement:function(a,b,c){"@"==c&&this.elements[a]&&this.removeElement(a);var d=this.elements[a];if(!d)if(d=this.getElementConfig(a)){if(d=this.createElement(a,d),!d)return}else return console.error(this.fullname,
"\u7684\u5267\u672c\u4e0a\u6ca1\u627e\u5230",a,"\u5143\u7d20\u7684\u6dfb\u52a0\u65b9\u6cd5,\u4e0d\u77e5\u9053\u5982\u4f55\u6dfb\u52a0\u5b83!","[$$.View.showElement]");"-"==c?d.hide?d.hide():(d.style.display="none",this._currentShow[a]=!1):"+"==c?d.display?d.display():(d.style.display="",this._currentShow[a]=!0):d.setState?("-"==d.state&&d.display(),"start"!=b&&d.setState(b,{type:"showElement",originView:this,originState:this.settingState})):(d.style.display="",this._currentShow[a]=!0);return d},getElementConfig:function(a){var b=
this.elementConfigs[a],c;if(!b){elementConfigRules=this.elementConfigRules;for(var d=0,e=elementConfigRules.length;d<e;d++){var f=elementConfigRules[d];if(c=a.match(f[0])){b=f[1];"function"==typeof b&&(b=b.call(this,a));break}}}return b=this.parseConfig(b,c)},createElement:function(a,b){b=b.slice(0);var c=b[0],d=b[1]||[];d.splice||(d=[d]);var e=b[2],f=b[3],g=b[4],h=b[5];"object"!=typeof e||e.concat||(f=e.cssClass,g=e.wrapper,h=e.hide,e=e.location);if(!h){if(h=this["create"+c]||this.app.layout["create"+
c])d.unshift(a),c=h.apply(this,d),this._currentShow[a]=!0;else{"string"==typeof c&&(c=this.self[c]||this.app.layout.self[c]||$$.View[c]);if(!c||"function"!=typeof c){console.error(this.fullname,"\u540d\u4e3a"+a+"\u7684element\u521b\u5efa\u5931\u8d25!","\u65e0\u6cd5\u8bc6\u522b\u5143\u7d20\u79cd\u7c7b",b[0],"\u8bc6\u522b\u7ed3\u679c\u662f",c,"(\u6709\u6548\u7684\u53ea\u80fd\u662fstring\u6216function)");return}c=c.create(this,a,d)}if(c){this.elements[a]=c;e&&(this.locationConfigs[a]=e);f&&(c.addClass?
c.addClass(f):$(c).addClass(f));g&&(this.wrapperConfigs[a]=g);if(e=this.getInputNameOfElement(a))c.setAttribute("input_name",e),this.initInputDataConfigs&&(e=this.initInputDataConfigs[e])&&c.setInputData(e);"stage"==a&&(this.stage=c);return c}console.error(this.fullname,"\u65e0\u6cd5\u751f\u6210\u540d\u4e3a"+a+"\u7684element!")}},setAttribute:function(a,b){return this.domnode.setAttribute(a,b)},moveElement:function(a,b){"string"==typeof a&&(a=this.elements[a]);var c=a.domnode||a;b=this.parseLocation(b);
$$.moveDom(c,b[0],b[1])},wrapElement:function(a,b){var c=this.elements[a],c=c.domnode||c;b=b.replace("{{}}","<div id='"+c.id+"_wrapper'></div>");c.insertAdjacentHTML("beforebegin",b);$$.moveDom(c,"self",document.getElementById(c.id+"_wrapper"))},parseTemplate:function(a){return this.parseConfig(a.replace(/ e="/g,' id="'+this.fullname+"__"))},beforeInit:function(){if(this.initDatas&&!this.isRefresh){var a=this.parseConfig(this.initDatas);if(a)return this.app.loadByConfigs(a);console.error(this.fullname,
"\u52a0\u8f7dinitDatas\u5931\u8d25!initDatas\u914d\u7f6e\u6709\u9519, parseConfig\u4e4b\u540e\u4e3a\u7a7a.initDatas=",this.initDatas)}},afterInit:function(){},onLogin:function(){this._login()},_login:function(){if(this.loginConfigs)for(var a=0,b=loginConfigs.length;a<b;a++){var c=loginConfigs[a];if(this.elements[c])this.elements[c].onLogin()}},getElement:function(a){a="#"==a.charAt(0)?a.substr(1):this.fullname+"__"+a;return ssys.views[a]},filter_index:function(a){return a},filter_logged:function(a){if(this.app.currentUser.id)return ssys.resolve(a);
this.app.layout.afterLoginState=a;return ssys.reject("#p_session/login")},remove:function(){for(var a in this.elements){var b=this.elements[a];b.setState?b.remove():$("#"+this.fullname+"__"+a).remove()}delete this.parent.elements[this.name];this.parent.entry==this.name&&(this.parent.state="error",this.parent.entry="");delete this.parent._currentShow[this.name];$("#"+this.fullname).remove()},refresh:function(a){a||""===a||(a=void 0!==this.refreshState?this.refreshState:this.state);ssys.isRefresh=!0;
var b=this,c=this.beforeRefresh(),c=c?c.pipe(function(){return b._refresh(a)}):this._refresh(a);return c.always(function(){ssys.isRefresh=!1})},update:function(a){a||""===a||(a=this.state);ssys.isRefresh=!0;var b=this,c=this.beforeRefresh();return c?c.pipe(function(){return b._update(a)}):this._update(a)},beforeRefresh:function(){},_refresh:function(a){return this.self.create(this.parent,this.name,this.params).setState(a,{type:"refresh"})},_update:function(a){return this.setState(a,{type:"update"}).pipe(function(a){ssys.isRefresh=
!1;return a})},displayElements:function(a){for(var b=0,c=a.length;b<c;b++){var d=this.elements[a[b]];(d.domnode||d).show()}},hideElements:function(a){for(var b=0,c=a.length;b<c;b++){var d=this.elements[a[b]];$(d.domnode||d).hide()}},afterShow:function(a){var b=this.entry;if(this["after_"+b])this["after_"+b]();a==this.getLastState()?this.logs.pop():this.logs.push(a);return a},getLastState:function(){return this.logs[this.logs.length-2]},getNextStep:function(){var a=$.inArray(this.state||this.defaultState,
this.steps)+1;if(0<=a)return this.steps[a]},nextStep:function(){var a=this.getNextStep();return void 0===a?ssys.reject(this.fullname,"\u7684\u5f53\u524d\u72b6\u6001:",this.state,"\u6ca1\u6709\u4e0b\u4e00\u6b65!"):this.setState(a,{type:"nextStep"})},getLastStep:function(){var a=$.inArray(this.state,this.steps)-1;if(0<=a)return this.steps[a]},lastStep:function(){var a=this.getLastStep();return void 0===a?ssys.reject(this.fullname,"\u7684\u5f53\u524d\u72b6\u6001:",this.state,"\u6ca1\u6709\u4e0a\u4e00\u6b65!"):
this.setState(a,{type:"lastStep"})},getParentState:function(a){a=a.split(/\/\w+$/);return 2==a.length?a[0]:null},getStateConfig:function(a,b,c){if(null===a)return null;""===a&&(a=this.defaultState);c=this[b+"ConfigRules"];b=(this[b+"Configs"]||{})[a];var d=null;if(!b&&c)for(var e=0,f=c.length;e<f;e++){var g=c[e];if(d=a.match(g[0]))if(b=g[1])break}if(b)return this.parseConfig(b,d)},getMatchedConfig:function(a,b,c,d,e){var f=null,g,h;b&&(g=b[a]);if("list"==d||"concat"==d)h=[];if(!g||"list"==d||"concat"==
d){b=0;for(var m=c.length;b<m;b++){var k=c[b];if(f=a.match(k[0]))if(g=k[1],void 0!==e&&(g=g[e]),g)if(g=this.parseConfig(g,f),"list"==d)h.push(g);else if("concat"==d)$.isArray(g)?h=h.concat(g):h.push(g.slice(0));else break}}return h||g},initInputData:function(a){var b=this.inputConfigs;if(b){this.initInputDataConfigs||(this.initInputDataConfigs={});for(var c=0,d=b.length;c<d;c++){var e=this.getInputName(b[c]),f=a[e];void 0!==f&&(this.initInputDataConfigs[e]=f)}}},setInputData:function(a){var b=this.inputConfigs;
if(b)for(var c=0,d=b.length;c<d;c++){var e=b[c],f=this.getInputName(e),e=this.getInputElementName(e);(e=this.elements[e])&&e.setInputData(a[f])}},getInputNameOfElement:function(a){var b=this.inputConfigs;if(b)for(var c=0,d=b.length;c<d;c++){var e=b[c],f=this.getInputName(e);if(a==this.getInputElementName(e))return f}},updateInputData:function(){var a=this.inputConfigs,b=this.inputData=this.inputData||{};this.inputElement=null;this.inputElements={};if(a)if($.isArray(a))e=this.updateInputGroup(a),ssys.updateObject(b,
e);else if("string"==typeof a)e=this.elements[a].updateInputData(),this.inputElement=this.elements[a],ssys.updateObject(b,e);else for(e in a){var c=a[e];if("string"==typeof c){var d=this.elements[c].updateInputData();this.inputElements[e]=this.elements[c]}else d=ssys.updateObject(b[e],this.updateInputGroup(c));b[e]=d}else{var e=this.getSimpleInputs();ssys.updateObject(b,e)}this.removeErrors();return b},removeErrors:function(){this.removeClass("ssysErrorElement");this.find(".ssysErrorElement").removeClass("ssysErrorElement");
this.find(".ssysErrorMessage").remove()},updateInputGroup:function(a){for(var b={},c=0,d=a.length;c<d;c++){var e=a[c],f=this.getInputName(e),e=this.getInputElementName(e);if(e=this.elements[e]){var g=e.updateInputData?e.updateInputData():this.getSimpleInputs(e);this.inputElements[f]=e}else g=this.getSimpleInputs()[f];b[f]=g}return b},getInputElementByInputName:function(a){var b=this.inputConfigs;if(b){if($.isArray(b))return this.getInputElementFromInputGroupConfig(b,a);for(var c in b){var d=this.getInputElementFromInputGroupConfig(b[c],
a);if(d)return d}}},getInputElementFromInputGroupConfig:function(a,b){for(var c=0,d=a.length;c<d;c++){var e=a[c];if(b==this.getInputName(e))return this.elements[this.getInputElementName(e)]}},getInputElementName:function(a){return"string"==typeof a?a+"Input":a[1]},getInputName:function(a){return"string"==typeof a?a:a[0]},getSimpleInputs:function(a){a=a||this.domnode;a=$(a).find("*").serializeArray();for(var b={},c=0,d=a.length;c<d;c++){var e=a[c];b[e.name]=e.value}return b},showErrors:function(a){console.error(this.fullname,
"\u8f93\u5165\u6709\u8fd9\u4e9b\u9519\u8bef:",a);if("string"==typeof a)this.showError(a);else if(!$.isArray(a)&&"object"==typeof a)for(var b in a){var c=a[b],d=this.getInputElementByInputName(b);if(d&&d.showErrors)d.showErrors(c);else if(this["show"+b+"Error"])this["show"+b+"Error"](c);else this.showError(c,b)}},showError:function(a,b){this.find(":visible[input_name='"+b+"']").addClass("ssysErrorElement").after("<div class='ssysErrorMessage'>"+a+"</div>")},getDom:function(a){if(void 0===a||null===
a)console.error(this.fullname,"getDom(path)\u51fa\u9519\u4e86!path\u4e0d\u80fd\u662f",a,"!");else{if(a.appendChild)return a;if("string"==typeof a){var b=a.match(/^(\w+)(\/(.+))?$/);if(b){a=b[3];var b=this.fullname+"__"+b[1],c=document.getElementById(b);return a?(a.match(/^#/)||(a="#"+b+" "+a),document.querySelector(a)):c}a.match(/^#/)||(a="#"+this.fullname+" "+a);return document.querySelector(a)}if(a.domnode)return a.domnode}},parseLocation:function(a,b){if(b){var c=document.getElementById(this.fullname+
"__"+b);if(c)return[c,"self"]}var c=this.stage,d=null;"string"==typeof a?a.match(/^(append|prepend|after|before)$/)?d=a:c=this.getDom(a):a?$.isArray(a)?(c=a[1],d=a[0]):c=a:d="append";(c=this.getDom(c))&&c.appendChild||console.error(this.fullname,"\u6ca1\u6709\u627e\u5230location=",a,"\u5bf9\u5e94\u7684domnode!");return[d||"append",c]},createHtml:function(a,b,c){var d=a?this.fullname+"__"+a:null,e=document.getElementById(d);e?(e.insertAdjacentHTML("afterend",b),b=e.nextSibling,b.className+=" "+e.className,
e.parentNode.removeChild(e)):(this.stage.insertAdjacentHTML("beforeend",b),b=this.stage.lastChild);b.id=d;b.className+=" "+a;if(c){if(c.data){$(b).data(c.data);for(var f in c.data)b.setAttribute("data-"+f,c.data[f])}c.attr&&$(b).attr(c.attr)}return b},createImage:function(a,b,c){c=c||{};return this.createHtml(a,'<img src="'+b+'" class="img-responsive" alt="'+(c.tooltip||"")+'">',c)},createButton:function(a,b,c,d){d=d||{};b="<button data-state='"+b+"' data-warning='"+(d.warning||"")+"' title='"+(d.tooltip||
"")+"' class='btn btn-"+(d.type||"default")+" "+(d.size?"btn-"+d.size:"")+" "+((d.cssClass||"")+" ssysButton")+"'>";b=d.icon?b+"<span class='fa fa-"+d.icon+"'></span>"+c+"</button>":b+c+"</button>";return this.createHtml(a,b,d)},createLink:function(a,b,c,d){d=d||{};d.icon?c="<span class='fa fa-"+d.icon+"'></span>"+(c||""):d.imgSrc&&(c="<img src='"+d.imgSrc+"' class='"+(d.imgClass||"")+"' ><span>"+(c||"")+"</span>");return this.createHtml(a,d.useHref?"<a href='"+b+"'  title='"+(d.tooltip||"")+"'>"+
c+"</a>":"<a href='javascript:;' class='ssysLink' data-state='"+b+"' title='"+(d.tooltip||"")+"'>"+c+"</a>",d)},createPanel:function(a,b){b=b||{};return this.createHtml(a,'<div class="panel panel-'+(b.type||"default")+'">'+(b.head?'<div class="panel-heading">'+b.head+"</div>":"")+'<div class="panel-body">'+(b.body||"")+"</div>"+(b.footer?'<div class="panel-footer">'+b.footer+"</div>":"")+"</div>",b)},renderStyle:function(){$$.addClass(this.domnode,this.cssClass?this.cssClass:this.style?this.style+
" "+this.name:this.name);this.addCssClass&&$$.addClass(this.domnode,this.addCssClass)},isVisible:function(){return $(this.domnode).is(":visible")},onInitLoadsFailed:function(){}},{fetchCss:function(){if(this.hasCss){var a=this.url.replace(/js$/,"css");ssys.getCss(a)}},create:function(a,b,c){var d=new this;d.parent=a;d.app=a.app;d.name=b;d.fullname=a.fullname+"__"+b;d.params=c=c||[];var e=d.options=c[c.length-1];e&&e.tag&&(d.tag=e.tag);var e=document.getElementById(d.fullname),f=document.createElement(d.tag);
e?$$.moveDom(f,"self",e):a.stage.appendChild(f);f.id=d.fullname;d.domnode=f;d.renderStyle();d.logs=[];d.parent._currentShow[b]=d._currentShow={};a.elements[b]=d;if(d.initLoads||d.beforeInitLoads){d.beforeInitLoads&&d.beforeInitLoads.apply(d,c);var g=d._loadByConfigs(d.parseConfig(d.initLoads)).pipe(function(){if(d.onInitLoadsSucceed)d.onInitLoadsSucceed();return d.init.apply(d,c)},function(){console.error(d.fullname,"initLoads\u5931\u8d25\u4e86!");return d.onInitLoadsFailed()});d._setState=d.setState;
d.setState=function(a,b,c){return g.pipe(function(){d.setState=d._setState;return d.setState(a,b,c)})}}else d.init.apply(d,c);return d},ex_DataBinding:{bindingDatas:[],getDataByPath:function(a){return this.app.getData(a)},remove:function(){this.parentCall("remove");for(var a=0,b=this.bindingDatas.length;a<b;a++)delete this.bindingDatas[a].views[this.fullname]},onDataChange:function(a){this.dataChanged=!0;if(this.isVisible())this.refresh();else{for(a=this;"-"!=a.state&&a.parent;)a=a.parent;a!=this&&
(a.outdatedElements[this.fullname]=this)}},display:function(){this.dataChanged&&(this.refresh(),this.dataChanged=!1);return this.parentCall("display")},afterInit:function(){for(var a=0,b=this.bindingDatas.length;a<b;a++){var c=this.bindingDatas[a];this[c]?this[c].views||console.error(this.fullname,"\u6570\u636e\u7ed1\u5b9a\u51fa\u9519!\u540d\u4e3a",c,"\u7684data\u6ca1\u6709views\u5c5e\u6027!this[name].views=",this[c].views):console.error(this.fullname,"\u6570\u636e\u7ed1\u5b9a\u51fa\u9519!\u5b83\u6ca1\u6709\u540d\u4e3a",
c,"\u7684data");this[c].views[this.fullname]=this}}}},"View");$$.View.Loop=$$.View.createSubclass({elementConfigRules:[[/^item(\d+)$/,"${element}"]],parse_i:function(a,b){return'"${datas.'+b[1]+(a?"."+a:"")+'}"'},beforeInit:function(a){this.options=a;this.datas=a.datas;this.initShow=[];a.head&&this.initShow.push(a.head);this.element=a.element;this.initShow=$$.clone(this.initShow);for(var b=0,c=this.datas.length;b<c;b++)this.initShow.push("item"+b);a.foot&&this.initShow.push(a.foot)}});$$.View.Input=$$.View.createSubclass({defaultState:"start",errorConfigs:{empty:"\u8fd9\u662f\u5fc5\u586b\u9879",notUnique:"\u5df2\u7ecf\u6709\u4eba\u4f7f\u7528\u4e86,\u8bf7\u6362\u4e00\u4e2a",tooLong:function(a){return"\u5b57\u6570\u4e0d\u80fd\u8d85\u8fc7"+a},tooShort:function(a){return"\u5b57\u6570\u4e0d\u80fd\u5c11\u4e8e"+a},tooBig:function(a){return"\u4e0d\u80fd\u5927\u4e8e"+a},tooSmall:function(a){return"\u4e0d\u80fd\u5c0f\u4e8e"+a},notEmail:function(){return"\u8bf7\u586b\u5199\u6b63\u786e\u7684\u90ae\u7bb1\u5730\u5740"},
notUrl:function(){return"\u8bf7\u586b\u5199\u6b63\u786e\u7684\u7f51\u5740"},notNumber:function(){return"\u8bf7\u586b\u5199\u6b63\u786e\u7684\u6570\u5b57"}},style:"ssysInput form-group",setInputData:function(a){this.input.val(a)},updateInputData:function(){this.removeErrors();return this.inputData=this.input.val()},showError:function(a){optionsErrors=(this.options||this.params[0]||{}).errors||{};if("object"==typeof a)var b=a.errorType,c=a.errorContent;else b=a;b=optionsErrors[b]||this.errorConfigs[b]||
null;"function"==typeof b?a=b.call(this,c):"string"==typeof b&&(a=b);this.addClass("has-error");this.append('<label class="control-label" for="inputError">'+a+"</label>")},removeErrors:function(){this.removeClass("ssysErrorElement has-error");this.find(".control-label").remove()},beforeInit:function(a){this.options=a||{}},afterInit:function(){this.input=this.find("input.form-control")}});
$$.View.NumberInput=$$.View.Input.createSubclass({style:"form-group input-group",template:"<span class='input-group-addon'><span class='fa fa-${options.icon}'></span></span><input class='ssysNumberInput form-control' value='${options.defaultValue}' placeholder='${options.placeholder}'><span class='input-group-addon'>${options.unit}</span>",updateInputData:function(){this.removeErrors();return this.inputData=this.input.val()},setInputData:function(a){this.input.val(a)}});
$$.View.StringInput=$$.View.Input.createSubclass({style:"form-group",beforeInit:function(a){this.options=a;var b=a.defaultValue;this.html((a.label?"<label class='col-xs-2'>"+a.label+"</label>":"")+"<div class='"+(a.inputClass||(a.label?"col-xs-10":"input-group"))+"'>"+(a.icon?"<span class='input-group-addon'><span class='fa fa-"+a.icon+"'></span></span>":"")+"<input class='form-control' placeholder='"+(a.placeholder||"")+"' value='"+(b||"")+"' >"+(a.help?"<div class='help-block'>"+a.help+"</div>":
"")+"</div>");this.input=$(this.domnode).find("input").data("defaultValue",b);ssys.isIE&&void 0===b&&this.input.placeholder()}});$$.View.BooleanInput=$$.View.Input.createSubclass({style:"checkbox",beforeInit:function(a,b){this.html("<label><input type='checkbox' checked='"+(b||"false")+"'> "+a+"</label>")},setInputData:function(a){this.find("input").prop("checked",a)},updateInputData:function(){this.removeErrors();return this.inputData=this.find("input").prop("checked")}});
$$.View.TextInput=$$.View.Input.createSubclass({addCssClass:"textInput",beforeInit:function(a){this.max=a.max;var b=a.defaultValue||"";this.html("<textarea class='form-control' placeholder='"+(a.placeholder||"")+"' value='"+b+"'></textarea><div><small>"+(a.note||"")+(this.max?"<span class='textMax'>\u5b57\u6570\u4e0d\u80fd\u8d85\u8fc7"+this.max+"</span>":"")+"</small></div>");var c=this,d=a.richOptions;if(d){this.isRich=!0;a=ssys.sresBaseUrl+"lib/summernote/summernote.js";var e=ssys.sresBaseUrl+"lib/summernote/summernote.css",
f=this.app.uploadBaseUrl+"images/",c=this;return ssys.getJs(a).pipe(function(){ssys.getCss(e);ssys.merge(d,{width:700,height:300,locale:"zh-CN",uploadImageUrl:c.app.baseUrl+"uploader/uploadImage.php",uploadUrl:f,toolbar:[["style",["bold","italic","underline","clear"]],["fontsize",["fontsize"]],["color",["color"]],["para",["ul","ol","paragraph"]],["height",["height"]],["insert",["picture","link"]],["view",["codeview"]]],currentUser:c.app.currentUser});$("#"+c.fullname+" textarea").summernote(d)})}ssys.isIE&&
void 0===b&&$("#"+c.fullname+" textarea").placeholder();a.autoheight&&(c=this,b=$("#"+c.fullname+" textarea"),b.keyup(function(a){c.autoheight()}),b.css({height:2.5*(a.rows||1)+"em","min-height":a.minHeight||"1em","max-height":a.maxHeight||"10em",resize:"none"}),this.autoheight())},autoheight:function(){var a=$("#"+this.fullname+" textarea");if(!a.prop("scrollTop")){do{var b=a.prop("scrollHeight"),c=a.height();a.height(c-5)}while(b&&b!=a.prop("scrollHeight"))}a.height(a.prop("scrollHeight")-10)},
afterInit:function(){},setInputData:function(a){if(this.isRich)return this.find(".note-editable").html(a);this.find("textarea").val(a.replace(/\n/g,"<br>"))},updateInputData:function(){this.removeErrors();return this.isRich?this.find(".note-editable").code():this.inputData=this.find("textarea").val()}});
$$.View.PasswordInput=$$.View.Input.createSubclass({style:"form-group",beforeInit:function(a){a=a||{};this.html("<div class='input-group'><span class='input-group-addon'><span class='fa fa-key'></span></span><input class='form-control' placeholder='"+(a.placeholder||"\u8f93\u5165\u5bc6\u7801")+"' type='password'></div>");this.input=this.find("input")},updateInputData:function(){this.removeErrors();password=this.input.val();if(!password)throw this.showError("\u5fc5\u987b\u586b\u5199\u5bc6\u7801"),
Error("\u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a");return this.inputData=password}});
$$.View.RegisterPasswordInput=$$.View.Input.createSubclass({beforeInit:function(a,b){this.html("<label>\u8f93\u5165\u5bc6\u7801: </label><div class='form-group'><input class='password form-control' placeholder='"+(a||"\u5bc6\u7801")+"' type='password'><div class='help-block'>"+(b||"")+"</div></div><label>\u786e\u8ba4\u5bc6\u7801: </label><div class='form-group'><input class='confirmPassword form-control' placeholder='\u786e\u8ba4\u5bc6\u7801' type='password'></div>")},updateInputData:function(){var a=
this.find(".password").val(),b=this.find(".confirmPassword").val();this.removeErrors();if(!a)throw this.showError("\u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a","password"),Error("\u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a");if(!b)throw this.showError("\u786e\u8ba4\u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a","confirmPassword"),Error("\u786e\u8ba4\u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a");if(a!=b)throw this.showError("\u5bc6\u7801\u4e0d\u4e00\u81f4","confirmPassword"),Error("\u5bc6\u7801\u4e0d\u4e00\u81f4");return this.inputData=
a}});$$.View.Navbar=$$.View.createSubclass({defaultState:"start",tag:"nav",style:"navbar",template:'<div class="container"><div class="navbar-header">${collapseButton}${brand}</div><nav role="navigation" class="${collapsingClass}"><ul class="nav navbar-nav navbar-left"></ul><ul class="nav navbar-nav navbar-right"></ul><div class="navbar-form navbar-middle "><div class="navbar-title">${title}</div></div></nav></div>',beforeInit:function(a){this.collapsable=a.collapsable||!1;this.selectable=void 0===a.selectable?
!0:a.selectable;this.links=a.links;this.rightLinks=a.rightLinks;this.logoSrc=a.logoSrc||"";this.brandHref=a.brandHref||"";this.brandLabel=a.brandLabel||"";this.title=a.title||"";a.cssClass&&this.addClass(a.cssClass);if(a.elementConfigs){this.elementConfigs=$$.merge($$.clone(a.elementConfigs),this.elementConfigs);this.initShow=$$.clone(this.initShow);for(var b in a.elementConfigs)this.initShow.push(b)}},get_collapseButton:function(){return this.collapsable?'<button data-target=".navbar-collapse" data-toggle="collapse" type="button" class="navbar-toggle"><span class="icon-bar"></span> <span class="icon-bar"></span><span class="icon-bar"></span></button>':
""},get_collapsingClass:function(){return this.collapsable?"collapse navbar-collapse":""},get_brand:function(){return this.logoSrc?'<a class="navbar-brand" href="${brandHref}">${brandLabel}<img src="${logoSrc}"></a>':""},afterInit:function(){var a=0;if(this.links)for(var b=this.getDom("ul.navbar-left"),c=this.links.length;a<c;a++){var d=this.links[a];this.addLink(d,a,b)}if(this.rightLinks)for(var b=this.getDom("ul.navbar-right"),e=0,c=this.rightLinks.length;e<c;e++)d=this.rightLinks[e],this.addLink(d,
a+e,b);this.selectable&&this.activate(0)},addLink:function(a,b,c){c.innerHTML+='<li id="'+(this.fullname+"__li"+b)+'"><a class="ssysLink" id="'+this.parent.fullname+"__link"+b+'" data-state="'+a[0]+'" data-warning="'+(a[2]||"")+'" href="javascript::;">'+a[1]+"</a></li>"},activate:function(a,b){var c=null===a?$(this.getDom('a[data-state="'+b+'"]')).parent():$("#"+this.fullname+"__li"+a),d=this.getDom("li.active");d&&$(d).removeClass("active");c.addClass("active")}},{hasCss:!0});$$.View.Carousel=$$.View.createSubclass({affectParent:!1,style:"carousel slide",template:'<ol class="carousel-indicators"></ol><div class="carousel-inner"></div><a class="left carousel-control" href="#${fullname}" data-slide="prev"><span class="fa fa-chevron-left"></span></a><a class="right carousel-control" href="#${fullname}" data-slide="next"><span class="fa fa-chevron-right"></span></a>',afterInit:function(a){$(this.domnode).attr("data-ride","carousel");for(var b=$(this.domnode).find(">.carousel-indicators"),
c=$(this.domnode).find(">.carousel-inner"),d=0,e=a.length;d<e;d++){var f=a[d];0==d?(b.append('<li data-target="#'+this.fullname+'" data-slide-to="0" class="active"></li>'),c.append('<div class="item active"><a href="'+f.href+'"><img src="'+f.src+'" alt="'+(f.alt||"")+'"><div class="carousel-caption"><h3>'+f.caption+"</h3></div></a></div>")):(b.append('<li data-target="#'+this.fullname+'" data-slide-to="'+d+'"></li>'),c.append('<div class="item"><a href="'+f.href+'"><img src="'+f.src+'" alt="'+(f.alt||
"")+'"><div class="carousel-caption"><h3>'+f.caption+"</h3></div></a></div>"))}$(this.domnode).carousel()}});$$.View.Paginator=$$.View.createSubclass({defaultState:"start",tag:"div",template:'<ul class="pagination pagination-sm"><span class="pull-right label label-default">\u5171${sum}\u6761</span></ul>',beforeInit:function(a,b,c,d,e){this.hostView=e||this.parent;this.sum=a||0;this.limit=b||20;this.page=c||1;this.size=d||7;this.pages=Math.ceil(a/this.limit)},mg_filterConfigRules:[[/^\d+$/,["page"]]],filter_page:function(a){this.hostView.onPageChange(a);return a},afterInit:function(){var a="",b=this.pages,
c=this.size;if(!(2>this.pages)){if(b>c){var d=Math.floor((this.size-1)/2);this.page<=d&&(d=this.page-1);c=this.size-d-1;this.page+c>b&&(c=b-this.page,d=this.size-c-1);d=this.page-d;1!=d&&(a='<li><a id="'+this.fullname+'__first" href="javascript::;" class="ssysLink" name="1">\u9996\u9875</a></li>');c=this.page+c;if(c<b)var e=!0}else c=b,d=1;for(;d<=c;d++)a=d==this.page?a+'<li class="active"><a id="'+this.fullname+"__page"+d+'" href="javascript::;" class="ssysLink" name="'+d+'">'+d+"</a></li>":a+'<li><a id="'+
this.fullname+"__page"+d+'" href="javascript::;" class="ssysLink" name="'+d+'">'+d+"</a></li>";e&&(a=a+'<li><a id="'+this.fullname+'__last" href="javascript::;" class="ssysLink" name="'+b+'">\u672b\u9875</a></li>');a=a+'<span class="pull-right label label-default">\u5171'+this.sum+"\u6761</span>";this.domnode.innerHTML=a}},navigate:function(a){this.page=parseInt(a);this.afterInit();this.hostView.onPageChange(a)}});$$.App=$$.O.createSubclass({format:"json",rememberFor:2592E6,temp:{},_$$:function(a){var b;if(b=a.match(/^r_(\w+)$/))return this.getResource(b[1]);if(b=a.match(/^v_([\w:]+)$/))return a=b[1].replace(/:/g,"/"),this.getPage(a);if(b=a.match(/^l_([\w:]+)$/))return a=b[1].replace(/:/g,"/"),this.getLib(a);console.error(this,"\u65e0\u6cd5\u8bfb\u53d6step",a,"!");return ssys.reject()},baseUrl:"",init:function(a){var b=this;a=a||document.body.appendChild(document.createElement("div"));this.createCurrentUser();
b.setLayout(a);$("body").on("click","a.ssysLink,.ssysButton",function(a){a.preventDefault();a.stopPropagation();a=b.layout;if("confirm"==a.preventClick){if(0==confirm("\u6b63\u5728\u81ea\u52a8\u64ad\u653e\u9875\u9762, \u4f60\u7684\u624b\u52a8\u64cd\u4f5c\u4f1a\u5bfc\u81f4\u64ad\u653e\u4e2d\u65ad, \u4f60\u786e\u5b9a\u8981\u7ee7\u7eed\u5417?"))return;a.stop()}var d=$(this);ssys.preloading=!1;var e=b.getParentView(d),f=d.data("state");if(null===f||void 0===f)if(f=d.attr("name"),null===f||void 0===f)f=
d.attr("href");if(d.data("warning")){var g=$('<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"><div class="modal-dialog">    <div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>        <h4 class="modal-title" id="myModalLabel">\u6ce8\u610f</h4></div><div class="modal-body"><div class="alert alert-warning">'+d.data("warning")+'</div></div><div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal">\u53d6\u6d88</button><button type="button" class="confirm btn btn-primary">\u786e\u5b9a</button></div></div></div></div>').modal({show:!0});
g.find("button.confirm").click(function(){g.modal("hide");e.setState(f,{type:"confirm",element:d},!0)})}else e.setState(f,{type:"click",element:d},!0)});$("body").on("keyup",".ssysInput textarea",function(a){a=$(this).parent();var d=b.getViewByName(a.attr("id")).max;if(d){var e=$(this).val().length,d=d-e;0<=d?a.find(".textMax").html("\u8fd8\u80fd\u518d\u8f93\u5165"+d+"\u4e2a\u5b57"):a.find(".textMax").html("\u5b57\u6570\u5df2\u7ecf\u8d85\u8fc7\u9650\u5236\u957f\u5ea6\u4e86,\u8981\u51cf\u5c11"+-d+
"\u4e2a\u5b57")}})},getParentView:function(a){a.data("parentView")?a=a.data("parentView"):(a=a.attr("id"))?(a=a.split("__"),a.pop(),a=a.join("__"),a=this.getViewByName(a)):a=this.layout;return a},refresh:function(){location.reload()},getSessionId:function(){var a=this;this.sessionId=null;return this.get("ssys/getSessionId",{refresh:$.now()},!0,"jsonp").pipe(function(b){return a.sessionId=b})},loadByConfigs:function(a){var b=this;return ssys.asyncLoopDefer(a,function(a){if("string"==typeof a){var d=
a;a=null}else d=a[0],a=a[1];return b.get(d,a,!0)},function(a){console.error("loadByConfigs\u6709"+a+"\u4e2a\u5931\u8d25\u4e86!");return ssys.resolve()})},getAppModel:function(){var a=this;return ssys.scenter.getResource("app").pipe(function(b){return b.getModelByAttributes({name:this.name}).pipe(function(b){a.appModel=b;a.appid=b.id})})},getUrl:function(a,b){a=this.addFormat(a);b&&(a=ssys.addParams(a,b));this.baseUrl&&("/"==a.charAt(0)&&(a=a.substr(1)),a=this.baseUrl+a);return a},get:function(a,b,
c,d){if(b){var e=b.refresh;a=this.getUrl(a,b)}else e=!1,a=this.getUrl(a);this.isWidget?c?d?(a=a.replace(".json",".jsonp"),a=ssys.getJsonp(a,!0)):(this.sessionId&&(a=ssys.addParams(a,{PHPSESSID:this.sessionId})),a=ssys.xhrget(a,!0,e,!0)):a=ssys.getJs(a):a=ssys.xhrget(a,c,e);return a.pipe(function(a){return a&&a.error?ssys.reject(a.error):a})},addFormat:function(a,b){b=b||this.format;return a.match(/\.\w+($|\?)/)?a:a+"."+b},post:function(a,b,c){a=this.baseUrl+a.substr(1);this.sessionId&&(a=ssys.addParams(a,
{PHPSESSID:this.sessionId}));return ssys.xhrpost(a,b,c,this.isWidget)},getPageUrl:function(a){a=a.replace(/_p_/g,"/");return this.staticBaseUrl+"pages/"+a+".js"},getLibUrl:function(a){if("#"==a.charAt(0))return ssys.staticBaseUrl+a.substr(1);if("/"!=a.charAt(0))var b=this.staticBaseUrl;else a=a.split(/^(\w+)\//),b=a[1],a=a[2],b=ssys[b].staticBaseUrl;return b+"lib/"+a+".js"},getViewByName:function(a){a=a.split("__");var b=this.layout;a.shift();for(var c=0,d=a.length;c<d;c++)b=b.elements[a[c]];return b},
getPage:function(a){var b=this.pages[a];if(b)return ssys.resolve(b);var c=this.getPageUrl(a),d=this;return $$.getJs(c).pipe(function(){return d.pages[a]},function(){console.error("\u52a0\u8f7d\u9875\u9762url=",c,"\u5931\u8d25\u4e86!")})},getLib:function(a){a=this.getLibUrl(a);return ssys.getJs(a)},getResource:function(a){var b=this;return this.resources[a]?ssys.resolve(this.resources[a]):ssys.getJs(this.staticBaseUrl+"resources/"+a+".js").pipe(function(){return b.resources[a]})},addPage:function(a,
b,c,d,e){d=d||this.self.Page;b=d.createSubclass(b,c,e);b.path=a;b.url=this.getPageUrl(a);b.fetchCss();return this.pages[a]=b},addLayoutClass:function(a,b,c){return this.addViewClass("layouts/"+a,b,c,SsysLayout)},addResource:function(a,b){return this.self.Resource.create(this,a,b)},createCurrentUser:function(){this.currentUser=$$.User.create(this)},setLayout:function(a){a=this.self.Layout.create(this,a);var b=$$.getStorage("initState");void 0===b&&(b=a.getStateByAnchor());sessionStorage.removeItem("initState");
a.setState(b,{type:"setLayout"});return a},getData:function(a){if(a=this.dataBindings[a])return a.data},setData:function(a){var b=a.dataPath;if(b){var c=this.dataBindings[b];c?(c.data!=a&&this.updateViews(c,a),c.views.push(view)):this.bindingDatas[b]={data:a,views:[],path:b}}else console.error("setData\u5931\u8d25, \u8be5data",a,"\u7f3a\u4e86dataPath!")},bindData:function(a,b,c){var d=this.dataBindings[a];d?(d.data!=b[c]&&(d.data=data,this.updateViews(d)),d.views.push(b)):(d=this.dataBindings[a]=
{data:b[c],views:[b],path:a},b.dataBindings[a]={binding:d,localName:c})},updateViews:function(a){for(var b=a.views,c=a.data,d=0,e=b.length;d<e;d++){var f=b[d],g=f.dataBindings[a.path].localName;f[g]!=c&&(f[g]=c,f.update())}}},{Layout:$$.View.createSubclass({mg_showConfigs:{index:["p_index"]},mg_filterConfigRules:[[/^index|^p_([\w:]+)/,["page"]]],mg_elementConfigRules:[[/^p_([\w:]+)$/,["${app.pages.$1}"]],[/^(\w+)/,["${app.resources.$1.ResourceView}"]]],filter_page:function(a){var b="index"==a?"index":
a.match(/^p_([\w:]+)/)[1];return this.app.getPage(b).pipe(function(){return a},function(){if("error"!=b)return"p_error/"+a;console.error("\u6ca1\u6709\u627e\u5230"+b+"\u9875\u9762!\u8bf7\u68c0\u67e5/static/pages/"+b+".js\u6587\u4ef6")})},getStateByAnchor:function(){var a=ssys.getAnchor();a||(a="");return a},afterShow:function(a){this.parentCall("afterShow",[a]);$$.setAnchor("index"!=a?a:"");return a},onLogin:function(){this.app.refresh()},onLogout:function(){this.app.refresh()}},{create:function(a,
b){var c=new this;c.app=a;c.domnode=b;c.fullname=a.name;b.id=c.fullname;c.views={};c.elements={};c.outdatedElements={};c.logs=[];c._currentShow={};a.layout=c;if(c.initLoads||c.beforeInitLoads){c.beforeInitLoads&&c.beforeInitLoads();var d=c._loadByConfigs(c.parseConfig(c.initLoads)).pipe(function(){if(c.onInitLoadsSucceed)c.onInitLoadsSucceed();return c.init()},function(){console.error(c.fullname,"initLoads\u5931\u8d25\u4e86!");return c.onInitLoadsFailed()});c._setState=c.setState;c.setState=function(a,
b,g){return d.pipe(function(){c.setState=c._setState;return c.setState(a,b,g)})}}else c.init();return c}}),Page:$$.View.createSubclass({style:"page"}),create:function(){var a=new this;a.pages={};a.resources={};a.dataBindings={};return a}},"App");$$.User=$$.O.createSubclass({isAdmin:function(){return this.userModel&&this.userModel.role&&this.userModel.role.match(/admin/)},getCurrentUser:function(){var a=this;return this.app.get("ssys/getCurrentUser",{refresh:$.now()}).pipe(function(b){a.userMode=a.app.resources.user.getModelByTuple(b);a.storageUser();return a.userModel})},login:function(a,b,c,d){var e=this.app;return e.resources.user.getModelByUrl("/ssys/xhrLogin",{loginParams:[a,b,c||null]}).pipe(function(a){localStorage.clear();return e.currentUser.loginByUserModel(a,
c,d)},function(a){if(2==a)var b={password:"\u5bc6\u7801\u9519\u8bef"};else 1==a?b={username:"\u60a8\u8f93\u5165\u7684\u7528\u6237\u540d\u5c1a\u672a\u6ce8\u518c"}:"wrongEmail"==a&&(b={username:"\u8be5\u90ae\u7bb1\u5c1a\u672a\u6ce8\u518c"});return b})},loginByUserModel:function(a,b,c){this.userModel=a;a.userRelation="me";this.id=a.id;this.username=a.username;this.remember=b;this.storageUser();if(this.app.layout&&!c)this.app.layout.onLogin()},storageUser:function(){var a=this.remember?$.now()+this.app.rememberFor:
null;$$.setStorage("userTuple",this.userModel.tuple,a);console.debug("userTuple","userTuple=",$$.getStorage("userTuple"))},logout:function(){var a=this;this.app.get("ssys/logout").always(function(){localStorage.clear();sessionStorage.clear();a.id=null;a.username=null;a.userModel=null;if(a.app.layout)a.app.layout.onLogout()})}},{create:function(a){var b=new this;b.app=a;var c=$$.getStorage("userTuple");if(c){var d=a.resources.user.getModelByTuple(c);b.loginByUserModel(d);b.getCurrentUser().pipe(function(a){d.id==
a.id&&d.username==a.username||b.loginByUserModel(a)},function(){b.logout()})}return b}},"User");$$.Resource=$$.App.Resource=$$.O.createSubclass({format:"json",collectionConfigs:{},extendProperty:function(a,b){this.parentCall("extendProperty",[a,b]);this[a].prototype.app=this.app;this[a].prototype.resource=this},_$$:function(a){var b;if("sum"==a)return this.getDataByAction("sum");if(b=a.match(/^(\d+)$/))return this.getModel(b[1]);console.error(this,"\u65e0\u6cd5\u8bfb\u53d6step",a,"!");return ssys.reject()},createModel:function(a){var b="/"+this.name+"/create.json",c=this;a=ssys.mapToList(a,
c.Model.prototype.creationParams);return c.app.post(b,{SsysCreationParams:ssys.jsonEncode(a)}).pipe(function(a){a=c.getModelByTuple(a);var b=c.afterCreate(a);return b&&b.pipe?b:a})},afterCreate:function(a){var b=this.collections,c;for(c in b){var d=b[c];if(d.include(a)){d.newModels.push(a);d.sum++;for(var e in d.views)d.views[e].onDataChange()}}},createModelArchetype:function(a){a=ssys.mapToList(a,this.Model.prototype.attris);return this.getModelByTuple(a,!0)},isUnique:function(a,b){return this.getDataByAction("isUnique",
{attr:a,value:b})},getAttri:function(a,b){return this.getDataByUrl(a+"/"+b+"."+this.format)},getModel:function(a){return this.models[a]?ssys.resolve(this.models[a]):this.getModelByUrl(a+"."+this.format)},getModelByTuple:function(a,b){return this.Model.create(a,b)},getModelByAttributes:function(a){return this.getModelByUrl("findByAttributes."+this.format,{attris:a})},getModelByAction:function(a,b){return this.getModelByUrl(a+"."+this.format,b)},getModelByUrl:function(a,b,c){var d=this;return this.getDataByUrl(a,
b,"get",c).pipe(function(c){var f=d.getModelByTuple(c),g=f.getUrl();a=d.app.getUrl("/"+d.name+"/"+a,b);a=a.replace(/((\?|\&)refresh=\d+$)|refresh=\d+\&/,"");ssys.cache[a]="ssys:"+g;ssys.cache[g]=c;return f})},getModelsByAttributeValueSet:function(a,b){return this.getModelsByUrl("getItemsByAttributeValueSet."+this.format,{attri:a,set:b},!0)},getModelsByUrl:function(a,b,c){var d=this;b=b||{};return b.returnsum?this.getDataByUrl(a,b):this.getDataByUrl(a,b).pipe(function(a){return d.getModelsByTuples(a)}).pipe(function(e){if(c)return e.sum=
e.length,e;b.returnsum=1;return d.getDataByUrl(a,b).pipe(function(a){e.sum=a;return e})})},getModelsByTuples:function(a){for(var b=[],c=0,d=a.length;c<d;c++){var e=this.getModelByTuple(a[c]);b.push(e)}return b},getDataByAction:function(a,b,c,d){return this.getDataByUrl(a+"."+("post"==c?"json":this.format),b,c,d)},getDataByUrl:function(a,b,c,d){a=""+a;"/"!==a.charAt(0)&&(a="/"+this.name+"/"+a);return"post"==c?this.app.post(a,b,!0):this.app.get(a,b,!0,d)},loadByConfig:function(a){var b;if(b=a.match(/^(\d+)$/))return this.getModel(b[1]);
if(a.match(/^{(.+)}$/)){a=JSON.parse(a);if(a.action){var c=a.action;delete a.action;return this.getModelByAction(c,a)}return a.method?(c=a.method,delete a.method,this[c](a)):this.getModelByAttributes(a)}return(b=a.match(/^([^\[\]]+)(\[([^\[\]]*)\]$)/))?(c=this.getCollection(b[1]),b[3]?"number"==typeof b[3]?c.fetch({page:b[3]}):"string"==typeof b[3]&&b.match(/^{/)?(a=JSON.parse(b[3]),c.fetch(a)):ssys.reject(this.name,"loadByConfig\u65e0\u6cd5\u8bc6\u522bpath=",a,"\u4e2d\u7684",b[3],",\u8bf7\u68c0\u67e5\u662f\u5426\u5199\u9519\u4e86!"):
c.fetchSum()):this.getDataByUrl(a)},getCollection:function(a){return this.collections[a]=this.collections[a]||this.addCollection(a)},addCollection:function(a){var b;if(b=a.match(/^((@)?\w+)(\{.+$)?/))var c=b[2]?"Collection":b[1],d=b[3],d=d?JSON.parse(d):{};else console.error(this.name,"\u7684collection path",a,"\u4e66\u5199\u4e0d\u7b26\u5408\u89c4\u8303!\u5fc5\u987b\u662f\u7c7b\u4f3cTypename{params1:xx,params2:xxx}\u8fd9\u6837\u7684\u5f62\u5f0f");(b=this.collectionConfigs[c])&&$$.merge(d,b);d.path=
a;return this.Collection.create(d)},deleteAll:function(a){return this.getDataByAction("deleteAll",{ids:a})}},{create:function(a,b,c){var d=new this;a.resources[b]=d;d.name=b;d.fullname=a.name+"__res_"+b;d.app=a;d.models={};d.views={};d.collections={};d.extendProperties(c);return d}},"Resource");$$.Model=$$.Resource.Model=$$.O.createSubclass({creationParams:[],attris:["id"],implAttris:null,implAttrisConfigs:null,defaultValues:{},validationRules:{},uneditable:["id","creator_id","updated_at","created_at"],editableRoles:["creator","owner","admin"],relations:{},_clearCache:function(){var a=this.relations,b;for(b in a)delete this[b],delete this["many__"+b],delete this["count__many__"+b]},_$$:function(a){var b;if(b=this.relations[a]){b=this.parseConfig(b);var c=b.shift();"hasMany"!=c||b[2]||(b[2]=
{});b.push(args);b.unshift(a);return this[c].apply(this,b)}return(b=a.match(/^count__(.+)/))?(a=b[1],b=this.relations[a],b=this.parseConfig(b),c=b.shift(),"hasMany"!=c||b[2]||(b[2]={}),b.push(args),b.unshift(a),this["count_"+c].apply(this,b)):$$.reject()},get_uri:function(){return"#"+this.resource.name+"Resource/"+this.id},get_subjecttype:function(){return $$.capitalize(this.resource.name)},hasMany:function(a,b,c,d,e){var f=this["many__"+a]||{};e=e||[];e[0]=e[0]||1;e[1]=e[1]||20;e[2]=e[2]||"";e[3]=
e[3]||"";e[4]=e[4]||!1;e[5]=e[5]||!1;var g=JSON.stringify(e);if(f[g]&&!$$.isRefresh)return $$.resolve(f[g]);d=d||{};d[c]=this.id;e.unshift(d);var h=this;return this.$$(b+"/m_getModelsByAttributes",e).pipe(function(b){f[g]=b;h["many__"+a]=f;return b})},count_hasMany:function(a,b,c,d,e){var f=this["count__many__"+a];if(f&&!$$.isRefresh)return $$.resolve(f);e=e?this.parseConfig(e):[];d=d||{};d[c]=this.id;e.unshift(d);e[5]=1;var g=this;return this.$$(b+"/m_getModelsByAttributes",e).pipe(function(b){return g["count__many__"+
a]=b})},manyAction:function(a,b,c,d,e){var f=this["many__"+a]||{};e=e||[];var g=e[0]||1;if(f[g]&&!$$.isRefresh)return $$.resolve(f[g]);d=$$.merge(d||{},{page:g,limit:e[1]||20,order:e[2]||""});var h=this;return this.$$(b+"/m_getModelsByAction",[c,d]).pipe(function(b){f[g]=b;h["many__"+a]=f;return b})},count_manyAction:function(a,b,c,d){var e=this["count__many__"+a];if(e&&!$$.isRefresh)return $$.resolve(e);d=d||{};d.returnsum=1;var f=this;return this.$$(b+"/m_getModelsByAction",[c,d]).pipe(function(b){return f["count__many__"+
a]=parseInt(b)})},belongTo:function(a,b,c){var d=this;return this.$$(b+"/"+this[c]).pipe(function(b){return d[a]=b})},impl:function(){if(this.typedata){this.implAttris||(this.implAttris=this.implAttrisConfigs[this.typename]);for(var a=0,b=this.implAttris.length;a<b;a++)this[this.implAttris[a]]=this.typedata[a]}},init:function(){this.id&&this._clearCache()},save:function(){var a=this;return this.validate().pipe(function(b){if(a.id)return a.resource.getDataByAction("update",{id:a.id,SsysUpdateParams:$$.jsonEncode(b)},
"post").pipe(function(b){$$.cache[a.getUrl()]=b;return a.typename?a.typename==a.shortClassname?a.pull(b):a.resource.modelClass[a.typename].create(b):a.pull(b)});for(var c=a.implAttris||[],d=[],e=0,f=c.length;e<f;e++)d[e]=b[c[e]];b.typedata=d;return a.resource.createModel(b)})},getAttributesToSave:function(){var a={};if(this.id){for(var b=this.attris,c=this.resource.models[this.id].tuple,d=0,e=b.length;d<e;d++){var f=b[d],g=this[f];g!=c[d]&&(a[f]=g)}this.removeUnsavableChanges(a)}else for(b=this.creationParams,
d=0,e=b.length;d<e;d++)c=b[d],a[c]=this[c];return a},removeUnsavableChanges:function(a){for(var b=0,c=this.uneditable.length;b<c;b++)delete a[this.uneditable[b]];return a},validate:function(a,b){a=a||this.getAttributesToSave();b=b||this.validationRules;var c=this,d=$$.resolve(),e=null,d=$$.loopDefer(a,null,function(d){var g=d[0],h=d[1],m=b[g];if(!m)return $$.resolve(a);d=m[0];return(h=c["validate"+d](g,h,m[1]||{},a))?"string"==typeof h?(e=e||{},e[g]=h,$$.reject(e)):h.pipe?h.pipe(function(a){return a},
function(a){e=e||{};e[g]=a;return e}):$$.reject(c,"\u5bf9",g,"\u7684validator(",d,")\u8fd4\u56de\u7684\u7ed3\u679c\u4e0d\u5bf9!\u53ea\u80fd\u662fstring\u6216deferred object"):$$.resolve()});return d.pipe(function(){return e?$$.reject(e):a})},validateNotNull:function(a,b){if(""===b||null===b||void 0===b)return"empty"},validateUnique:function(a,b){return this.resource.isUnique(a,b).pipe(function(a){if(!a)return $$.reject("notUnique")})},validateEmail:function(a,b,c){$$.merge(c,{isUnique:!0,isNull:!1});
return this.validateString(a,b,c).pipe(function(){return b.match(/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)?b:$$.reject("notEmail")})},validateUrl:function(a,b,c){$$.merge(c,{isNull:!1,max:2E3});return this.validateString(a,b,c).pipe(function(){if(!b.match(/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/))return $$.reject("notUrl")})},validateString:function(a,
b,c){if(!b&&!c.isNull){var d=this.validateNotNull(a,b);if(d)return d}if("string"==typeof b)return(d=c.max)&&b.length>d?{errorType:"tooLong",errorContent:d}:c.isUnique?this.validateUnique(a,b):$$.resolve(b);console.error(this.fullname,"\u7684",a,"=",b,"\u6ca1\u901a\u8fc7validateString\u9a8c\u8bc1!");return $$.reject({error:"\u8be5\u6570\u636e"+JSON.stringify(b)+"\u4e0d\u662fString"})},validateNumber:function(a,b,c,d){if(!b&&!c.isNull){var e=this.validateNotNull(a,b);if(e)return e}b=c.isInt?parseFloat(b):
parseInt(b);if((d[a]=b)||0===b){if(e=c.validator)return this[e](b,d,result,a);if(void 0!==c.max&&b>c.max)return"tooBig";if(void 0!==c.min&&b<c.min)return"tooSmall"}else return"notNumber"},validateModel:function(a,b,c,d){var e=this,f={name:a};if(!b){if("Null"==isNull)return $$.resolve(f);f.error="\u8fd9\u662f\u5fc5\u586b\u9879";return $$.reject(f)}c=this.app.getResource(resourceName);var g=typeof b;if("string"==g||"number"==g){var h=parseInt(b);c=c.pipe(function(a){return a.getModel(h)})}else"object"==
g&&(c=c.pipe(function(a){return a.getModelByAttributes(b)}));return c.pipe(function(c){if(validator)return e[validator](b,d,f,a);f.data=c.id;return f},function(){f.error="\u6ca1\u6709\u627e\u5230\u5bf9\u5e94\u7684\u6570\u636e";return f})},isEditable:function(a){var b=this.getUserRelation();return-1<$.inArray(b,this.editableRoles)?a?-1==$.inArray(a,this.uneditable)?!0:!1:!0:!1},getUrl:function(){return this.app.baseUrl?this.app.baseUrl+this.resource.name+"/"+this.id+"."+this.app.format:"/"+this.resource.name+
"/"+this.id+"."+this.app.format},pull:function(a){var b=this;return a?(b.setTuple(a),b.init(),this!==this.resource.models[this.id]&&b.resource.models[b.id].pull(a),b.onDataChange(),$$.resolve(b)):this.resource.getDataByUrl(this.id,{refresh:$.now()}).pipe(function(a){b.setTuple(a);b.init();b!==b.resource.models[b.id]&&b.resource.models[b.id].pull(a);b.onDataChange();return b})},onDataChange:function(){for(var a in this.views)this.views[a].onDataChange()},setTuple:function(a){if(a.splice){this.tuple=
a;for(var b in a)this[this.attris[b]]=a[b];"string"==typeof this.id&&(this.id=parseInt(this.id));this.implAttris&&this.impl()}else console.error(this,"setTuple\u51fa\u9519!tuple\u5fc5\u987b\u662farray.tuple=",a)},getUserRelation:function(){var a=this.app.currentUser;void 0===this.userRelation&&(this.userRelation=a.id?a.id==this.creator_id?"creator":"admin"==a.userModel.role?"admin":this._getUserRelation(a):"guest");return this.userRelation},_getUserRelation:function(a){return null},getModelViewClass:function(){return this.ModelView=
this.resource.ModelView},createArchetype:function(){this.typename!=this.resource.models[this.id].typename&&(this.typedata=null);var a=$$.mapToList(this,this.attris),a=this.resource.getModelByTuple(a,!0);a.isArchetype=!0;return a}},{create:function(a,b){if(b)var c=new this;else{var d=a[0],c=new this;if(c.resource.models[d])return c.resource.models[d].pull(a),c.resource.models[d]}c.setTuple(a);c.fullAttris=c.attris.concat(c.implAttris||[]);c.views={};c.init();b||(c.resource.models[c.id]=c);return c}},
"Model");$$.Collection=$$.Resource.Collection=$$.O.createSubclass({format:"json",limit:20,update:function(){},sort:function(){},include:function(a){if(this.attris){for(var b in this.attris)if(a[b]!=this.attris[b])return!1;return!0}},storeModels:function(a,b){return this.cache[a]=b},getModels:function(a){if(this.cache[a])return this.cache[a];console.error(this,"\u7b2c",a,"\u9875\u7684\u6570\u636e\u4e3a\u7a7a!\u8bf7\u68c0\u67e5\u662f\u5426\u5df2\u7ecf\u52a0\u8f7d\u4e86\u8be5\u9875.")},getModel:function(a,b){var c=
this.getModels(a);if(c[b])return c[b];console.error(this,"\u7b2c",a,"\u9875\u4e0a\u4e0d\u5b58\u5728\u7b2c",b,"\u4e2amodel!")},fetch:function(a){var b=this;this.handleUpdate();return $$.dfdget(this.cache[a],function(){return b._fetch(a).pipe(function(c){b.storeModels(a,c);return c})})},handleUpdate:function(){this.newModels.length&&(this.cache={},this.newModels=[])},_fetch:function(a){var b=this.attris;a={page:a||1,limit:this.limit||20,order:this.order||"id",condition:this.condition||""};if(b){var c=
"getItemsByAttributes."+this.format;a.attris=b}else this.action?(c=this.action+"."+this.format,$$.merge(a,this.params)):console.error("\u76ee\u524d\u53ea\u652f\u6301attris\u548caction\u4e24\u79cd\u7c7b\u578b\u7684collection!");return this.resource.getModelsByUrl(c,a)},fetchSum:function(){var a=this;if(this.attris)var b="getItemsByAttributes."+this.format,c={attris:this.attris,returnsum:1};else this.action?(b=this.action+"."+this.format,c=$$.clone(this.params),c.returnsum=1):console.error(this,"fetchSum\u51fa\u9519\u4e86!\u8fd8\u672a\u4e3a\u8fd9\u4e2a\u7c7b\u578b\u7684collection\u5199\u600e\u4e48fetchSum\u903b\u8f91");
return this.resource.getDataByUrl(b,c).pipe(function(b){return a.sum=b})}},{create:function(a){a=a||{};o=new this;o.newModels=[];a.action?(o.action=a.action,delete a.action):(o.attris=a.attris||{},delete a.attris);if(a.path){var b=a.path;delete a.path}else{o.action?b="a_"+o.action:o.attris&&(b="attris");var c=JSON.stringify(a);"{}"!=c&&(b+=c)}(c=o.resource)||console.error(o,"\u7684resource\u4e0d\u5b58\u5728!\u8bf7\u68c0\u67e5\u8be5resource\u7684\u5b9a\u4e49\u4ee3\u7801\u6709\u65e0\u9519\u8bef");if(c.collections[b])return c.collections[b];
o.params=a;for(var d in a)o[d]=a[d];o.cache={};o.views={};return c.collections[b]=o}},"Collection");$$.ModelView=$$.Resource.ModelView=$$.View.DataBinding.createSubclass({style:"",defaultState:"start",bindingDatas:["model"],mg_elementConfigs:{content:["Div",[null,null,"${model.content}"]],showDetailsLink:["IconLink",["showDetails","ellipsis-h","<strong>\u67e5\u770b\u66f4\u591a\u7ec6\u8282</strong>"]],hideDetailsLink:["IconLink",["hideDetails","eye-slash","\u6536\u8d77\u7ec6\u8282",["showDetailsLink","after"]]],details:["Div",[["footer","before"],"well","${model.details}"]],userLink:["UserLink",
["${model.creator_id}","","small",null,"pull-left",null,"media-object"]],titleLink:["TitleLink",["#userResource/${model.creator_id}","${model.creator_username}","#${fullname} .media-heading"]],creatorLink:["TitleLink",["#userResource/${model.creator_id}","${model.creator_username}"]],renew:["${resource.CreateView}",["${model}"]],renewButton:["Button",["renew","\u4fee\u6539",{icon:"pencil",type:"warning",size:"sm"}],{hide:"${!model.isEditable()}"}],editLink:["Link",["edit","\u7f16\u8f91",{icon:"pencil",
cssClass:"${editLinkCssClass}"}],{hide:"${!model.isEditable()}"}],uneditLink:["TitleLink",["unedit","\u53d6\u6d88\u7f16\u8f91\u72b6\u6001",null,"ssysUneditLink"]],hideCommentsLink:["IconLink",["hideComments","comment","\u6536\u8d77\u8bc4\u8bba(${model.descendantcount})",null,"ssysHide"]],commentsLink:["IconLink",["comments","comment-o","\u8bc4\u8bba(${model.descendantcount})"]],comments:["app/r_comment/view/subjectComments/ascComments",["${this}"]],create:["CreateView"]},mg_showConfigRules:[[/^$|^index/,
["$l{resource.name}${model.id}"]]],mg_showConfigs:{hideComments:[null,"hideComments"],edit:[null,"edit"],unedit:[null,"unedit"]},beforeInit:function(a){"object"!=typeof a&&(a=this.resource.models[a]);this.model=a;return this._beforeInit()},_beforeInit:function(){},renderStyle:function(){$$.addClass(this.domnode,this.resource.name+"-modelView "+this.style+" "+this.addCssClass)},showDetails:function(){this.elements.details?this.showElements(["details","hideDetailsLink"]):this.showByConfigs(["details",
"hideDetailsLink"]);this.elements.showDetailsLink.hide()},hideDetails:function(){this.hideElements(["details","hideDetailsLink"]);this.showElements(["showDetailsLink"])},get_showedDetails:function(){return this.model.details?'<div id="${fullname}__details" class="alert alert-info col-md-11">${model.details}</div>':""},get_detailsConfig:function(){return this.model.details?'<a id="${fullname}__showDetailsLink" class="showDetailsLink"></a>':'<a id="${fullname}__showDetailsLink" class="showDetailsLink hidden"></a>'},
commentsToggler:'<a id="${fullname}__commentsLink" href="comments" class="ssysLink"><span class="fa fa-comment-o">\u8bc4\u8bba(${model.descendantcount})</a><a id="${fullname}__hideCommentsLink" href="hideComments" class="ssysLink ssysHide"><span class="fa fa-comment"></span>\u9690\u85cf\u8bc4\u8bba(${model.descendantcount})</a>',after_comments:function(){var a=$("#"+this.fullname+"__commentsLink"),b=$("#"+this.fullname+"__hideCommentsLink");a&&(b.show(),a.hide());this.elements.comments?this.elements.comments.domnode.show():
this.showByConfig("comments")},hideComments:function(){var a=$("#"+this.fullname+"__commentsLink");$("#"+this.fullname+"__hideCommentsLink").hide();a.show();this.elements.comments.domnode.hide();this.state="hideComments"},getCreatorLabel:function(){return this.model.creator_id==(this.app.currentUser.userModel?this.app.currentUser.userModel.id:"")?"\u6211":this.model.creator_username},afterSave:function(){}},{ex_ListItem:{affectParent:!1,defaultState:"start",tag:"li",style:"ssysModelView list-group-item",
beforeInit:function(a,b){a=parseInt(a);b=parseInt(b);var c=this.collection=this.parent.collection;c?this.model=this.collection.getModel(a,b):console.error(this.fullname,"\u7684collection\u4e0d\u5b58\u5728!");this.page=a;this.index=(a-1)*c.limit+b+1;return this._beforeInit()}}},"ModelView");$$.Resource.ResourceView=$$.View.createSubclass({mg_elementConfigs:{create:["${resource.CreateView}"],index:["${resource.CollectionView}"]},modelListClass:"panel panel-default",emptyInfo:"\u5f53\u524d\u5217\u8868\u662f\u7a7a\u7684",elementConfigRules:[[/^(\d+)$/,["${model.getModelViewClass()}",["${model}","${this}"]]]],inputs:{},initShow:[],indexShow:["modelList"],mg_loadConfigRules:[[/^(\d+)\/?/,{model:"${resource.name}/$1"}]],mg_filterConfigs:{create:["logged"]},mg_filterConfigRules:[[/update\/(\d+)/,
"update"],[/cancel/,"cancel"]],limit:20,afterCancelState:"<",filter_update:function(a){var b=a.match(/^update\/(\d+)/)[1],c=this;return this.resource.$$(""+b).pipe(function(b){c.model=b;return a})},getModelsFromStorage:function(a,b,c){var d=this;return this.loadStorage().pipe(function(){var e=d.getSortedModels(c);d.models=e.slice((a-1)*b,a*b);d.models.sum=e.length;return d.models})},getSortedModels:function(a){}},{SelectTypeView:$$.View.createSubclass({style:"ssysSelectType",defaultSteps:["","selected"],
elementConfigs:{steps:["SsysPlayer",["\u4e0a\u4e00\u6b65","\u4e0b\u4e00\u6b65",null,!0]]},affectParent:!0,mg_showConfigs:{index:["\u9009\u62e9\u7c7b\u578b",null,["typenameInput","steps"]],selected:[null,"selected"]},beforeInit:function(a){this.resourceView=a||this.parent;this.resource=this.resourceView.resource},filter_selected:function(a){this.updateInputData();this.resourceView.typename=this.inputData.typename;return[this.parent,"create"]},_afterSetState:function(){this.elements.steps.update()}}),
ModelInput:$$.View.Input.createSubclass({beforeInit:function(a,b,c,d,e){this.resourceLabelName=this.getLabel(a);this.keyAttribute=b;this.html("<label>"+c+"</label><input name='"+b+"' value='"+(e||"")+"'><div class='help-block'>"+(d||"")+"</div>")},showError:function(a){a="\u6ca1\u6709"+this.getLabel(this.keyAttribute)+"\u4e3a"+this.value+"\u7684"+this.resourceLabelName;this.addClass("has-error");this.append('<label class="control-label" for="inputError">'+a+"</label>")},updateInputData:function(){var a=
this.keyAttribute,b=this.value=this.find("input").val();if("id"!=a){var c={};c[a]=b}else c=b;return this.inputData=c}})},"ResourceView");$$.Resource.CollectionView=$$.View.DataBinding.createSubclass({defaultState:"1",template:'${head}${body}<ul e="list" class="list-group"></ul>${e~paginator}',mg_elementConfigs:{paginator:["Paginator",["${sum}","${limit}"],{cssClass:"panel-footer",hide:"${!hasPaginator}"}]},initLoads:{sum:"${resource.name}/${collectionPath}[]"},bindingDatas:["collection"],hasPaginator:!0,mg_showConfigRules:[[/^(\d+)/,"m__getPageItems"]],mg_filterConfigRules:[[/^(\d+)/,["fetchPageItems"]]],mg_elementConfigRules:[[/^item(\d+)_(\d+)/,
["${ItemView}",["$1","$2"],"list"]]],style:"default",renderStyle:function(){$$.addClass(this.domnode,this.resource.name+"-collection panel panel-"+this.style+" "+this.addCssClass)},beforeInit:function(){this.getCollection();this.sum=this.collection.sum;this.limit=this.collection.limit;0==this.sum?this.addClass("empty"):this.removeClass("empty")},_refresh:function(a){this.init.apply(this,this.params||[]);return this.setState(a)},getPageItems:function(a){if(this.sum){a=parseInt(a);for(var b=[],c=0,
d=this.collection.getModels(a).length;c<d;c++)b.push("item"+a+"_"+c);return b}return[]},filter_fetchPageItems:function(a){return this.sum?this.collection.fetch(a).pipe(function(){return a}):a},getCollection:function(){if(this.collection)return this.collection;var a=this.get_collectionPath();return this.collection=this.resource.getCollection(a)},get_collectionPath:function(){var a=this.collectionType||this.shortClassname;return this.collectionParams?a+JSON.stringify(this.parseConfig(this.collectionParams)):
a},get_head:function(){return this.noPanelHead?"":'<div class="panel-heading clearfix"><h3 class="panel-title">'+this.parseConfig(this.title||"")+'<div class="menuZone pull-right"></h3></div>'},get_body:function(){return this.panelContent?'<div class="panel-body">'+this.panelContent+"</div>":""},getItemViewClass:function(){if(this.shortClassname.match(/^@/))return this.ItemView=this.resource.ModelView.ListItem;var a=this.shortClassname.substring(0,this.shortClassname.length-1);return this.ItemView=
ssys.eval(this.itemViewClassName||a,this.resource.ModelView.ListItem)||this.resource.ModelView.ListItem},getDataByPath:function(a){return this.resource.getDataByPath(a)}},{ex_DataTable:{elementConfigs:{paginator:["Paginator",["${sum}","${limit}"]],dataTable:["DataTable",["${columnConfigs}","${options}","${items}","${parent}"]]},indexShow:["dataTable","paginator"],beforeInit:function(a,b,c,d,e,f,g){this.columnConfigs=a;this.parentView=e||this.parent;this.resource=d||this.parentView.resource;this.sum=
f||this.parentView.sum;this.limit=c||this.parentView.limit||20;this.options=b||{};this.items=g},loadItems:function(a){this.elements.dataTable.loadItems(a)},onPageChange:function(a){this.parentView.setState("index/"+this.limit+"/"+a)},navigate:function(a){this.elements.paginator&&this.elements.paginator.navigate(a)}}},"CollectionView");$$.Resource.CreateView=$$.View.createSubclass({style:"",addCssClass:"",cancelState:"../<",mg_elementConfigs:{contentInput:["TextInput",[""]],addImageButton:["Uploader",["addImage","\u8d34\u56fe",{icon:"camera"}]],saveButton:["Button",["finish","\u5b8c\u6210",{type:"success"}]],cancelButton:["Button",["${cancelState}","\u53d6\u6d88",{warning:"\u4f60\u786e\u5b9a\u8981\u53d6\u6d88\u5417?"}]]},creationParams:{},affectParent:!1,mg_filterConfigs:{finish:"save"},mg_filterConfigRules:[[/^index/,[]]],mg_closerConfigRules:[[/.*/,
["validateInput"]]],beforeInit:function(a){a=a||{};$$.merge(a,this.creationParams);this.model=a.resource===this.resource?a:this.resource.createModelArchetype(a);this.inputConfigs=this.inputConfigs||this.model.creationParams;this.model.id&&(this.isRenew=!0);this.initInputData(this.model)},renderStyle:function(){$$.addClass(this.domnode,this.resource.name+"-create "+this.style+" "+this.addCssClass)},closer_validateInput:function(a){var b=this;if("start"!=this.state&&a!=this.getLastStep())return a=this.updateInputData(),
this.setInputsToModel(a),this.model.validate().pipe(null,function(a){return(a=b.removeTempErrors(a,b.state))?b.showErrors(a):$$.resolve()})},removeTempErrors:function(a,b){if(this.getLastState()!=b){var c=0,d;for(d in a)this.find(":visible[input_name='"+d+"']")[0]?c++:delete a[d];if(0<c)return a}},filter_save:function(){var a=this,b=this.model,c=this.updateInputData();this.setInputsToModel(c);return b.save().pipe(function(b){a.model=b;b=a.getAfterSaveState();a.cleanForNextCreation();return b},function(b){a.showErrors(b)})},
cleanForNextCreation:function(){this.remove()},afterRenewState:"../refresh/",getAfterSaveState:function(){return this.isRenew?this.afterRenewState:this.afterSaveState||"../"+this.model.id},updateInputData:function(){var a=this.parentCall("updateInputData");return ssys.removeUndefined(a)},setInputsToModel:function(a){var b=this.model,c;for(c in a)b[c]=a[c]}},null,"CreateView");$$.App.createSubclass({name:"pandingbao"},{xp_Page:{mg_elementConfigs:{topbar:["Navbar",{links:[["#","\u5224\u5b9a\u5b9d"]],rightLinks:[["#kase/create",'<span class="fa fa-edit" title="\u6211\u8981\u6295\u8bc9"></span>']],selectable:!1},{cssClass:"navbar-inverse navbar-fixed-top"}],innerTopbar:["Navbar",{links:[["../<",'<span class="fa fa-arrow-left"></span>']],title:"${title}",selectable:!1,cssClass:"text-center navbar-inverse navbar-fixed-top"}]}},xp_Layout:{style:"noise ui-widget-content",template:"",
afterLoginState:"",mg_elementConfigs:{stage:["Html",['<div class="container"></div>']],navbar:["Navbar",{links:[["#","<div ><span class='fa fa-home'></span></div><span >\u6295\u8bc9</span>"],["#p_execution","<div ><span class='fa fa-check'></span></div><span >\u6267\u884c</span>"],["#p_message","<div ><span class='fa fa-comment-o'></span></div><span >\u6d88\u606f</span>"],["#p_session","<div ><span class='fa fa-user'></span></div><span >\u6211</span>"]]},{cssClass:"navbar-default navbar-fixed-bottom"}],
footer:["Html",['<div class="container text-center"><p class="text-muted"><div><label>\u8054\u7cfb\u6211\u4eec<label>:xxxx@xxxx</div><div><a href="http://www.miitbeian.gov.cn/" target="_blank">ICP\u5907xxx\u53f7</a></div></p></div>']]},initShow:["navbar","stage"],mg_filterConfigRules:[[/^p_session\/login$/,["isGuest","page"]],[/^p_terms$/,["isGuest","page"]],[/^user\/create$/,["isGuest"]],[/^index|^p_([\w:]+)/,["logged","page"]],[/.*/,["logged"]]],filter_isGuest:function(a){return this.app.currentUser.id?
ssys.reject("index"):a},beforeInitLoads:function(){console.debug("beforeInitLoads","this.app.currentUser.id=",this.app.currentUser.id);this.app.currentUser.id&&(this.initLoads=$$.clone(this.initLoads||{}),this.initLoads.unreadMessagesCount="message/getUnread.json?returnsum=1")},beforeInit:function(){var a=this;$(window).hashchange(function(){var b=a.getStateByAnchor();b!=a.state&&a.setState(b)})},afterInit:function(){this.app.currentUser.id&&(this.intervalCheck(600),this.showUnread(this.unreadMessagesCount))},
showUnread:function(a){(this.unreadMessagesCount=a)?$("#pandingbao__link2").tooltip({title:this.unreadMessagesCount,trigger:"manual"}).tooltip("show"):$("#pandingbao__link2").tooltip("hide")},intervalCheck:function(a){var b=this;return this.intervalCheckTimer=ssys.delay(function(){b.app.currentUser.userModel.$$("count__unreadMessages").pipe(function(a){b.unreadMessagesCount=a||""});b.intervalCheck(a)},a)},afterShow:function(a){this.parentCall("afterShow",[a]);"index"==a&&(a="");(a=a.match(/(^$|^p_session$|^p_message|^p_execution)/))?
this.elements.navbar.activate(null,"#"+a[1]):this.hideElement("navbar")},createPanel:function(a,b,c,d,e,f){return this.createHtml(a,'<div class="panel panel-'+d+'"><div class="panel-heading"><h3 class="panel-title">'+b+'</h3></div><div class="panel-body">'+c+"</div></div>",e)},createUserLink:function(a,b,c,d){d=d||{};var e=d.version||"",f=this;a=this.createHtml(a,"<a href='javascript:;' data-state='"+(void 0===d.state?"#user/"+b:d.state)+"' title='"+(d.tooltip||"")+"' class='ssysLink userLink "+e+
"UserLink "+(d.cssClass||"")+"'><img src='"+(this.app.storageBaseUrl+"photos/"+(e?e+"/":"")+b)+"' class='"+(d.imgClass||"")+"' /><span>"+c+"</span></a>");$(".userLink img").one("error",function(){$(this).attr("src",f.app.staticBaseUrl+"img/single_photo/150.gif")});return a}},xp_Resource:[{},{xp_Model:{validateMoney:function(a,b){var c=this.decimalPlaces(b);if(2<c)return{name:a,error:"\u6700\u591a\u53ea\u80fd\u8f93\u5165\u4e24\u4f4d\u5c0f\u6570!\u4f60\u8f93\u5165\u4e86"+c+"\u4f4d."}},decimalPlaces:function(a){return(a=
(""+a).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/))?Math.max(0,(a[1]?a[1].length:0)-(a[2]?+a[2]:0)):0}},xp_ModelView:[{mg_elementConfigs:{userLink:["UserLink",["${model.creator_id}","${model.creator_username}",{version:"small",imgClass:"media-object",cssClass:"pull-${textAlign} media-${textAlign}"}]],titleLink:["Link",["#user/${model.creator_id}","${model.creator_username}"]]}},{ex_ListItem:{template:'${e~userLink}<div class="media-body"><h4 class="media-heading ">${e~titleLink}<small class="pull-right">${datetime:model.created_at}</small></h4><div class="row"><span class="text-info col-md-8">${model.content}</span></div>',
mg_elementConfigs:{}}}],xp_ResourceView:{backState:"../<",initShow:["@topbar"],mg_elementConfigs:{topbar:["Navbar",{links:[["${backState}",'<span class="fa fa-arrow-left"></span>']],title:"${title}",selectable:!1,cssClass:"text-center navbar-inverse navbar-fixed-top"}]}},xp_CollectionView:{beforeInit:function(){this.parentCall("beforeInit");this.ItemView=this.getItemViewClass();0==this.sum&&this.emptyInfo&&(this.initShow=["emptyInfo"])}},xp_CreateView:{backState:"lastStep",backWarning:"",mg_elementConfigs:{topbar:["Navbar",
{links:[["${backState}",'<span class="fa fa-arrow-left"></span>',"${backWarning}"]],selectable:!1,title:"${title}",cssClass:"text-center navbar-inverse navbar-fixed-top"},{location:["before","stage"]}],nextButton:["Button",["nextStep","\u4e0b\u4e00\u6b65",{type:"success"}],{location:"topbar/.navbar-right",wrapper:'<li style="line-height:35px;">{{}}</li>'}],saveButton:["Button",["finish","\u5b8c\u6210",{type:"success"}],{location:"topbar/.navbar-right",wrapper:'<li style="line-height:35px;">{{}}</li>'}],
pageHeader:["Html",'<h3 class="page-header"><small> <span class="badge">${currentStep}</span>${subTitle}</small></h3>',{location:["after","topbar"]}],lastButton:["Button",["lastStep","\u4e0a\u4e00\u6b65"]]}}}]},"Pandingbao");window.pandingbao=$$.App.Pandingbao.create();pandingbao.addResource("message",{xp_Model:{attris:"id content creator_id creator_username receiver_id receiver_username created_at updated_at parent_id subject_id typename".split(" "),creationParams:["content","receiver_id","parent_id"],validationRules:{content:["String",{isNull:!1,max:1E3}]},get_contentToShow:function(){try{var a=JSON.parse(this.content)}catch(b){a=this.content}switch(this.typename){case "Sue":var c=a[0],d=a[1];return"\u4f60\u88ab"+d+'\u6295\u8bc9\u4e86!\u5feb\u5230<a href="javascript:;" class="ssysLink" data-state="#kase/'+
c+'">\u8fd9\u91cc</a>\u5e94\u8bc9\u5427';case "CreateKase":return c=a[0],a=a[1],"\u4f60\u6295\u8bc9\u4e86"+a+'. \u4e0b\u4e00\u6b65\u9700\u8981\u4f60\u505a\u7684\u4e8b\u60c5\u6709\u4e24\u4ef6:1)\u5230<a href="javascript:;" class="ssysLink" data-state="#kase/'+c+'">\u8fd9\u91cc</a>\u6dfb\u52a0\u8bc1\u636e. 2)\u53bb\u901a\u77e5\u5bf9\u65b9\u6765\u5e94\u8bc9. \u5982\u679c\u5bf9\u65b9\u62d2\u7edd\u6765\u5e94\u8bc9, \u4e5f\u8bf7\u5c06\u5bf9\u65b9\u62d2\u7edd\u5e94\u8bc9\u7684\u804a\u5929\u8bb0\u5f55\u6dfb\u52a0\u5230\u8bc1\u636e\u4e2d\u6765. ';
case "AddFact":return c=a[0],a[1]+'\u6dfb\u52a0\u4e86\u65b0\u8bc1\u636e. \u5230<a href="javascript:;" class="ssysLink" data-state="#kase/'+c+'">\u8fd9\u91cc</a>\u67e5\u770b';case "PlaintiffReady":var c=a[0],d=a[1],a=a[2],e=this.app.currentUser.username;return e==d?'\u5bf9\u4e8e<a href="javascript:;" class="ssysLink" data-state="#kase/'+c+'">\u8be5\u6295\u8bc9</a>, \u4f60\u5df2\u7ecf\u6dfb\u52a0\u5b8c\u4e86\u8bc1\u636e, \u63a5\u4e0b\u6765\u53ea\u9700\u7b49\u5f853\u4e2a\u5de5\u4f5c\u65e5\u5185"'+a+
'"\u628a\u8bc1\u636e\u6dfb\u52a0\u5b8c, \u5c31\u53ef\u4ee5\u5f00\u59cb\u5224\u5b9a\u4e86':'\u5bf9\u4e8e<a href="javascript:;" class="ssysLink" data-state="#kase/'+c+'">\u8be5\u6295\u8bc9</a>, "'+d+'"\u5df2\u7ecf\u6dfb\u52a0\u5b8c\u4e86\u8bc1\u636e, \u8bf7\u4f60\u52a1\u5fc5\u57283\u4e2a\u5de5\u4f5c\u65e5\u5185\u628a\u8bc1\u636e\u6dfb\u52a0\u5b8c, \u5c31\u53ef\u4ee5\u5f00\u59cb\u5224\u5b9a\u4e86';case "DefendantReady":return c=a[0],d=a[1],a=a[2],e=this.app.currentUser.username,e==a?'\u5bf9\u4e8e<a href="javascript:;" class="ssysLink" data-state="#kase/'+
c+'">\u8be5\u6295\u8bc9</a>, \u4f60\u5df2\u7ecf\u6dfb\u52a0\u5b8c\u4e86\u8bc1\u636e, \u63a5\u4e0b\u6765\u53ea\u9700\u7b49\u5f855\u4e2a\u5de5\u4f5c\u65e5\u5185"'+d+'"\u628a\u8bc1\u636e\u6dfb\u52a0\u5b8c, \u5c31\u53ef\u4ee5\u5f00\u59cb\u5224\u5b9a\u4e86':'\u5bf9\u4e8e<a href="javascript:;" class="ssysLink" data-state="#kase/'+c+'">\u8be5\u6295\u8bc9</a>, "'+a+'"\u5df2\u7ecf\u6dfb\u52a0\u5b8c\u4e86\u8bc1\u636e, \u8bf7\u4f60\u52a1\u5fc5\u57283\u4e2a\u5de5\u4f5c\u65e5\u5185\u628a\u8bc1\u636e\u6dfb\u52a0\u5b8c, \u5c31\u53ef\u4ee5\u5f00\u59cb\u5224\u5b9a\u4e86';
case "BeginVerdict":return c=a[0],'\u5bf9<a href="javascript:;" class="ssysLink" data-state="#kase/'+c+'">\u8be5\u6295\u8bc9</a>\u7684\u5224\u5b9a\u5f00\u59cb\u4e86, \u5f53\u7cfb\u7edf\u6536\u96c6\u523060\u4e2a\u8bc4\u5ba1\u5458\u7684\u5224\u5b9a\u65f6, \u5c31\u4f1a\u516c\u5f00\u5224\u5b9a\u7ed3\u679c.';case "Sample":return c=a,'\u4f60\u88ab\u7cfb\u7edf\u968f\u673a\u9009\u4e2d\u4e86\u4f5c\u4e3a<a href="javascript:;" class="ssysLink" data-state="#kase/'+c+'">\u7b2c'+c+"\u53f7\u6295\u8bc9</a>\u7684\u8bc4\u5224\u5458, \u53ef\u4ee5\u53bb\u53c2\u4e0e\u8bc4\u5224. ";
default:return this.content}}},xp_Collection:{},xp_ResourceView:[{get_title:function(){if(this.settingState.match(/^withUser(\d+)/))return this.receiver.username},mg_elementConfigRules:[[/^withUser(\d+)/,["${cl~message.Conversation}","$1"]]],mg_loadConfigRules:[[/^withUser(\d+)/,{receiver:"user/$1"}]]},{}],xp_CollectionView:[{},{ex_MyMessages:{noPanelHead:!0,collectionParams:{attris:{receiver_id:"${app.currentUser.id}"},order:"id DESC"},after_1:function(){console.debug("after_1");var a=new Date,b=
this.app.currentUser.userModel;this.checked_at=b.checked_at;b.checked_at=parseInt(a.getTime()/1E3);var c=this;b.save().pipe(function(){c.app.layout.showUnread(0)})}},ex_Conversation:{addCssClass:"Conversation",mg_loadConfigs:{index:{user:"user/${userId}"}},noPanelHead:!0,itemViewClassName:"ConversationMessage",collectionParams:{action:"conversation",params:{user_id:"${userId}"}},mg_elementConfigs:{creator:["${cr~message}",{receiver_id:"${userId}"},"footer/.navbar-middle"],footer:["Navbar",{},{cssClass:"navbar-default navbar-fixed-bottom"}]},
beforeInitLoads:function(a){this.userId=a},initShow:["footer","creator"],beforeRefresh:function(){this.domnode.innerHtml=""},after_1:function(){$$.loopDefer(this.find(".userLink"),null,function(a){a[1].scrollIntoView();$(a).popover("show");return $$.delay(.1)})}}}],xp_ModelView:[{},{ex_ListItem:[{mg_elementConfigs:{userLink:["UserLink",["${model.creator_id}","",{version:"small",imgClass:"media-object",cssClass:"media-${textAlign} pull-${textAlign}"}]],titleLink:["Link",["#user/${model.creator_id}",
"${model.creator_username} "]]},template:'${e~userLink}<div class="media-body"><h4 class="media-heading ">${e~titleLink}<small class="pull-${reTextAlign}">${datetime:model.created_at}</small></h4><div class="row"><span class="col-xs-11 ">${model.contentToShow}</span></div>',initShow:["userLink","titleLink"]},{ex_MyMessage:{},ex_ConversationMessage:{template:"${e~userLink}",beforeInit:function(a,b){this.parentCall("beforeInit",[a,b]);this.textAlign=this.model.creator_id==this.app.currentUser.id?"right":
"left"},initShow:["userLink"],afterInit:function(){this.find(".userLink").popover({placement:this.get_reTextAlign(),viewport:{selector:"#"+this.fullname,padding:10},template:'<div class="popover"><div class="arrow"></div><div class="popover-content"></div></div>',title:"",html:!0,content:"<h6><small>"+this.eval_datetime(this.model.created_at)+"</small></h6>"+this.model.get_contentToShow()})}}}]}],xp_CreateView:[{afterSaveState:"*",mg_elementConfigs:{contentInput:["TextInput",{autoheight:!0,rows:1},
{cssClass:"col-xs-10"}],saveButton:["Button",["finish","\u53d1\u9001",{type:"success"}],{cssClass:"col-xs-2"}]},initShow:["contentInput","saveButton"],initLoads:{user:"user/${params.0.receiver_id}"}},{}]});pandingbao.addResource("kase",{collectionConfigs:{MyCurrentKases:{action:"myCurrentKases",order:"created_at DESC",limit:5},VerdictingKases:{attris:{status:"verdicting"},order:"verdicted_at DESC",limit:5},ConvictedKases:{attris:{status:"convicted"},order:"convicted_at DESC",limit:5}},afterCreate:function(a){var b=this.collections.MyCurrentKases;if(b){b.newModels.push(a);b.sum++;for(var c in b.views)b.views[c].onDataChange()}},xp_Model:{attris:"id name defendant_username defendant_id defendant_url item_name item_url bought_at price shipping_fee delivered_at problem defendant_response found_at returned_at returned_fee claimed agreed fine verdicted_at verdict_count truth truthcount status convicted convicted_at creator_id creator_username created_at updated_at".split(" "),
creationParams:"defendant_username defendant_url item_name item_url bought_at price shipping_fee delivered_at problem defendant_response found_at returned_at returned_fee claimed agreed fine".split(" "),validationRules:{defendant_username:["String",{max:60}],defendant_url:["Url"],price:["Number",{isNull:!1,min:1}]},relations:{facts:["hasMany","app/r_fact","kase_id"],defendant:["belongTo","app/r_party","defendant_id"]},verdictsLimit:60,getModelViewClass:function(){var a=this.resource.ModelView;return this.ModelView=
this.convicted_at?a.Convicted:"verdicting"==this.status?a.Verdicting:a.BeforeVerdict},ready:function(){return this.resource.getDataByAction("ready",{id:this.id})},claim:function(a){return this.resource.getDataByAction("claim",{id:this.id,claim:a})},defend:function(){return this.resource.getDataByAction("defend",{id:this.id})},counterclaim:function(){return this.resource.getDataByAction("counterclaim",{id:this.id,refresh:$.now()})},reconcile:function(){return this.resource.getDataByAction("reconcile",
{id:this.id})},_getUserRelation:function(a){if(this.defendant_username==a.username)return"defendant"},convict:function(){return this.resource.getDataByAction("convict",{id:this.id})},get_content:function(){return"verdicting"==this.status?"\u76ee\u524d\u5df2\u6709"+this.verdict_count+"\u4e2a\u5224\u5b9a":"convicted"==this.status?"\u5224\u5b9a\u7ed3\u679c:\u9000\u6b3e"+this.convicted+"\u5143, \u5171"+this.verdict_count+"\u4e2a\u5224\u5b9a":"\u4e3e\u8bc1\u4e2d"}},xp_CreateView:{style:"col-md-6 col-md-offset-3",
steps:["inputDefendant","inputOrder","inputProblem"],defaultState:"inputDefendant",cancelState:"#",backState:"#",mg_elementConfigs:{stage:["Html",['<form class="form-horizontal"></form>']],defendant_usernameInput:["StringInput",{icon:"user",placeholder:"\u586b\u5199\u4f60\u8981\u6295\u8bc9\u7684\u5356\u5bb6\u7684\u540d\u79f0"}],defendant_urlInput:["StringInput",{icon:"link",placeholder:"\u586b\u5199\u5356\u5bb6\u5e97\u94fa\u7684\u7f51\u5740"}],item_nameInput:["StringInput",{icon:"gift",placeholder:"\u4f60\u8d2d\u4e70\u4e86\u4ec0\u4e48\u5546\u54c1?\u8bf7\u586b\u5199\u5546\u54c1\u540d\u79f0"}],
item_urlInput:["StringInput",{icon:"link",placeholder:"\u8bf7\u586b\u5199\u5546\u54c1\u7684\u7f51\u5740"}],bought_atInput:["DateInput",["\u8d2d\u4e70\u65e5\u671f"]],delivered_atInput:["DateInput",["\u6536\u8d27\u65e5\u671f(\u4e0d\u586b\u8868\u793a\u672a\u6536\u5230\u8d27)"]],priceInput:["NumberInput",{placeholder:"\u5546\u54c1\u4ef7\u683c",unit:"\u5143",icon:"cny",errors:{tooSmall:function(a){return"\u62b1\u6b49, \u4f4e\u4e8e"+a+"\u5143\u7684\u6295\u8bc9\u6211\u4eec\u6682\u4e0d\u53d7\u7406"}}}],shipping_feeInput:["NumberInput",
{placeholder:"\u8fd0\u8d39",unit:"\u5143",icon:"cny"}],found_atInput:["DateInput",["\u4f60\u662f\u5728\u54ea\u4e00\u5929\u53d1\u73b0\u95ee\u9898\u5e76\u8ddf\u5356\u5bb6\u53cd\u6620\u7684?"]],problemInput:["TextInput",{placeholder:"\u8be5\u5546\u54c1\u6216\u5356\u5bb6\u670d\u52a1\u5b58\u5728\u4ec0\u4e48\u95ee\u9898?"}],defendant_responseInput:["TextInput",{placeholder:"\u4f60\u8ddf\u5356\u5bb6\u53cd\u6620\u8fd9\u4e9b\u95ee\u9898\u65f6, \u5356\u5bb6\u7684\u56de\u5e94\u662f?"}],claimedInput:["NumberInput",
{placeholder:"\u8981\u6c42\u5356\u5bb6\u9000\u6b3e\u591a\u5c11",unit:"\u5143",icon:"cny"}],agreedInput:["NumberInput",{placeholder:"\u5356\u5bb6\u53ea\u540c\u610f\u9000\u6b3e\u591a\u5c11",unit:"\u5143",icon:"cny"}],returned_atInput:["DateInput",["\u4f60\u5728\u54ea\u4e00\u5929\u9000\u7684\u8d27?\u4e0d\u586b\u8868\u793a\u672a\u9000\u8d27"]],returned_feeInput:["NumberInput",{placeholder:"\u9000\u8d27\u8fd0\u8d39",unit:"\u5143",icon:"cny"}]},initLoads:{DateInput:"js:$$view/DateInput.js"},initShow:"stage @topbar @nextButton @saveButton @title @pageHeader".split(" "),
mg_showConfigs:{inputDefendant:["defendant_usernameInput","defendant_urlInput","item_nameInput","item_urlInput","-saveButton"],inputOrder:"bought_atInput priceInput delivered_atInput shipping_feeInput returned_atInput returned_feeInput -saveButton".split(" "),inputProblem:"found_atInput problemInput defendant_responseInput claimedInput agreedInput -nextButton".split(" ")},title:"\u6295\u8bc9",currentStep:0,subTitle:"",filter_inputDefendant:function(a){this.backState="#";this.backWarning="\u672c\u6b21\u6dfb\u52a0\u8bc1\u636e\u5c1a\u672a\u5b8c\u6210, \u4f60\u786e\u5b9a\u8981\u8fd4\u56de?";
this.currentStep=1;this.subTitle="\u8bf7\u586b\u5199\u4f60\u8981\u6295\u8bc9\u7684\u5356\u5bb6\u548c\u5546\u54c1\u4fe1\u606f";return a},filter_inputOrder:function(a){this.backState="inputDefendant";this.backWarning="";this.currentStep=2;this.subTitle="\u8bf7\u586b\u5199\u4f60\u4e0e\u5356\u5bb6\u7684\u4ea4\u6613\u60c5\u51b5";return a},filter_inputProblem:function(a){this.backState="inputOrder";this.backWarning="";this.currentStep=3;this.subTitle="\u8bf7\u586b\u5199\u4f60\u4e0e\u5356\u5bb6\u7684\u7ea0\u7eb7\u60c5\u51b5";
return a}},xp_ModelView:[{affectParent:!1,refreshState:"start",mg_elementConfigs:{topbar:["Navbar",{links:[["#",'<span class="fa fa-arrow-left"></span>']],title:"${title}",selectable:!1,cssClass:"text-center navbar-inverse navbar-fixed-top"}],scrollspy:["Scrollspy",{links:"${links}",offset:45},{cssClass:"navbar-fixed-bottom"}],header:["Html",['<h3 class="page-header text-default">${model.name}<div class="pull-right"><small>${date:model.created_at}</small></div></h3>']],myVerdict:["${mv~verdict}",
["${myVerdict}"],{location:["before","appealContent"],hide:"${!myVerdict}"}],plaintiffFacts:["${cl~fact.KaseFacts.PlaintiffFacts}",["${model}"]],defendantFacts:["${cl~fact.KaseFacts.DefendantFacts}",["${model}"]],appealContent:["Html",['<div class="text-default"><div class="panel panel-default"><div class="panel-heading "><h6 >${date:model.bought_at}</h6></div><div class="panel-body">${buyer}\u82b1\u4e86<strong>${model.price}</strong>\u5143, \u5728${seller}\u4e70\u4e86<a href="${model.item_url}" class="btn btn-default btn-xs">${model.item_name} <span class="fa fa-external-link"></span></a></div></div><div class="panel panel-default"><div class="panel-heading "><h6 >${date:model.delivered_at}</h6></div><div class="panel-body">\u6536\u5230\u8d27\u7269(\u6216\u670d\u52a1), \u8fd0\u8d39\u662f${model.shipping_fee}\u5143.</div></div><div class="panel panel-default"><div class="panel-heading "><h6 >${date:model.found_at}(${afterDays})</h6></div><div class="panel-body">\u53d1\u73b0\u5e76\u5411\u5356\u5bb6\u53cd\u6620\u4e86\u8fd9\u4e9b\u95ee\u9898:<div class="panel panel-default">${model.problem}</div>\u5356\u5bb6\u7684\u56de\u5e94\u662f: <div class="panel panel-default">${model.defendant_response}</div></div></div><div class="panel panel-default"><div class="panel-heading "><h6 >${date:model.returned_at}</h6></div><div class="panel-body">\u4e70\u5bb6\u9000\u56de\u4e86\u5546\u54c1, \u8fd0\u8d39\u662f${model.returned_fee}\u5143<div class="panel panel-default">\u4e70\u5bb6\u8981\u6c42\u5356\u5bb6\u9000\u6b3e${model.claimed}\u5143</div><div class="panel panel-default">\u5356\u5bb6\u53ea\u540c\u610f\u9000\u6b3e${model.agreed}\u5143</div></div>']]},
mg_initLoads:{Scrollspy:"js:$$view/Scrollspy.js"},get_links:function(){return[["#${fullname}__header","\u57fa\u672c\u6848\u60c5"],["#${fullname}__plaintiffFacts","\u4e70\u5bb6\u8bc1\u636e"],["#${fullname}__defendantFacts","\u5356\u5bb6\u8bc1\u636e"]]},get_defendantName:function(){return"seller"==this.model.plaintiffType?"\u4e70\u5bb6":"\u5356\u5bb6"},get_plaintiffName:function(){return"seller"==this.model.plaintiffType?"\u5356\u5bb6":"\u4e70\u5bb6"},get_buyer:function(){return"<a href='javascript:;' class='ssysLink' data-state='#user/"+
this.model.creator_id+"'><strong>\u4e70\u5bb6\""+this.model.creator_username+'"</strong></a>'},get_seller:function(){return"<a href='javascript:;' class='ssysLink' data-state='#user/"+this.model.defendant_id+"'><strong>\u5356\u5bb6\""+this.model.defendant_username+"\"</strong></a>\u7684<a href='"+this.model.defendant_url+"' class='btn btn-default btn-xs'>\u5e97\u94fa <span class='fa fa-external-link'></span></a>"},get_afterDays:function(){var a=parseInt((this.model.found_at-this.model.delivered_at)/
3600/24);return 0<a?a+"\u5929\u540e":"\u6536\u5230\u8d27\u7684\u5f53\u5929"},get_sellerResponse:function(){return""}},{ex_BeforeVerdict:[{mg_elementConfigs:{title:["Html",['<div style="color:white;"></div>'],{location:"#${fullname}__topbar .navbar-form"}],factCreator:["${cr~fact}"]},initShow:"topbar scrollspy header appealContent plaintiffFacts. defendantFacts.".split(" "),mg_showConfigs:{addFact:"factCreator. -topbar -header -plaintiffFacts -defendantFacts -appealContent".split(" ")},title:"\u4e3e\u8bc1\u4e2d"}],
ex_Verdicting:{title:"\u5224\u5b9a\u4e2d",get_links:function(){var a=[["#${fullname}__appealContent","\u57fa\u672c\u6848\u60c5"],["#${fullname}__plaintiffFacts","\u4e70\u5bb6\u8bc1\u636e"],["#${fullname}__defendantFacts","\u5356\u5bb6\u8bc1\u636e"]];"addVerdict"==this.settingState?a.push(["#${fullname}__verdictCreator","\u6211\u7684\u5224\u5b9a"]):this.myVerdict&&a.unshift(["#${fullname}__myVerdict","\u6211\u7684\u5224\u5b9a"]);return a},mg_elementConfigs:{addVerdictButton:["Button",["addVerdict",
"\u6211\u8981\u8bc4\u5224",{type:"primary",size:"sm"}],{hide:"${myVerdict}",location:"topbar/.navbar-right",wrapper:"<li >{{}}</li>"}],verdictCreator:["${cr~verdict}",[{kase_id:"${model.id}"}]],progressInfo:["Html",'<div class="well">\u76ee\u524d\u5df2\u7ecf\u6709${model.verdict_count}\u4e2a\u5224\u5b9a, \u5f53\u6ee1${model.verdictsLimit}\u4e2a\u65f6\u5c31\u516c\u5e03\u5224\u5b9a\u7ed3\u679c</div>']},initShow:"topbar @scrollspy header appealContent plaintiffFacts. defendantFacts. addVerdictButton progressInfo myVerdict".split(" "),
beforeInitLoads:function(a){this.model=a},mg_initLoads:{myVerdict:'verdict/{"creator_id":${app.currentUser.id},"kase_id":"${model.id}"}'},showConfigs:{addVerdict:["verdictCreator.","-topbar","-addVerdictButton","-progressInfo"]}},ex_Convicted:{mg_elementConfigs:{convictedResult:["Html",["<h3>\u5224\u5b9a\u7ed3\u679c\u662f:\u5356\u5bb6\u9000\u6b3e${model.convicted}\u5143</h3>"]]},initShow:"header appealContent plaintiffFacts. defendantFacts. addVerdictButton myVerdict convictedResult".split(" ")},
ex_ListItem:[{mg_elementConfigs:{userLink:["UserLink",["${model.creator_id}","",{version:"small",imgClass:"media-object",cssClass:"pull-${textAlign} media-${textAlign}"}]],titleLink:["Link",["#kase/${model.id}","${model.name} "]]},initShow:["userLink","titleLink"]},{ex_VerdictingKase:{},ex_ConvictedKase:{},ex_MyCurrentKase:{},ex_MyPlaintiffkase:{}}]}],xp_Collection:{},xp_ResourceView:{get_title:function(){if(this.settingState.match(/\d+/))return"\u6295\u8bc9"},mg_elementConfigRules:[[/^plaintiffIsUser(\d+)/,
["${cl~kase.PlaintiffKases}","$1"]],[/^defendantIsUser(\d+)/,["${cl~kase.DefendantKases}","$1"]]],mg_showConfigRules:[[/^(\d+)/,["$1","-topbar"]]]},xp_CollectionView:[{hideWhenEmpty:!0},{ex_admin:{mg_elementConfigs:{deleteButton:["Button",["delete",null,"\u5220\u9664\u52fe\u9009\u7684\u6295\u8bc9",null,"text-center",null,"danger",null,"\u4f60\u786e\u5b9a\u8981\u5220\u9664\u5417?"]],dataTable:["ResourceDataTable",["${columnConfigs}"]]},columnConfigs:[["\u540d\u79f0","name","ModelLink"],["\u521b\u5efa\u65f6\u95f4",
"created_at","Time"],["\u52fe\u9009","id","Checkbox","checkKase","10%"]],indexShow:["dataTable","deleteButton"],afterInit:function(){this.checkedKases={}},checkKase:function(a,b){a.checked?this.checkedKases[b.id]=b:delete this.checkedKases[b.id]},filter_delete:function(){var a=$.map(this.checkedKases,function(a){return a.id});return 0==a.length?(alert("\u4f60\u6ca1\u6709\u52fe\u9009\u8981\u5220\u9664\u7684\u6295\u8bc9"),ssys.reject("index")):this.app.resources.kase.deleteAll(a).pipe(function(){alert("\u5df2\u7ecf\u6210\u529f\u5220\u9664\u4e86\u4f60\u6240\u52fe\u9009\u7684"+
a.length+"\u4e2a\u6295\u8bc9");return ssys.reject("refresh/index")},function(){alert("\u53ef\u80fd\u56e0\u4e3a\u7f51\u7edc\u539f\u56e0, \u5220\u9664\u5931\u8d25\u4e86, \u8bf7\u518d\u8bd5\u4e00\u6b21");return ssys.reject("index")})}},ex_UserKases:{beforeInit:function(a){this.user=a||this.app.currentUser.userModel},collectionParams:{userid:"${user.id}"}},ex_MyCurrentKases:{title:"\u6211\u7684\u5f53\u524d\u6295\u8bc9",hasPaginator:!1,style:"warning"},ex_PlaintiffKases:{noPanelHead:!0,collectionParams:{attris:{creator_id:"${userId}"},
limit:20,order:"id DESC "},beforeInitLoads:function(a){this.userId=a}},ex_DefendantKases:{noPanelHead:!0,collectionParams:{attris:{defendant_id:"${userId}"},limit:20,order:"id DESC "},beforeInitLoads:function(a){this.userId=a}},ex_MyPlaintiffKases:{noPanelHead:!0,collectionParams:{attris:{creator_id:"${app.currentUser.id}"},limit:20,order:"id DESC "}},ex_MyDefendantKases:{noPanelHead:!0,collectionParams:{attris:{defendant_id:"${app.currentUser.id}"},limit:20,order:"id DESC "}},ex_BeforeVerdictKases:{title:"\u7533\u8ff0\u4e2d\u7684\u6295\u8bc9"},
ex_VerdictingKases:{hasPaginator:!1,title:"\u6b63\u5728\u5224\u5b9a\u4e2d\u7684\u6295\u8bc9"},ex_ConvictedKases:{title:"\u5df2\u5b8c\u7ed3\u7684\u6295\u8bc9",style:"success"}}]});pandingbao.addResource("user",{getMoralStars:function(){return this.Collection.create({order:"weight DESC,verdict_count DESC",limit:5})},getVerdictStars:function(){return this.Collection.create({order:"verdict_count DESC,weight DESC",limit:5})},xp_Model:[{attris:"id username agent_id agent_username role registerip created_at checked_at login_at logout_at has_photo weight points verdict_count sample_count fa_count shang_count fa_amount shang_amount plaintiff_count defendant_count reconciled_count fulfilled_count".split(" "),
validationRules:{username:["String",{isUnique:!0,isNull:!1,max:30}],email:["Email"]},creationParams:["username","email","password"],init:function(){this.has_photo?(this.photoSrc=this.app.storageBaseUrl+"photos/"+this.id,this.smallPhotoSrc=this.app.storageBaseUrl+"photos/small/"+this.id):(this.photoSrc=this.app.staticBaseUrl+"img/single_photo/100.jpg",this.smallPhotoSrc=this.app.staticBaseUrl+"img/single_photo/100.jpg")},relations:{verdicts:["manyAction","app/r_verdict","getUserVerdicts",{user_id:"${id}"}],
comments:["hasMany","app/r_comment","creator_id"],parties:["hasMany","app/r_party","user_id"],apps:["hasMany","app/r_user","agent_id"],walues:["hasMany","app/r_walue","creator_id"],messages:["hasMany","app/r_message","receiver_id"],unreadMessages:["manyAction","app/r_message","getUnread"],groupKases:["hasMany","app/r_kase","group_id"],groupShangfas:["hasMany","app/r_shangfa","group_id"],groupShangs:["hasMany","app/r_shangfa","group_id",{ispunish:0}],groupFas:["hasMany","app/r_shangfa","group_id",
{ispunish:1}],rates:["hasMany","app/r_rate","creator_id"]},get_renpin:function(){return(100*this.weight).toFixed(2)},getScenterUser:function(){var a=this;return ssys.dfdget(this.scenterUser,function(){return ssys.scenter.getResource("user").pipe(function(b){return b.getModelByAction("getItemBySockpuppet",{sockpuppetname:a.username,appid:a.app.appid}).pipe(function(b){return a.scenterUser=b})})})},getUserRelation:function(){var a=this.app.currentUser;void 0===this.userRelation&&(this.userRelation=
a.isGuest?"guest":a.id==this.creator_id?"creator":this.id==a.id?"me":"admin"==a.userModel.role?"admin":this._getUserRelation(a));return this.userRelation}},{}],xp_Collection:{},xp_ResourceView:{get_title:function(){if(this.settingState.match(/^\d+/))return"\u8be6\u7ec6\u8d44\u6599"},mg_filterConfigs:{create:[]},mg_filterConfigRules:[[/^(\d+)$/,["model"]]],filter_model:function(a){if(a==this.app.currentUser.id)return $$.reject("#p_session")}},xp_CollectionView:[{},{ex_admin:{mg_elementConfigs:{deleteButton:["Button",
["delete",null,"\u5220\u9664\u52fe\u9009\u7684\u7528\u6237",null,"text-center",null,"danger",null,"\u4f60\u786e\u5b9a\u8981\u5220\u9664\u5417?"]],dataTable:["ResourceDataTable",["${columnConfigs}"]]},columnConfigs:[["\u540d\u79f0","username","ModelLink"],["\u6ce8\u518c\u65f6\u95f4","created_at","Time"],["\u6ce8\u518cIP","ip"],["\u52fe\u9009","id","Checkbox","checkUser","10%"]],indexShow:["dataTable","deleteButton"],afterInit:function(){this.checkedUsers={}},checkUser:function(a,b){a.checked?this.checkedUsers[b.id]=
b:delete this.checkedUsers[b.id]},filter_delete:function(){var a=$.map(this.checkedUsers,function(a){return a.id});return 0==a.length?(alert("\u4f60\u6ca1\u6709\u52fe\u9009\u8981\u5220\u9664\u7684\u7528\u6237"),ssys.reject("index")):this.app.resources.user.deleteAll(a).pipe(function(){alert("\u5df2\u7ecf\u6210\u529f\u5220\u9664\u4e86\u4f60\u6240\u52fe\u9009\u7684"+a.length+"\u4e2a\u7528\u6237");return ssys.reject("refresh/index")},function(){alert("\u53ef\u80fd\u56e0\u4e3a\u7f51\u7edc\u539f\u56e0, \u5220\u9664\u5931\u8d25\u4e86, \u8bf7\u518d\u8bd5\u4e00\u6b21");
return ssys.reject("index")})}},ex_MoralStars:{style:"info",title:"\u8bc4\u5224\u6743\u91cd\u6392\u884c\u699c"},ex_VerdictStars:{title:"\u8bc4\u5ba1\u6b21\u6570\u6392\u884c\u699c"}}],xp_ModelView:[{addCssClass:"media",template:'<div class="media-body"><h3 class="media-heading"></h3></div>',links:[["#verdict/ofUser${model.id}","\u5224\u5b9a\u4e86${model.verdict_count}\u6b21","gavel"],["#kase/plaintiffIsUser${model.id}","\u6295\u8bc9\u4e86${model.plaintiff_count}\u6b21","folder-o"],["#kase/defendantIsUser${model.id}",
"\u88ab\u6295\u8bc9\u4e86${model.defendant_count}\u6b21","folder"]],mg_elementConfigs:{userLink:["UserLink",["${model.id}","${model.username}",{state:"photoUploader/upload"}],{wrapper:'<div class="jumbotron text-center">{{}}</div>'}],messageButton:["Button",["#message/withUser${model.id}","\u53d1\u6d88\u606f",{type:"success"}],{cssClass:"col-xs-12"}],linkList:["Loop",{datas:"${links}",element:["Link",["$~{i~0}",'<div class="pull-left media-left"><span class="fa fa-$~{i~2}"></span></div><div class="media-body">$~{i~1}</div>'],
{cssClass:"list-group-item media"}]},{cssClass:"list-group"}]},initShow:["userLink","linkList","messageButton"]},{ex_Me:{links:[["#verdict/ofUser${model.id}","\u5224\u5b9a\u4e86${model.verdict_count}\u6b21","gavel"],["#kase/plaintiffIsUser${model.id}","\u6295\u8bc9\u4e86${model.plaintiff_count}\u6b21","folder-o"],["#kase/defendantIsUser${model.id}","\u88ab\u6295\u8bc9\u4e86${model.defendant_count}\u6b21","folder"],["#p_session/logout","\u9000\u51fa\u8be5\u8d26\u53f7","power-off"]],mg_elementConfigs:{photoUploader:["Uploader",
{url:"${app.baseUrl}uploader/uploadPhoto.php",afterUpload:"afterUploadPhoto"},{cssClass:"hidden"}]},initLoads:{Uploader:"js:$$view/Uploader.js"},initShow:["userLink","photoUploader","linkList"],beforeInit:function(){this.parentCall("beforeInit",this.params);this.model=this.app.currentUser.userModel},afterUploadPhoto:function(){this.find(".userLink img").attr("src",this.app.storageBaseUrl+"photos/"+this.model.id+"?uploadtime="+$.now())}},ex_ListItem:[{mg_elementConfigs:{userLink:["UserLink",["${model.id}",
"",{version:"small",imgClass:"pull-left",style:"media-object"}],["before",".media-body"]],titleLink:["Link",["#user/${model.id}",'${model.username} <span class="badge pull-right">${index}</span>'],".media-heading"]},initShow:["userLink","titleLink"]},{ex_MoralStar:{template:'${e~userLink}<div class="media-body"><h4 class="media-heading">${e~titleLink}</h4>\u8bc4\u5224\u6743\u91cd:${model.renpin}\u5206</div>'},ex_VerdictStar:{template:'<div class="media-body"><h4 class="media-heading"></h4>\u8bc4\u5ba1\u6b21\u6570:${model.verdict_count}\u6b21</div>'}}]}],
xp_CreateView:[{style:"create form col-sm-4 col-sm-offset-4",mg_elementConfigs:{pageHeader:["Html",['<div class="page-header"><h3>\u6ce8\u518c<span class="pull-right"><small >\u5df2\u6709\u5224\u5b9a\u5b9d\u8d26\u53f7?<a href="#p_session/login">\u767b\u5f55</a></small></span></h3></div>']],emailInput:["StringInput",[{icon:"envelope",placeholder:"\u8bf7\u8f93\u5165\u90ae\u7bb1"}]],usernameInput:["StringInput",[{icon:"user",placeholder:"\u8bf7\u8f93\u5165\u7528\u6237\u540d",errors:{notUnique:"\u8be5\u7528\u6237\u540d\u5df2\u7ecf\u6709\u4eba\u4f7f\u7528\u4e86,\u8bf7\u6362\u4e00\u4e2a"}}]],
passwordInput:["PasswordInput"],termsLink:["Link",["#p_terms","\u5224\u5b9a\u5b9d\u670d\u52a1\u6761\u6b3e",{icon:"caret-right"}],{wrapper:'<div style="padding:20px 0">{{}}</div>'}],descriptionInput:["TextInput",["\u4e2a\u4eba\u7b7e\u540d",null,null,500]],saveButton:["Button",["save","\u540c\u610f\u5e76\u6ce8\u518c",{type:"primary",size:"bg",cssClass:"col-xs-12"}]],finish:["Div",["${domnode}"]]},initShow:"pageHeader emailInput usernameInput passwordInput termsLink saveButton".split(" "),filter_save:function(){var a=
this,b=this.model,c=this.updateInputData();this.setInputsToModel(c);return b.save().pipe(function(b){a.model=b;a.app.currentUser.loginByUserModel(b,!1,!0);return a.app.layout.setState("")},function(b){a.showErrors(b)})}},{}]});pandingbao.addResource("fact",{collectionConfigs:{},xp_Model:[{attris:"id kase_id kase_name content has_image has_refute_image refutation reliability reliabilitycount creator_id creator_username created_at updated_at".split(" "),uneditable:["has_refute_image"],creationParams:["kase_id","content"],validationRules:{content:["String",{isNull:!0,max:140}],refutation:["String",{isNull:!0,max:140}]},relations:{kase:["belongTo","app/r_kase","kase_id"],walueRates:["hasMany","app/r_rate","object_id",{ratetype:"Fact__walue"}],
reliabilityRates:["hasMany","app/r_rate","object_id",{ratetype:"Fact__reliability"}],comments:["hasMany","app/r_comment","subject_id",{subjecttype:"Fact"}],evidences:["hasMany","app/r_evidence","fact_id"],intimates:["hasMany","app/r_comment","subject_id",{subjecttype:"Fact",branch_id:null}],branchComments:["hasMany","app/r_comment","subject_id",{subjecttype:"Fact",is_branch:1}]},get_imageSrc:function(){return this.app.storageBaseUrl+"/facts/img/"+this.id+(this.imageUpdatedAt?"?"+this.imageUpdatedAt:
"")},get_refuteImageSrc:function(){return this.app.storageBaseUrl+"/facts/refute_img/"+this.id+(this.refuteImageUpdatedAt?"?"+this.refuteImageUpdatedAt:"")},get_kase:function(){return this.app.resources.kase.models[this.kase_id]},get_refuter:function(){return this.app.resources.user.models[this.get_refuter_id()]},get_refuter_id:function(){var a=this.get_kase(),b=a.creator_id;return this.creator_id==b?a.defendant_id:b},refutable:function(){return!this.refuted()&&this.app.currentUser.id==this.get_refuter_id()},
refuted:function(){return this.refutation||this.has_refute_image},isEditable:function(a){return!this.refuted()&&this.parentCall("isEditable",[a])}},{}],xp_Collection:{},xp_ResourceView:[{},{}],xp_CollectionView:[{},{ex_KaseFacts:[{title:"\u8bc1\u636e\u5217\u8868",template:'${head}${body}<ul e="list" class="list-group"></ul>${e~footer}',mg_elementConfigs:{footer:["Html",['<div class="panel-footer text-left"></div>']],terms:["Html",['<div class="well"><h4>\u6dfb\u52a0\u8bc1\u636e\u987b\u77e5:</h4><div><span class="badge">1</span> \u6700\u591a\u53ea\u80fd\u6dfb\u52a05\u6761\u8bc1\u636e</div><div><span class="badge">2</span> \u5982\u679c\u6ca1\u6709\u66f4\u591a\u7684\u8bc1\u636e\u8865\u5145\u548c\u4fee\u6539, \u8bf7\u70b9\u51fb"\u5b8c\u6210"\u6309\u94ae</div><span class="badge">3</span> \u5f53\u4e70\u5356\u53cc\u65b9\u8bc1\u636e\u90fd\u6dfb\u52a0\u5b8c\u6bd5\u65f6, \u6295\u8bc9\u4f1a\u8fdb\u5165\u5224\u5b9a\u9636\u6bb5,\u7cfb\u7edf\u4f1a\u968f\u673a\u62bd\u53d6\u4e00\u6279\u8bc4\u5224\u5458\u5f00\u59cb\u5bf9\u6295\u8bc9\u8fdb\u884c\u5224\u5b9a</div></div>'],
{location:"footer",hide:"${!canAddFact()}"}],info:["Html",["<h6>${info}</h6>"],{location:"footer"}],readyButton:["Button",["ready","\u5b8c\u6210(${collection.sum}/5)",{type:"success",size:"sm",warning:"\u4f60\u771f\u7684\u6ca1\u6709\u8981\u8865\u5145\u7684\u8bc1\u636e\u4e86\u5417?"}],{location:"#${parent.fullname}__topbar .navbar-right",hide:"${!canAddFact()}",wrapper:"<li>{{}}</li>"}],addFactButton:["Button",["../addFact","\u6dfb\u52a0\u8bc1\u636e",{type:"primary"}],{cssClass:"col-xs-12",location:"footer",
hide:"${!canAddFact()}"}]},initShow:["footer","terms","info","addFactButton","@readyButton"],collectionParams:{attris:{kase_id:"${kase.id}"}},beforeInitLoads:function(a){this.kase=a;this.userRelation=this.kase.getUserRelation()},beforeInit:function(){this.parentCall("beforeInit",this.params);this.left=5-this.sum},ready:function(){var a=this;this.kase.ready().pipe(function(b){a.kase.setTuple(b);return a.app.refresh()},function(){console.error(a.fullname,"\u8bc1\u636e'\u6dfb\u52a0\u5b8c\u6bd5'\u64cd\u4f5c\u5931\u8d25!")})}},
{ex_PlaintiffFacts:{style:"success",title:"\u4e70\u5bb6\u8bc1\u636e",get_info:function(){return this.kase.status.match(/addingFacts|defendantReady/)?0==this.sum?"\u8fd8\u672a\u6dfb\u52a0\u4efb\u4f55\u8bc1\u636e":"\u5df2\u7ecf\u6dfb\u52a0\u4e86"+this.sum+"\u6761\u8bc1\u636e. \u8fd8\u53ef\u6dfb\u52a0${left}\u6761":this.kase.status.match(/plaintiffReady/)?"creator"==this.userRelation?"\u4f60\u5df2\u7ecf\u6dfb\u52a0\u5b8c\u4e86\u8bc1\u636e(\u4f60\u4ecd\u7136\u53ef\u4ee5\u53cd\u9a73\u5bf9\u65b9\u7684\u8bc1\u636e). \u73b0\u5728\u53ea\u7b49\u5bf9\u65b9\u5b8c\u6210\u8bc1\u636e\u6dfb\u52a0\u5373\u53ef\u5f00\u59cb\u5224\u5b9a\u4e86.":
"defendant"==this.userRelation?"\u4ed6\u5df2\u7ecf\u6dfb\u52a0\u5b8c\u4e86\u8bc1\u636e(\u4ed6\u4ecd\u7136\u53ef\u4ee5\u53cd\u9a73\u4f60\u7684\u8bc1\u636e). \u73b0\u5728\u53ea\u7b49\u4f60\u5b8c\u6210\u8bc1\u636e\u6dfb\u52a0\u5373\u53ef\u5f00\u59cb\u5224\u5b9a\u4e86.":"\u4e70\u5bb6\u5df2\u7ecf\u6dfb\u52a0\u5b8c\u4e86\u8bc1\u636e(\u4ed6\u4ecd\u7136\u53ef\u4ee5\u53cd\u9a73\u5356\u5bb6\u7684\u8bc1\u636e). \u73b0\u5728\u53ea\u7b49\u5356\u5bb6\u5b8c\u6210\u8bc1\u636e\u6dfb\u52a0\u5373\u53ef\u5f00\u59cb\u5224\u5b9a\u4e86.":
0==this.sum?"\u6ca1\u6709\u6dfb\u52a0\u4efb\u4f55\u8bc1\u636e":"\u5171\u6709"+this.sum+"\u6761\u8bc1\u636e"},itemViewClassName:"KaseFact.PlaintiffFact",collectionParams:{attris:{kase_id:"${kase.id}",creator_id:"${kase.creator_id}"}},canAddFact:function(){return"creator"==this.userRelation&&this.kase.status.match(/addingFacts|defendantReady/)}},ex_DefendantFacts:{style:"danger",title:"\u5356\u5bb6\u8bc1\u636e",get_info:function(){return this.kase.status.match(/addingFacts|plaintiffReady/)?0==this.sum?
"\u8fd8\u672a\u6dfb\u52a0\u4efb\u4f55\u8bc1\u636e":"\u5df2\u7ecf\u6dfb\u52a0\u4e86"+this.sum+"\u6761\u8bc1\u636e. \u8fd8\u53ef\u6dfb\u52a0${left}\u6761":this.kase.status.match(/defendantReady/)?"defendant"==this.userRelation?"\u4f60\u5df2\u7ecf\u6dfb\u52a0\u5b8c\u4e86\u8bc1\u636e(\u4f60\u4ecd\u7136\u53ef\u4ee5\u53cd\u9a73\u5bf9\u65b9\u7684\u8bc1\u636e). \u73b0\u5728\u53ea\u7b49\u5bf9\u65b9\u5b8c\u6210\u8bc1\u636e\u6dfb\u52a0\u5373\u53ef\u5f00\u59cb\u5224\u5b9a\u4e86.":"creator"==this.userRelation?
"\u4ed6\u5df2\u7ecf\u6dfb\u52a0\u5b8c\u4e86\u8bc1\u636e(\u4ed6\u4ecd\u7136\u53ef\u4ee5\u53cd\u9a73\u4f60\u7684\u8bc1\u636e). \u73b0\u5728\u53ea\u7b49\u4f60\u5b8c\u6210\u8bc1\u636e\u6dfb\u52a0\u5373\u53ef\u5f00\u59cb\u5224\u5b9a\u4e86.":"\u5356\u5bb6\u5df2\u7ecf\u6dfb\u52a0\u5b8c\u4e86\u8bc1\u636e(\u4ed6\u4ecd\u7136\u53ef\u4ee5\u53cd\u9a73\u4e70\u5bb6\u7684\u8bc1\u636e). \u73b0\u5728\u53ea\u7b49\u4e70\u5bb6\u5b8c\u6210\u8bc1\u636e\u6dfb\u52a0\u5373\u53ef\u5f00\u59cb\u5224\u5b9a\u4e86.":0==this.sum?
"\u6ca1\u6709\u6dfb\u52a0\u4efb\u4f55\u8bc1\u636e":"\u5171\u6709"+this.sum+"\u6761\u8bc1\u636e"},addCssClass:"text-right",itemViewClassName:"KaseFact.DefendantFact",collectionParams:{attris:{kase_id:"${kase.id}",creator_id:"${kase.defendant_id}"}},canAddFact:function(){return"defendant"==this.userRelation&&this.kase.status.match(/addingFacts|plaintiffReady/)}}}]}],xp_ModelView:[{mg_elementConfigs:{refute:["${cr~fact.Refute}","${model}"]}},{ex_ListItem:[{},{ex_KaseFact:[{extraContentClass:"",textType:"success",
reTextType:"danger",template:'${e~userLink}<div class="media-body"><h4 class="media-heading clearfix">${e~titleLink}<small class="pull-${reTextAlign}">${datetime:model.created_at}</small></h4><div class="text-${textType} ${extraContentClass}">${model.content}${e~image}<div> ${e~renewButton}${e~agreeButton}${e~refuteButton}</div></div></div>',mg_elementConfigs:{image:["Image",["${model.imageSrc}"],{hide:"${!model.has_image}"}],refutation:["Panel",{head:"\u53cd\u9a73",type:"${reTextType}",body:'${e~refuterLink}<div class="media-body "><h4 class="media-heading clearfix"><small >${datetime:model.created_at}</small></h4><div class="content text-${reTextType} ">${model.refutation}<div>${e~renewRefutationButton}</div></div></div>'},
{hide:"${!model.refuted()}",cssClass:"text-${reTextAlign}"}],refuteImage:["Image","${model.refuteImageSrc}",{hide:"${!model.has_refute_image}",location:"refutation/.content"}],agreeButton:["Button",["agree","\u8ba4\u53ef",{type:"success",size:"sm",warning:"\u4f60\u786e\u5b9a\u8ba4\u53ef\u5bf9\u65b9\u63d0\u4f9b\u7684\u8fd9\u4e2a\u8bc1\u636e\u5417?\u4e00\u65e6\u8ba4\u53ef, \u8be5\u8bc1\u636e\u5c31\u4e0d\u80fd\u518d\u88ab\u53cd\u9a73\u548c\u4fee\u6539.\u4f5c\u4e3a\u5956\u52b1, \u4f60\u5c06\u5141\u8bb8\u591a\u6dfb\u52a0\u4e00\u4e2a\u8bc1\u636e."}],
{hide:"${!model.refutable()}"}],renewButton:["Button",["#fact/${model.id}/renew","\u4fee\u6539",{icon:"pencil",type:"warning",size:"sm"}],{hide:"${!model.isEditable()}"}],refuteButton:["Button",["#fact/${model.id}/refute","\u53cd\u9a73",{type:"danger",size:"sm"}],{hide:"${!model.refutable()}"}],userLink:["UserLink",["${model.creator_id}","",{version:"small",imgClass:"media-object",cssClass:"media-${textAlign} pull-${textAlign}"}]],refuterLink:["UserLink",["${model.refuter_id}","${model.refuter.username}",
{version:"small",imgClass:"media-object",cssClass:"media-${textAlign} pull-${reTextAlign}"}],{hide:"${!model.refuted()}"}]},initShow:"userLink titleLink image refutation refuterLink refuteImage renewButton refuteButton".split(" "),agree:function(){}},{ex_PlaintiffFact:{},ex_DefendantFact:{textType:"danger",reTextType:"success",textAlign:"right",mg_elementConfigs:{}}}]}]}],xp_CreateView:[{defaultState:"start",cancelState:"#kase/${model.kase_id}",afterRenewState:"${cancelState}",cancelWarning:"\u672c\u6b21\u6dfb\u52a0\u8bc1\u636e\u5c1a\u672a\u5b8c\u6210, \u4f60\u786e\u5b9a\u8981\u8fd4\u56de?",
addImageTitle:"\u4e0a\u4f20\u8bc1\u636e\u56fe\u7247",uploadUrl:"uploader/uploadFactImage.php?kase_id=${kase.id}",editUrl:"uploader/uploadFactImage.php?fact_id=${model.id}",imageUrl:"${model.imageSrc}",get_title:function(){return this.model.id?"\u4fee\u6539\u8bc1\u636e":"\u6dfb\u52a0\u8bc1\u636e"},hasImage:function(){return this.model.has_image},mg_elementConfigs:{topbar:["Navbar",{links:[["${cancelState}",'<span class="fa fa-arrow-left"></span>',"${cancelWarning}"]],title:"${title}",selectable:!1,
cssClass:"text-center navbar-inverse navbar-fixed-top"}],addImageButton:["Uploader",{afterUpload:"afterAddImage",title:"${addImageTitle}",icon:"camera",url:"${uploadUrl}"},{hide:"${hasImage()}",cssClass:"btn-primary col-xs-12"}],editImageButton:["Uploader",{afterUpload:"afterEditImage",title:"\u66f4\u6362\u56fe\u7247",icon:"camera",url:"${editUrl}"},{hide:"${!hasImage()}",cssClass:"btn-primary col-xs-12"}],image:["Image","${imageUrl}",{hide:"${!hasImage()}",cssClass:"col-xs-12"}],contentInput:["TextInput",
{max:140,placeholder:"\u8bf7\u7b80\u660e\u627c\u8981\u7684\u8bf4\u660e\u4f60\u8981\u6dfb\u52a0\u7684\u8bc1\u636e"},{cssClass:"col-xs-12"}],saveButton:["Button",["finish","\u5b8c\u6210",{type:"success",size:"sm"}],{location:"topbar/.navbar-right",wrapper:"<li>{{}}</li>"}]},initShow:"topbar addImageButton contentInput image editImageButton saveButton".split(" "),mg_initLoads:{Uploader:"js:$$view/Uploader.js"},mg_showConfigs:{edit:["-addImageButton"]},afterSaveState:"../start",beforeInit:function(a){this.parentCall("beforeInit",
[a]);this.model.id||(this.kase=this.parent.model,this.model.kase_id=this.kase.id)},afterAddImage:function(a){var b=this;this.resource.getModel(a.name).pipe(function(a){b.model=a;a.has_image=!0;b.resource.afterCreate(a);return b.setState("edit")})},afterEditImage:function(){this.model.imageUpdatedAt=$.now();$(this.elements.image).attr("src",this.model.get_imageSrc())}},{ex_Refute:{cancelWarning:"\u672c\u6b21\u53cd\u9a73\u5c1a\u672a\u5b8c\u6210, \u4f60\u786e\u5b9a\u8981\u8fd4\u56de?",addImageTitle:"\u4e0a\u4f20\u53cd\u9a73\u8bc1\u636e\u56fe\u7247",
title:"\u53cd\u9a73",uploadUrl:"uploader/uploadRefuteImage.php?fact_id=${model.id}",editUrl:"uploader/uploadRefuteImage.php?fact_id=${model.id}",imageUrl:"${model.refuteImageSrc}?",hasImage:function(){return this.model.has_refute_image},mg_elementConfigs:{refutationInput:["TextInput",{placeholder:"\u8bf7\u7b80\u660e\u627c\u8981\u7684\u8bf4\u8bf4\u4f60\u53cd\u9a73\u7684\u7406\u7531",max:140},{cssClass:"col-xs-12"}]},initShow:"topbar addImageButton refutationInput image editImageButton saveButton".split(" "),
inputConfigs:["refutation"],afterAddImage:function(a){this.model.has_refute_image=!0;return this.setState("edit")},afterEditImage:function(){this.model.refuteImageUpdatedAt=$.now();$(this.elements.refuteImage).attr("src",this.model.get_refuteImageSrc());this.model.onDataChange()}}}]});pandingbao.addResource("opt",{xp_Model:{attris:[],creationParams:[],validationRules:{}},xp_Collection:{},xp_ResourceView:[{},{}],xp_CollectionView:[{},{}],xp_ModelView:[{},{}],xp_CreateView:[{mg_elementConfigs:{},initShow:[]},{}]});pandingbao.addResource("verdict",{collectionConfigs:{},afterCreate:function(a){pandingbao.resources.kase.models[a.kase_id].pull()},xp_Model:{attris:"id kase_id kase_name truth weight weight0 bestX points reason creator_id creator_username created_at updated_at".split(" "),creationParams:["kase_id","truth","bestX","points","reason"],validationRules:{bestX:["Number",{isNull:!1}]}},xp_Collection:{},xp_ResourceView:{get_title:function(){if(this.settingState.match(/^ofUser(\d+)/))return"\u5224\u5b9a"},
mg_elementConfigRules:[[/^ofUser(\d+)/,["${cl~verdict.UserVerdicts}","$1"]]]},xp_CollectionView:[{noPanelHead:!0},{ex_UserVerdicts:{beforeInitLoads:function(a){this.userId=a},collectionParams:{attris:{creator_id:"${userId}"},order:"id DESC",limit:20}},ex_MyVerdicts:{collectionParams:{attris:{creator_id:"${app.currentUser.id}"},order:"created_at DESC",limit:20}}}],xp_ModelView:[{mg_elementConfigs:{},template:'<div class="jumbotron"><h3>\u6211\u7684\u5224\u5b9a:</h3><div>\u5356\u5bb6\u5e94\u8be5\u9000\u6b3e${model.bestX}\u5143</div><h4>\u6211\u7684\u7406\u7531:</h4><div>${model.reason}</div><div>\u6211\u7684\u786e\u5b9a\u7a0b\u5ea6\u662f${model.truth}%</div></div>',
initShow:[]},{ex_ListItem:[{addClass:"media",template:'<div class="pull-left media-left" ><div style="width:100px;">${date:model.created_at}</div></div><div class="media-body"><h4 class="media-heading"><a class="ssysLink" data-state="#kase/${model.kase_id}" href="javascript:;">${model.kase_name}</a></h4><div><strong>\u5224\u5b9a</strong>:\u5356\u5bb6\u5e94\u8be5\u9000\u6b3e${model.bestX}\u5143</div><div><strong>\u7406\u7531</strong>:${model.reason}</div><div><strong>\u786e\u5b9a\u7a0b\u5ea6</strong>:${model.truth}%</div></div>'},
{ex_MyVerdict:{}}]}],xp_CreateView:[{defaultState:"inputCore",title:"\u5224\u5b9a",steps:["inputCore","inputMore"],mg_elementConfigs:{bestXInput:["NumberInput",{icon:"cny",unit:"\u5143",placeholder:"\u4f60\u8ba4\u4e3a\u5356\u5bb6\u5e94\u8be5\u9000\u6b3e\u591a\u5c11\u5143\u94b1?"}],truthInput:["StarRater",{title:"\u4f60\u5bf9\u81ea\u5df1\u7684\u8bc4\u5224\u786e\u5b9a\u5417?\u8bf7\u8bc4\u4ef7\u4f60\u7684\u786e\u5b9a\u7a0b\u5ea6",min:0,max:100,step:10,size:"xs",starCaptions:{10:"\u778e\u8499\u7684",
20:"\u5f88\u4e0d\u786e\u5b9a",30:"\u4e0d\u592a\u786e\u5b9a",40:"\u53ea\u6709\u4e09\u56db\u6210\u628a\u63e1",50:"\u6709\u4e00\u534a\u628a\u63e1",60:"\u6709\u516d\u6210\u628a\u63e1",70:"\u6709\u4e03\u6210\u628a\u63e1",80:"\u6709\u516b\u6210\u628a\u63e1",90:"\u6709\u4e5d\u6210\u628a\u63e1",100:"\u5341\u5206\u786e\u5b9a"}}],reasonInput:["TextInput",{placeholder:"\u8bf7\u586b\u5165\u4f60\u7684\u8bc4\u5224\u7406\u7531",max:140}]},mg_elementConfigRules:[[/^y(\d)Input$/,["StarRater",{title:"\u6709\u4eba\u8ba4\u4e3a\u5356\u5bb6\u5e94\u8be5\u9000\u6b3e${x$1}\u5143,\u4f60\u5bf9\u8be5\u5224\u5b9a\u7684\u6ee1\u610f\u5ea6\u662f\u591a\u5c11?",
size:"xs",starCaptions:{"0.5":"\u575a\u51b3\u53cd\u5bf9",1:"\u53cd\u5bf9","1.5":"\u4e0d\u6ee1\u610f",2:"\u4e0d\u592a\u6ee1\u610f","2.5":"\u65e0\u6240\u8c13",3:"\u8fd8\u53ef\u4ee5","3.5":"\u6ee1\u610f",4:"\u5f88\u6ee1\u610f","4.5":"\u63a5\u8fd1\u5b8c\u7f8e",5:"\u6700\u6ee1\u610f"}}]]],initShow:["stage","@topbar","@pageHeader"],mg_showConfigs:{inputCore:["bestXInput","truthInput","reasonInput","@nextButton"],inputMore:["@saveButton"]},mg_loadConfigs:{inputCore:{StarRater:"js:$$view/StarRater.js"},inputMore:{opts:"opt/forVerdict.json?kase_id=${model.kase_id}&x=${model.bestX}"}},
filter_inputMore:function(a){this.backState="inputCore";this.currentStep=2;this.subTitle="\u8bf7\u586b\u5165\u5bf9\u522b\u4eba\u5224\u5b9a\u7684\u6ee1\u610f\u5ea6";this.getOpts();this.showConfigs=$$.clone(this.showConfigs);for(var b=0,c=this.opts.length;b<c;b++)this["x"+b]=this.opts[b],this.showConfigs.inputMore.push("y"+b+"Input");return a},filter_inputCore:function(a){this.backState="../index";this.currentStep=1;this.subTitle="\u8bf7\u586b\u5165\u4f60\u7684\u5224\u5b9a";return a},updateInputData:function(){var a=
this.parentCall("updateInputData"),b=a.points={};if(this.opts)for(var c=0,d=this.opts.length;c<d;c++)b[this.opts[c]]=this.elements["y"+c+"Input"].updateInputData();return a},afterShow:function(){this.parent.elements.scrollspy.find('li>a[data-target="#'+this.parent.fullname+'__verdictCreator"]').trigger("click")},getOpts:function(){if(0==this.opts.length)for(var a=this.app.resources.kase.models[this.model.kase_id],a=[a.claimed,a.agreed],b=0,c=a.length;b<c;b++){var d=a[b];d!=this.model.bestX&&this.opts.push(d)}}},
{}]});pandingbao.addPage("session",{style:"",defaultState:"me",mg_elementConfigs:{loginHeader:["Html",['<div class="page-header"><h3>\u767b\u5f55<span class="pull-right"><small >\u8fd8\u6ca1\u6709\u5224\u5b9a\u5b9d\u8d26\u53f7?<a href="#user/create">\u6ce8\u518c</a></small></span></h3></div>'],"login"],usernameInput:["StringInput",[{icon:"user",placeholder:"\u8f93\u5165\u90ae\u7bb1\u6216\u7528\u6237\u540d"}],"login"],passwordInput:["PasswordInput",[],"login"],rememberInput:["BooleanInput",["\u4e0b\u6b21\u81ea\u52a8\u767b\u5f55"],
"login"],loginButton:["Button",["onLogin","\u767b\u5f55",{type:"primary",size:"bg"}],{location:"login",cssClass:"col-xs-12"}],logoutAlert:["Html",['<div class="alert alert-danger">\u4f60\u786e\u5b9a\u8981\u9000\u51fa\u767b\u5f55\u5417?</div>'],"logout"],confirmLogout:["Button",["confirmLogout","\u786e\u5b9a",{type:"danger"}],"logout"],cancelLogout:["Button",["#p_session","\u53d6\u6d88"],"logout"],oauthPanel:["Html",['<ul class="col-sm-6 pull-right"><li class="">\u5feb\u901f\u901a\u8fc7\u5408\u4f5c\u7f51\u7ad9\u5e10\u53f7\u767b\u5f55</li><li class="weibodl"><a rel="nofollow" class="ui-sns-sina" title="\u65b0\u6d6a\u5fae\u535a\u8d26\u53f7\u767b\u5f55" href="${app.baseUrl}ssys/oauth2?provider=weibo"></a><a rel="nofollow" class="ui-sns-qq" title="\u817e\u8baf\u5fae\u535a\u8d26\u53f7\u767b\u5f55" href="/session/connect?provider=tencent&amp;url=http%3A%2F%2Fwww.demohour.com%2F"></a><a rel="nofollow" class="ui-sns-qzone" title="QQ\u7a7a\u95f4\u8d26\u53f7\u767b\u5f55" href="/session/connect?provider=qzone&amp;url=http%3A%2F%2Fwww.demohour.com%2F"></a><a rel="nofollow" class="ui-sns-douban" title="\u8c46\u74e3\u8d26\u53f7\u767b\u5f55" href="/session/connect?provider=douban&amp;url=http%3A%2F%2Fwww.demohour.com%2F"></a></li></ul>']],
me:["${mv~user.Me}"],login:["Html","<div></div>",{cssClass:"col-xs-10 col-xs-offset-1"}],logout:["Html","<div></div>",{cssClass:"col-xs-10 col-xs-offset-1 text-center"}]},initShow:["topbar"],inputConfigs:["username","password","remember"],mg_showConfigs:{logout:["logout","logoutAlert","confirmLogout","cancelLogout"],login:"login loginHeader usernameInput passwordInput rememberInput loginButton".split(" ")},onLogin:function(){var a=this.updateInputData(),b=this;this.app.currentUser.login(a.username,
a.password,a.remember).pipe(function(){},function(a){b.showErrors(a)})},filter_logout:function(a){return this.app.currentUser.isGuest?ssys.reject("login"):a},confirmLogout:function(){this.app.currentUser.logout()}});pandingbao.addPage("index",{mg_elementConfigs:{complainBlock:["Html",['<div class="row text-center"></div>']],complainButton:["Button",["#kase/create","\u6211\u8981\u6295\u8bc9",{size:"lg",type:"danger",cssClass:"col-xs-12 col-md-12"}],{wrapper:'<div style="display:table;width:100%;margin-bottom:10px">{{}}</div>'}],sellerComplainButton:["Button",["#kase/sellerComplain","\u6211\u8981\u6295\u8bc9\u4e70\u5bb6",{size:"lg",type:"success"}],{location:"complainBlock"}],moralStars:["${app.resources.user.CollectionView.MoralStars}"],
verdictStars:["${app.resources.user.CollectionView.VerdictStars}"],myCurrentKases:["${app.resources.kase.CollectionView.MyCurrentKases}",null,{hide:"${isGuest}"}],beforeVerdictKases:["${app.resources.kase.CollectionView.BeforeVerdictKases}"],verdictingKases:["${cl~kase.VerdictingKases}"],convictedKases:["${cl~kase.ConvictedKases}"]},initShow:["topbar","myCurrentKases.","verdictingKases."]});window.console=window.console||{info:function(){},debug:function(){},warn:function(){},error:function(){},log:function(){}};console.debug||(console.debug=console.info);console.warn||(console.warn=console.log||console.info);console.error||(console.error=console.info);ssys.baseUrl="http://ssys.pandingbao.com/";pandingbao.baseUrl="http://app.pandingbao.com/";pandingbao.staticBaseUrl="http://static.pandingbao.com/";pandingbao.storageBaseUrl="http://pdbstorage.oss-cn-hangzhou.aliyuncs.com/";pandingbao.init();
